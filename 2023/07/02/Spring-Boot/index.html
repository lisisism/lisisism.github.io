<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    Spring Boot 丨
    

    Lism Blog
  </title>

  
  <link rel="shortcut icon" href="/icon.svg">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="/Lism Blog" type="application/atom+xml">
</head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">/Lism Blog</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">Spring Boot</div>
  <div class="post-meta">
    <div class="date">2023 七月 2日</div>
    <div class="tags">
      
      <div class="tag-item">Java</div>
      
      <div class="tag-item">Spring</div>
      
      <div class="tag-item">String-Boot</div>
      
    </div>
  </div>
  

  <main class="post-content"><h1 id="spring-boot"><a class="markdownIt-Anchor" href="#spring-boot"></a> Spring Boot</h1>
<p>[toc]</p>
<h2 id="spring-boot基础"><a class="markdownIt-Anchor" href="#spring-boot基础"></a> Spring Boot基础</h2>
<p>SSM需要做大量的配置工作，其实很多配置行为本身只是手段，并不是目的。 基于这个考虑，把该简化的简化，该省略的省略，开发人员只用关心提供业务功能就行了，这就是 SpringBoot</p>
<p>Spring Boot是一个基于Spring的套件，它帮我们预组装了Spring的一系列组件，以便以尽可能少的代码和配置来开发基于Spring的Java应用程序。</p>
<p>以汽车为例，如果我们想组装一辆汽车，我们需要发动机、传动、轮胎、底盘、外壳、座椅、内饰等各种部件，然后把它们装配起来。Spring就相当于提供了一系列这样的部件，但是要装好汽车上路，还需要我们自己动手。而Spring Boot则相当于已经帮我们预装好了一辆可以上路的汽车，如果有特殊的要求，例如把发动机从普通款换成涡轮增压款，可以通过修改配置或编写少量代码完成。</p>
<p>因此，Spring Boot和Spring的关系就是整车和零部件的关系，它们不是取代关系，试图跳过Spring直接学习Spring Boot是不可能的。</p>
<p><strong>Spring Boot的目标就是提供一个开箱即用的应用程序架构，我们基于Spring Boot的预置结构继续开发，省时省力</strong>。</p>
<p>换言之，SpringBoot可以简单地看成<strong>简化</strong>了的、按照<strong>约定开发</strong>的SSM(H)</p>
<p>快速开发框架Spring Boot</p>
<h3 id="创建工程运行"><a class="markdownIt-Anchor" href="#创建工程运行"></a> 创建工程/运行</h3>
<h4 id="创建项目"><a class="markdownIt-Anchor" href="#创建项目"></a> 创建项目</h4>
<h5 id="官网创建"><a class="markdownIt-Anchor" href="#官网创建"></a> 官网创建</h5>
<p>可以使用网站去创建一个工程，解压后放到idea的工程目录，然后添加model</p>
<p><a href="start.spring.io">start.spring.io</a></p>
<p><strong>idea添加model</strong></p>
<blockquote>
<p>idea中删除Model需要删除两次，第一次是逻辑删除，第二次才是真正的物理文件的删除</p>
</blockquote>
<h5 id="idea创建-jar"><a class="markdownIt-Anchor" href="#idea创建-jar"></a> idea创建-jar</h5>
<p>Create New Project -&gt; Spring Initializr</p>
<p>填写对应的名称参数</p>
<p>创建一个基础的Web项目</p>
<p>指定项目路径 -&gt; Finish</p>
<p>创建好之后，会自带一个<code>SpringbootApplication</code>类，其被<code>@SpringBootApplication</code>所标记，表示这个是一个springboot应用</p>
<h5 id="idea创建-war"><a class="markdownIt-Anchor" href="#idea创建-war"></a> idea创建-war</h5>
<p>前面创建的Spring Boot工程最终被打为了Jar包，是以可执行文件的形式出现的，其使用了Spring Boot内嵌的Tomcat作为Web服务器来运行web应用的。新版Dubbo的监控中心工程就是典型的应用。但在实际生产环境下，对于Web工程，很多时候我们需要的是war包，然后部署到企业级Web服务器中。所以，下面我们来看一下如何使用Spring Boot将工程打为war包。</p>
<p><strong>创建一个基于war的spring boot工程</strong></p>
<p><strong>war工程解析</strong></p>
<p>war工程比jar工程多了一个<code>ServletInitializer</code>类</p>
<ul>
<li>在该工程中我们发现其自动增加了一个类ServletInitializer，该类重写了父类的configure()方法。该方法用于完成web环境的配置，即web环境的初始化工作。</li>
</ul>
<p>打开SpringBootServletInitializer类，查看其configure()方法的注释可知，该方法已经完成了所有应用程序配置的默认设置，用户只需要写代码即可。</p>
<blockquote>
<p>翻译如下：配置应用程序。通常情况下(Normally)，所有你需要做的仅仅是添加源码，因为其它配置已经具有了合理(sensible)</p>
</blockquote>
<p>由于这是一个war包工程，将来需要部署到服务器，即在打包时无需ServletAPI。然而在编译时是需要的，所以在工程的pom文件中专门添加了<scope>provided</scope>范围的<strong>ServletAPI依赖</strong>。</p>
<p><strong>打包</strong><br />
运行Maven的package命令，将其打为war</p>
<p><strong>部署</strong><br />
找到该war包，将其部署到Tomcat的webapps目录中，启动Tomcat。</p>
<p><strong>访问</strong><br />
在浏览器中可以访问到该工程。注意，由于工程是部署到了Tomcat的webapps中，不是部署到webapps/ROOT中，所以在访问时需要指定工程名。</p>
<h4 id="helloworld"><a class="markdownIt-Anchor" href="#helloworld"></a> helloWorld</h4>
<p>新写的类必须在@SpringBootApplication标记类的包或子包下面，否则扫描不到</p>
<p><a target="_blank" rel="noopener" href="http://xn--com-k82eq06crpj.leeboer.springboot.web">新建包com.leeboer.springboot.web</a>，然后在其下新建类<strong>HelloController</strong></p>
<p>这个类就是Spring MVC里的一个普通的<strong>控制器</strong></p>
<ul>
<li><code>@RestController</code>使spring4里的新注解，是 <code>@ResponseBody</code>和<code>@Controller</code>的缩写</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.web;

<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="comment">//这个注解使spring4中的新注解，使@Controller和@ResponseBody的缩写</span>
<span class="meta">@RestController</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;
    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Hello Spring Boot!&quot;</span>;
    &#125;
&#125;</code></pre>
<h4 id="测试运行"><a class="markdownIt-Anchor" href="#测试运行"></a> 测试运行</h4>
<p>运行SpringbootApplication.java</p>
<p>然后访问地址</p>
<pre><code class="highlight plaintext">http://127.0.0.1:8080/hello</code></pre>
<blockquote>
<p>为什么不用启动tomcat了呢？<br />
这是因为com.leeboer.springboot.SpringbootApplication类的主方法就把tomcat嵌进去了，不需要手动启动tomcat了</p>
</blockquote>
<blockquote>
<p>使用spring boot构建一个web项目就是如此简单</p>
</blockquote>
<h3 id="部署"><a class="markdownIt-Anchor" href="#部署"></a> 部署</h3>
<p>spring boot和之前的web应用程序不一样，其本质是一个Java应用程序</p>
<p>通常来说，spring boot部署会采用两种方式，全部打包为jar，或者打包为一个war</p>
<h4 id="idea中打包"><a class="markdownIt-Anchor" href="#idea中打包"></a> idea中打包</h4>
<p>双击该按钮即可打包</p>
<p>打包存储的路径位置：（BUILD SUCCESS表示构建成功）</p>
<p>然后就可以直接在cmd命令中启动该工程：</p>
<pre><code class="highlight plaintext">java -jar D:\LeeGit\springbootdemo\target\springbootdemo-0.0.1-SNAPSHOT.jar</code></pre>
<p>启动成功：</p>
<h4 id="jar-方式"><a class="markdownIt-Anchor" href="#jar-方式"></a> jar 方式</h4>
<p><strong>打包</strong></p>
<pre><code class="highlight plaintext">cd D:\leeGit\springbootdemo
mvn install</code></pre>
<blockquote>
<p>这会导致在cd D:\leeGit\springbootdemo\target目录下生成一个jar文件</p>
</blockquote>
<blockquote>
<p>或者也可以使用idea进行打包，详情自行百度</p>
</blockquote>
<p><strong>运行</strong><br />
输入命令：</p>
<pre><code class="highlight plaintext">java -jar target/springboot-0.0.1-SNAPSHOT.jar</code></pre>
<blockquote>
<p>就启动这个jar了</p>
</blockquote>
<blockquote>
<p>通过这个方式，把jar上传到服务器并运行，就可以达到部署效果了</p>
</blockquote>
<p><strong>保持linux运行</strong></p>
<pre><code class="highlight plaintext">nohup java -jar xxxx.jar &amp;</code></pre>
<h4 id="war-方式"><a class="markdownIt-Anchor" href="#war-方式"></a> war 方式</h4>
<p><strong>Application</strong><br />
Application修改如下代码，新加：</p>
<p><code>@ServletComponentScan</code>注解，并且继承<code>SpringBootServletInitializer</code></p>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer;

<span class="keyword">import</span> javafx.application.Application;
<span class="keyword">import</span> org.springframework.boot.SpringApplication;
<span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;
<span class="keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;
<span class="keyword">import</span> org.springframework.boot.web.support.SpringBootServletInitializer;

<span class="meta">@SpringBootApplication</span>
<span class="meta">@ServletComponentScan</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootdemoApplication</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span> &#123;
	<span class="meta">@Override</span>
	<span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder application)</span> &#123;
		<span class="keyword">return</span> application.sources(SpringbootdemoApplication.class);
	&#125;
	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
		SpringApplication.run(SpringbootdemoApplication.class, args);
	&#125;
&#125;</code></pre>
<p><strong>pom.xml</strong><br />
新增打包成war的声明：</p>
<pre><code class="highlight plaintext">&lt;packaging&gt;war&lt;/packaging&gt;</code></pre>
<p>spring-boot-starter-tomcat修改为 provided方式，以避免和独立 tomcat 容器的冲突.</p>
<blockquote>
<p>表示provided 只在编译和测试的时候使用，打包的时候就没它了</p>
</blockquote>
<pre><code class="highlight xml"><span class="comment">&lt;!--这个表示springboot的内置tomcat只在测试的时候用，打包部署的时候就没有它--&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<p><strong>pom.xml</strong></p>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>
	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span>
	<span class="tag">&lt;<span class="name">parent</span>&gt;</span>
		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.21.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span>
	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span>
	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leeboer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springbootdemo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
	<span class="tag">&lt;<span class="name">name</span>&gt;</span>springbootdemo<span class="tag">&lt;/<span class="name">name</span>&gt;</span>
	<span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span>
	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span>

	<span class="tag">&lt;<span class="name">properties</span>&gt;</span>
		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span>
	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span>

	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>
		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>

		<span class="comment">&lt;!--这个表示springboot的内置tomcat只在测试的时候用，打包部署的时候就没有它--&gt;</span>
		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>

		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
		
	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>

	<span class="tag">&lt;<span class="name">build</span>&gt;</span>
		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span>
			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span>
				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>
		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>
	<span class="tag">&lt;/<span class="name">build</span>&gt;</span>

<span class="tag">&lt;/<span class="name">project</span>&gt;</span>
</code></pre>
<p><strong>创建war包</strong></p>
<pre><code class="highlight plaintext">cd D:\leeGit\springbootdemo
mvn clean package</code></pre>
<blockquote>
<p>这样就在target目录下生成了一个<code>springboot-0.0.1-SNAPSHOT.war</code>文件</p>
</blockquote>
<p><strong>部署</strong></p>
<p>如果用 <code>springboot-0.0.1-SNAPSHOT.war</code> 这个文件名部署，那么访问的时候就要在路径上加上springboot-0.0.1-SNAPSHOT。 所以把这个文件重命名为 ROOT.war</p>
<blockquote>
<p>ROOT.war　并不是指访问的时候要使用 /ROOT/hello ,而是直接使用/hello 进行访问，ROOT表示根路径</p>
</blockquote>
<p>也可以命名为lee.war，访问就要改为localhost:8080/lee/hello</p>
<p>然后把它放进<strong>tomcat 的webapps</strong>目录下</p>
<p><strong>运行</strong><br />
运行tomcat下bin目录的startup.bat，然后就可以启动了，访问：</p>
<pre><code class="highlight plaintext">http://127.0.0.1:8080/hello</code></pre>
<h3 id="工程结构详解"><a class="markdownIt-Anchor" href="#工程结构详解"></a> 工程结构详解</h3>
<h4 id="spring-boot-pomxml详解"><a class="markdownIt-Anchor" href="#spring-boot-pomxml详解"></a> spring boot pom.xml详解</h4>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span>

    <span class="tag">&lt;<span class="name">parent</span>&gt;</span>
        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span>

    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lee<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springbootdemo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
    <span class="tag">&lt;<span class="name">name</span>&gt;</span>springbootdemo<span class="tag">&lt;/<span class="name">name</span>&gt;</span>
    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span>

    <span class="tag">&lt;<span class="name">properties</span>&gt;</span>
        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span>

    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>

        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>

    <span class="tag">&lt;<span class="name">build</span>&gt;</span>
        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>
            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>
                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">build</span>&gt;</span>

<span class="tag">&lt;/<span class="name">project</span>&gt;</span>
</code></pre>
<ul>
<li>
<p>这里的pom.xml文件中没有版本号是因为在<strong>父工程中进行了选择性继承</strong></p>
</li>
<li>
<p>我们打开父工程：</p>
</li>
<li>
<p>如果要更改spring的版本号，可以直接这样修改</p>
</li>
</ul>
<p><strong>springboot进行了二次打包</strong></p>
<ul>
<li>
<p>spring boot使用该插件，对maven package打的包进行了二次打包:</p>
</li>
<li>
<p>二次打包后才变成可执行文件，第一次打包的文件中并没有.MF文件</p>
</li>
<li>
<p>jar是在original的基础上进行的二次打包</p>
</li>
</ul>
<h4 id="manifestmf文件"><a class="markdownIt-Anchor" href="#manifestmf文件"></a> MANIFEST.MF文件</h4>
<p><strong>把启动jar文件用编辑器打开：可以找到MANIFEST.MF文件</strong></p>
<p>在Java编译的jar文件中，一定会有一个一个META-INF目录， 这个目录下会有一些文件，其中必有一个MANIFEST.MF</p>
<pre><code class="highlight bash">Manifest-Version: 1.0
Implementation-Title: springbootdemo
Implementation-Version: 0.0.1-SNAPSHOT
Start-Class: com.lee.springbootdemo.SpringbootdemoApplication   <span class="comment">#我们的springboot启动类，入口类调用了该启动类</span>
Spring-Boot-Classes: BOOT-INF/classes/
Spring-Boot-Lib: BOOT-INF/lib/
Build-Jdk-Spec: 1.8
Spring-Boot-Version: 2.1.9.RELEASE
Created-By: Maven Archiver 3.4.0
Main-Class: org.springframework.boot.loader.JarLauncher      <span class="comment">#定义jar文件的入口类，该类必须是一个可执行的类，一旦定义了该属性即可通过 java -jar x.jar来运行该jar文件</span></code></pre>
<h3 id="热部署"><a class="markdownIt-Anchor" href="#热部署"></a> 热部署</h3>
<p>目前的spring boot，当发生了任何修改之后，必须关闭后再启动Application类才能够生效，显得略微麻烦，spring boot提供了热部署的方式，当发现任何类发生了改变，马上通过jvm类加载的方式，加载最新的类到虚拟机当中，这样就不需要重新启动也可以看到修改后的效果</p>
<h4 id="eclipse"><a class="markdownIt-Anchor" href="#eclipse"></a> eclipse</h4>
<p>依赖</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span> <span class="comment">&lt;!-- 这个需要为 true 热部署才有效 --&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
</code></pre>
<p>插件</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></code></pre>
<p><strong>重启测试</strong><br />
重新启动application，然后随便修改一下任意代码，就会看到控制台自动重启</p>
<h4 id="idea"><a class="markdownIt-Anchor" href="#idea"></a> idea</h4>
<p>ldea中的SpringBoot工程若要使用热部署，需要完成两个步骤。</p>
<ul>
<li><strong>导入devtools依赖</strong>，</li>
<li><strong>编辑当前工程的配置信息</strong>。</li>
</ul>
<p>这两个步骤是在每一个使用热部署的Spring Boot工程中均要设置的。</p>
<blockquote>
<p>需要注意，Spring Boot工程在ldea中的热部署与Eclipse中的热部署，工程修改后的重新启动时机是不同的。Eclipse中只要修改过的文件被保存了，则工程会马上重新部署。而ldea则不同，其对文件修改后的保存是自动的，所以其重新部署的时机是ldea整个IDE窗口被钝化时，即Windows 窗口切换到其它窗口时，工程会重新部署。</p>
</blockquote>
<p><strong>导入devtools依赖</strong></p>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span>

    <span class="tag">&lt;<span class="name">parent</span>&gt;</span>
        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span>

    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lee<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springbootdemo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
    <span class="tag">&lt;<span class="name">name</span>&gt;</span>springbootdemo<span class="tag">&lt;/<span class="name">name</span>&gt;</span>
    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span>

    <span class="tag">&lt;<span class="name">properties</span>&gt;</span>
        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span>
        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span><span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span>
        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span>
        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span>

    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>

        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>

        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>

    <span class="tag">&lt;<span class="name">build</span>&gt;</span>
        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>
            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>
                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">build</span>&gt;</span>

<span class="tag">&lt;/<span class="name">project</span>&gt;</span>
</code></pre>
<p><strong>编辑当前工程的配置信息</strong></p>
<blockquote>
<p>默认配置下，针对/static、/public和/templates目录中的文件修改，不会自动重启，因为禁用缓存后，这些文件的修改可以实时更新。</p>
</blockquote>
<h3 id="spring-boot主配置文件"><a class="markdownIt-Anchor" href="#spring-boot主配置文件"></a> Spring boot主配置文件</h3>
<p>Spring Boot的主配置文件也可使用application.yml文件。yml,也可写为yaml.</p>
<p>在开发之初YAML的本意是Yet Another Markup Language (仍是一种标记语言)。后来为了强调这种语言是以数据为中心，而不是以标记为中心，所以将YAML解释为Yami Ain’tMarkup Language (Yaml不是一种标记语言)。 它是一种直观的能够被电脑识别的数据序列化格式，是一个可读性高并且容易被人阅读，容易和脚本语言交互，用来表达多级资源序列的编程语言。</p>
<p><strong>yml与properties</strong>文件的主要区别是对于多级属性，即key的显示方式不同。yml文件在输入时，只需按照点(.)的方式输出key即可，输入完毕后回车即出现了如下形式。该形式要求冒号后与值之间要有一个空格。</p>
<pre><code class="highlight properties"><span class="comment">#配置端口号</span>
<span class="attr">server.port</span>=<span class="string">8080</span>
<span class="comment">#配置项目访问名称，上下文路径</span>
<span class="attr">server.servlet.context-path</span>=<span class="string">/leeboer</span></code></pre>
<hr />
<h4 id="端口和上下文路径"><a class="markdownIt-Anchor" href="#端口和上下文路径"></a> 端口和上下文路径</h4>
<p>可以通过修改application.properties，修改访问的端口号和上下文路径</p>
<pre><code class="highlight properties"><span class="attr">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span>
<span class="comment">#更改端口号</span>
<span class="attr">server.port</span>=<span class="string">8888</span>
<span class="comment">#更改上下文路径</span>
<span class="comment">#新版本spring boot使用server.servlet.context-path</span>
<span class="attr">server.context-path</span>=<span class="string">/test</span></code></pre>
<h4 id="yml配置文件"><a class="markdownIt-Anchor" href="#yml配置文件"></a> yml配置文件</h4>
<p>yml也是配置文件的一种写法格式，于properties的区别如下图所示</p>
<p><strong>注意事项</strong></p>
<ol>
<li>不同“等级” 用冒号隔开</li>
<li>次等级的前面是空格，不能使用制表符(tab)</li>
<li>冒号之后如果有值，那么冒号和值之间至少有一个空格，不能紧贴着</li>
</ol>
<pre><code class="highlight yml"><span class="attr">spring:</span>
    <span class="attr">mvc:</span>
        <span class="attr">view:</span>
            <span class="attr">prefix:</span> <span class="string">/WEB-INF/jsp/</span>
            <span class="attr">suffix:</span> <span class="string">.jsp</span>
<span class="attr">server:</span>
    <span class="attr">port:</span> <span class="number">8888</span>
    <span class="attr">context-path:</span> <span class="string">/test</span></code></pre>
<blockquote>
<p>要么用application.properties 要么用 application.yml，不要都用，spring只会选择其一</p>
</blockquote>
<h3 id="actuato"><a class="markdownIt-Anchor" href="#actuato"></a> Actuato</h3>
<p>Actuator是Spring Boot提供的对应用系统的自省和监控的集成功能，可以对应用系统进行配置查看、相关功能统计等。在SpringCloud中主要是完成微服务的监控，完成监控治理。可以查看微服务间的数据处理和调用，当它们之间出现了异常，就可以快速定位到出现问题的地方。。</p>
<p>其功能与Dubbo的监控中心类似，不同的是，Dubbo的监控中心是需要专门部署的，而Spring Boot的Actuator 是存在于每一个工程中的。</p>
<h4 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h4>
<p><strong>添加依赖</strong></p>
<pre><code class="highlight xml"><span class="comment">&lt;!--actuator监控依赖--&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<p><strong>配置application.properties</strong></p>
<pre><code class="highlight properties"><span class="comment">#配置端口号</span>
<span class="attr">server.port</span>=<span class="string">8080</span>
<span class="comment">#配置项目访问名称，上下文路径</span>
<span class="attr">server.servlet.context-path</span>=<span class="string">/leeboer</span>
<span class="comment"></span>
<span class="comment">#actuator监控端口号和上下文路径</span>
<span class="attr">management.server.port</span>=<span class="string">9999</span>
<span class="attr">management.server.servlet.context-path</span>=<span class="string">/xxx</span></code></pre>
<p><strong>访问该路径</strong></p>
<pre><code class="highlight plaintext">http://localhost:9999/xxx/actuator/health</code></pre>
<p><strong>自定义info信息</strong></p>
<pre><code class="highlight properties"><span class="comment">#配置端口号</span>
<span class="attr">server.port</span>=<span class="string">8080</span>
<span class="comment">#配置项目访问名称，上下文路径</span>
<span class="attr">server.servlet.context-path</span>=<span class="string">/leeboer</span>
<span class="comment"></span>
<span class="comment">#actuator监控端口号和上下文路径</span>
<span class="attr">management.server.port</span>=<span class="string">9999</span>
<span class="attr">management.server.servlet.context-path</span>=<span class="string">/xxx</span>
<span class="comment">#指定监控终端的基本访问路径,默认为/actuator</span>
<span class="attr">management.endpoints.web.base-path</span>=<span class="string">/actuator</span>
<span class="comment"></span>
<span class="comment">#自定义info信息</span>
<span class="attr">info.company.name</span>=<span class="string">lee</span>
<span class="attr">info.company.url</span>=<span class="string">www.leeboer.xyz</span>
<span class="attr">info.company.addr</span>=<span class="string">china beijing</span>
<span class="comment"></span>
<span class="comment">#从properties中读取信息</span>
<span class="attr">info.project.groupid</span>=<span class="string">@project.groupId@</span>
<span class="attr">info.project.artifactid</span>=<span class="string">@project.artifactId@</span>
<span class="attr">info.project.version</span>=<span class="string">@project.version@</span>
<span class="attr">info.project.name</span>=<span class="string">@project.name@</span></code></pre>
<p><strong>开放所有的监控终端</strong></p>
<pre><code class="highlight properties"><span class="comment">#actuator监控端口号和上下文路径</span>
<span class="attr">management.server.port</span>=<span class="string">9999</span>
<span class="attr">management.server.servlet.context-path</span>=<span class="string">/xxx</span>
<span class="comment">#指定监控终端的基本访问路径,默认为/actuator</span>
<span class="attr">management.endpoints.web.base-path</span>=<span class="string">/actuator</span>
<span class="comment">#开放所有的监控终端</span>
<span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">*</span>
<span class="comment"></span>
<span class="comment">#关闭部分监控终端</span>
<span class="attr">management.endpoints.web.exposure.wxclude</span>=<span class="string">evn,beans</span></code></pre>
<h4 id="监控终端访问测试"><a class="markdownIt-Anchor" href="#监控终端访问测试"></a> 监控终端访问测试</h4>
<p><strong>mappings终端</strong><br />
下面是使用mappings终端，可以看到当前工程中所有的URI与处理器的映射关系，及详细的处理器方法及其映射规则。很实用。</p>
<p><strong>beans终端</strong></p>
<p><strong>env终端</strong><br />
可以看到当前应用程序运行主机的所有软硬件环境信息。</p>
<h4 id="常用监控终端"><a class="markdownIt-Anchor" href="#常用监控终端"></a> 常用监控终端</h4>
<table>
<thead>
<tr>
<th>id</th>
<th>desc</th>
<th>Sensitive</th>
</tr>
</thead>
<tbody>
<tr>
<td>auditevents</td>
<td>显示当前应用程序的审计事件信息</td>
<td>Yes</td>
</tr>
<tr>
<td>beans</td>
<td>显示应用Spring Beans的完整列表</td>
<td>Yes</td>
</tr>
<tr>
<td>caches</td>
<td>显示可用缓存信息</td>
<td>Yes</td>
</tr>
<tr>
<td>conditions</td>
<td>显示自动装配类的状态及及应用信息</td>
<td>Yes</td>
</tr>
<tr>
<td>configprops</td>
<td>显示所有 @ConfigurationProperties 列表</td>
<td>Yes</td>
</tr>
<tr>
<td>env</td>
<td>显示 ConfigurableEnvironment 中的属性</td>
<td>Yes</td>
</tr>
<tr>
<td>flyway</td>
<td>显示 Flyway 数据库迁移信息</td>
<td>Yes</td>
</tr>
<tr>
<td>health</td>
<td>显示应用的健康信息（未认证只显示status，认证显示全部信息详情）</td>
<td>No</td>
</tr>
<tr>
<td>info</td>
<td>显示任意的应用信息（在资源文件写info.xxx即可）</td>
<td>No</td>
</tr>
<tr>
<td>liquibase</td>
<td>展示Liquibase 数据库迁移</td>
<td>Yes</td>
</tr>
<tr>
<td>metrics</td>
<td>展示当前应用的 metrics 信息</td>
<td>Yes</td>
</tr>
<tr>
<td>mappings</td>
<td>显示所有 @RequestMapping 路径集列表</td>
<td>Yes</td>
</tr>
<tr>
<td>scheduledtasks</td>
<td>显示应用程序中的计划任务</td>
<td>Yes</td>
</tr>
<tr>
<td>sessions</td>
<td>允许从Spring会话支持的会话存储中检索和删除用户会话。</td>
<td>Yes</td>
</tr>
<tr>
<td>shutdown</td>
<td>允许应用以优雅的方式关闭（默认情况下不启用）</td>
<td>Yes</td>
</tr>
<tr>
<td>threaddump</td>
<td>执行一个线程dump</td>
<td>Yes</td>
</tr>
<tr>
<td>httptrace</td>
<td>显示HTTP跟踪信息（默认显示最后100个HTTP请求 - 响应交换）</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h3 id="导入spring-boot项目"><a class="markdownIt-Anchor" href="#导入spring-boot项目"></a> 导入spring boot项目</h3>
<p><strong>idea导入springboot项目</strong></p>
<p>IDEA 导入Springboot 项目办法：</p>
<ol>
<li>菜单-&gt;File-&gt;New-&gt;Project From Existing Sources</li>
<li>如图粘贴右上角springboot.rar 解压出来之后的目录,并选中 pom.xml</li>
<li>点击OK，然后后面就一路 Next 就行了</li>
</ol>
<h3 id="打包"><a class="markdownIt-Anchor" href="#打包"></a> 打包</h3>
<p>我们在Maven的使用插件一节中介绍了如何使用maven-shade-plugin打包一个可执行的jar包。在Spring Boot应用中，打包更加简单，因为Spring Boot自带一个更简单的spring-boot-maven-plugin插件用来打包，我们只需要在pom.xml中加入以下配置：</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">...</span>&gt;</span>
    ...
    <span class="tag">&lt;<span class="name">build</span>&gt;</span>
        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>
            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>
                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">build</span>&gt;</span><span class="tag">&lt;/<span class="name">project</span>&gt;</span></code></pre>
<p>无需任何配置，Spring Boot的这款插件会自动定位应用程序的入口Class，我们执行以下Maven命令即可打包：</p>
<pre><code class="highlight plaintext">$ mvn clean package</code></pre>
<p>以springboot-exec-jar项目为例，打包后我们在target目录下可以看到两个jar文件：</p>
<pre><code class="highlight plaintext">$ ls
classes
generated-sources
maven-archiver
maven-status
springboot-exec-jar-1.0-SNAPSHOT.jar
springboot-exec-jar-1.0-SNAPSHOT.jar.original</code></pre>
<p>其中，springboot-exec-jar-1.0-SNAPSHOT.jar.original是Maven标准打包插件打的jar包，它只包含我们自己的Class，不包含依赖，而springboot-exec-jar-1.0-SNAPSHOT.jar是Spring Boot打包插件创建的包含依赖的jar，可以直接运行：</p>
<pre><code class="highlight plaintext">$ java -jar springboot-exec-jar-1.0-SNAPSHOT.jar</code></pre>
<p>这样，部署一个Spring Boot应用就非常简单，无需预装任何服务器，只需要上传jar包即可。</p>
<p>在打包的时候，因为打包后的Spring Boot应用不会被修改，因此，默认情况下，spring-boot-devtools这个依赖不会被打包进去。但是要注意，使用早期的Spring Boot版本时，需要配置一下才能排除spring-boot-devtools这个依赖：</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
        <span class="tag">&lt;<span class="name">excludeDevtools</span>&gt;</span>true<span class="tag">&lt;/<span class="name">excludeDevtools</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>
<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></code></pre>
<p>如果不喜欢默认的项目名+版本号作为文件名，可以加一个配置指定文件名：</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">...</span>&gt;</span>
    ...
    <span class="tag">&lt;<span class="name">build</span>&gt;</span>
        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>awesome-app<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span>
        ...
    <span class="tag">&lt;/<span class="name">build</span>&gt;</span>
<span class="tag">&lt;/<span class="name">project</span>&gt;</span></code></pre>
<p>这样打包后的文件名就是awesome-app.jar</p>
<h3 id="瘦身spring-boot"><a class="markdownIt-Anchor" href="#瘦身spring-boot"></a> 瘦身Spring Boot</h3>
<p>在上一节中，我们使用Spring Boot提供的spring-boot-maven-plugin打包Spring Boot应用，可以直接获得一个完整的可运行的jar包，把它上传到服务器上再运行就极其方便。</p>
<p>但是这种方式也不是没有缺点。最大的缺点就是包太大了，动不动几十MB，在网速不给力的情况下，上传服务器非常耗时。并且，其中我们引用到的Tomcat、Spring和其他第三方组件，只要版本号不变，这些jar就相当于每次都重复打进去，再重复上传了一遍。</p>
<p>真正经常改动的代码其实是我们自己编写的代码。如果只打包我们自己编写的代码，通常jar包也就几百KB。但是，运行的时候，classpath中没有依赖的jar包，肯定会报错。</p>
<p>所以问题来了：如何只打包我们自己编写的代码，同时又自动把依赖包下载到某处，并自动引入到classpath中。解决方案就是使用<strong>spring-boot-thin-launcher</strong>。</p>
<h4 id="使用spring-boot-thin-launcher"><a class="markdownIt-Anchor" href="#使用spring-boot-thin-launcher"></a> 使用spring-boot-thin-launcher</h4>
<p>我们先演示如何使用spring-boot-thin-launcher，再详细讨论它的工作原理。首先复制一份上一节的Maven项目，并重命名为springboot-thin-jar：</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">...</span>&gt;</span>
    ...
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itranswarp.learnjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-thin-jar<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
    ...</code></pre>
<p>然后，修改<build>-<plugins>-<plugin>，给原来的spring-boot-maven-plugin增加一个<dependency>如下：</p>
<pre><code class="highlight java">&lt;project ...&gt;
    ...
    &lt;build&gt;
        &lt;finalName&gt;awesome-app&lt;/finalName&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;dependencies&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.springframework.boot.experimental&lt;/groupId&gt;
                        &lt;artifactId&gt;spring-boot-thin-layout&lt;/artifactId&gt;
                        &lt;version&gt;<span class="number">1.0</span><span class="number">.27</span>.RELEASE&lt;/version&gt;
                    &lt;/dependency&gt;
                &lt;/dependencies&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;&lt;/project&gt;</code></pre>
<p>不需要任何其他改动了，我们直接按正常的流程打包，执行mvn clean package，观察target目录最终生成的可执行awesome-app.jar，只有79KB左右。</p>
<p>直接运行java -jar awesome-app.jar，效果和上一节完全一样。显然，79KB的jar肯定无法放下Tomcat和Spring这样的大块头。那么，运行时这个awesome-app.jar又是怎么找到它自己依赖的jar包呢？</p>
<p>实际上spring-boot-thin-launcher这个插件改变了spring-boot-maven-plugin的默认行为。它输出的jar包只包含我们自己代码编译后的class，一个很小的ThinJarWrapper，以及解析pom.xml后得到的所有依赖jar的列表。</p>
<p>运行的时候，入口实际上是ThinJarWrapper，它会先在指定目录搜索看看依赖的jar包是否都存在，如果不存在，先从Maven中央仓库下载到本地，然后，再执行我们自己编写的main()入口方法。这种方式有点类似很多在线安装程序：用户下载后得到的是一个很小的exe安装程序，执行安装程序时，会首先在线下载所需的若干巨大的文件，再进行真正的安装。</p>
<p>这个spring-boot-thin-launcher在启动时搜索的默认目录是用户主目录的.m2，我们也可以指定下载目录，例如，将下载目录指定为当前目录：</p>
<pre><code class="highlight plaintext">$ java -Dthin.root=. -jar awesome-app.jar</code></pre>
<p>上述命令通过环境变量thin.root传入当前目录，执行后发现当前目录下自动生成了一个repository目录，这和Maven的默认下载目录~/.m2/repository的结构是完全一样的，只是它仅包含awesome-app.jar所需的运行期依赖项。</p>
<blockquote>
<p>注意：只有首次运行时会自动下载依赖项，再次运行时由于无需下载，所以启动速度会大大加快。如果删除了repository目录，再次运行时就会再次触发下载。</p>
</blockquote>
<p>把79KB大小的awesome-app.jar直接扔到服务器执行，上传过程就非常快。但是，第一次在服务器上运行awesome-app.jar时，仍需要从Maven中央仓库下载大量的jar包，所以，spring-boot-thin-launcher还提供了一个dryrun选项，专门用来下载依赖项而不执行实际代码：</p>
<pre><code class="highlight plaintext">java -Dthin.dryrun=true -Dthin.root=. -jar awesome-app.jar</code></pre>
<p>执行上述代码会在当前目录创建repository目录，并下载所有依赖项，但并不会运行我们编写的main()方法。此过程称之为“预热”（warm up）。</p>
<p>如果服务器由于安全限制不允许从外网下载文件，那么可以在本地预热，然后把awesome-app.jar和repository目录上传到服务器。只要依赖项没有变化，后续改动只需要上传awesome-app.jar即可。</p>
<h2 id="spring-boot重要用法"><a class="markdownIt-Anchor" href="#spring-boot重要用法"></a> Spring boot重要用法</h2>
<h3 id="自定义异常页面"><a class="markdownIt-Anchor" href="#自定义异常页面"></a> 自定义异常页面</h3>
<h4 id="简单的替换异常页面"><a class="markdownIt-Anchor" href="#简单的替换异常页面"></a> 简单的替换异常页面</h4>
<p>我们可以使用简单的方式自定义异常页面，并将默认状态页面进行替换</p>
<p>在<code>resources</code>目录下新建<code>public.error</code>包</p>
<ul>
<li>编写404.html/500.html即可</li>
</ul>
<blockquote>
<p>在error目录中定义异常页面。这些异常页面的名称必须为相应的状态码，扩展名为html。</p>
</blockquote>
<h4 id="自定义编写抛错逻辑"><a class="markdownIt-Anchor" href="#自定义编写抛错逻辑"></a> 自定义编写抛错逻辑</h4>
<h5 id="增加抛错"><a class="markdownIt-Anchor" href="#增加抛错"></a> 增加抛错</h5>
<p>修改HelloController，使得访问你/hello一定会产生异常</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.web;

<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;
<span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;

<span class="keyword">import</span> java.text.DateFormat;
<span class="keyword">import</span> java.util.Date;

<span class="comment">//这个注解使spring4中的新注解，使@Controller和@ResponseBody的缩写</span>
<span class="comment">//@RestController</span>

<span class="comment">//修改RestController为controller</span>
<span class="comment">//这时返回的“hello”就不是字符串，而是根据application.properties中的视图重定向，在WEB-IND/jsp中去寻找hello.jsp文件</span>
<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;
    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(Model m)</span> <span class="keyword">throws</span> Exception &#123;
        <span class="comment">//ModelAndView类中包含了Model和View，在这里只使用Model,返回字符串，让框架去寻址</span>
        m.addAttribute(<span class="string">&quot;now&quot;</span>, DateFormat.getDateTimeInstance().format(<span class="keyword">new</span> <span class="title class_">Date</span>()));
        <span class="comment">//故意抛错，验证错误处理        </span>
        <span class="keyword">if</span>(<span class="literal">true</span>)&#123;
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;some exception&quot;</span>);
        &#125;
        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;
    &#125;
&#125;</code></pre>
<h5 id="globalexceptionhandler"><a class="markdownIt-Anchor" href="#globalexceptionhandler"></a> GlobalExceptionHandler</h5>
<p>新怎加一个类<code>GlobalExceptionHandler</code>，用于捕捉Exception异常以及其子类</p>
<p>捕捉到异常后，把异常信息，发出异常的地址放进ModelAndView里，然后跳转到errorPage.jsp</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.exception;

<span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;
<span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;

<span class="keyword">import</span> javax.servlet.http.HttpServletRequest;

<span class="meta">@ControllerAdvice</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;
    <span class="meta">@ExceptionHandler(value = Exception.class)</span>
    <span class="keyword">public</span> ModelAndView <span class="title function_">defaultErrorHandler</span><span class="params">(HttpServletRequest req, Exception e)</span> <span class="keyword">throws</span> Exception &#123;
        <span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();
        mav.addObject(<span class="string">&quot;exception&quot;</span>, e);
        mav.addObject(<span class="string">&quot;url&quot;</span>, req.getRequestURL());
        mav.setViewName(<span class="string">&quot;errorPage&quot;</span>);
        <span class="keyword">return</span> mav;
    &#125;

&#125;</code></pre>
<p><strong>@ControllerAdvice</strong>是Spring 3.2新增的注解，作用<strong>控制器增强</strong>，主要是用来Controller的一些公共的需求的低侵入性增强提供辅助，作用于<code>@RequestMapping</code>标注的方法上</p>
<ol>
<li><strong>@ExceptionHandler</strong>   自定义的错误处理器</li>
<li><strong>@ModelAttribute</strong>      全局的对所有的controller的Model添加属性</li>
<li><strong>@InitBinder</strong>  对表单数据绑定</li>
</ol>
<p>所以结合上面我们可以知道,使用@ExceptionHandler，可以处理异常, 但是仅限于当前Controller中处理异常, @ControllerAdvice可以配置basePackage下的所有controller. 所以结合两者使用,就可以处理全局的异常了</p>
<p>自定义异常类</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomGenericException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;

    <span class="keyword">private</span> String errCode;
    <span class="keyword">private</span> String errMsg;

    <span class="keyword">public</span> String <span class="title function_">getErrCode</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> errCode;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setErrCode</span><span class="params">(String errCode)</span> &#123;
        <span class="built_in">this</span>.errCode = errCode;
    &#125;

    <span class="keyword">public</span> String <span class="title function_">getErrMsg</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> errMsg;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setErrMsg</span><span class="params">(String errMsg)</span> &#123;
        <span class="built_in">this</span>.errMsg = errMsg;
    &#125;

    <span class="keyword">public</span> <span class="title function_">CustomGenericException</span><span class="params">(String errCode, String errMsg)</span> &#123;
        <span class="built_in">this</span>.errCode = errCode;
        <span class="built_in">this</span>.errMsg = errMsg;
    &#125;
&#125;</code></pre>
<p>使用示例</p>
<pre><code class="highlight java"><span class="meta">@ControllerAdvice</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionsHandler</span> &#123;

    <span class="meta">@ExceptionHandler(CustomGenericException.class)</span><span class="comment">//可以直接写@ExceptionHandler,不指明异常类，会自动映射</span>
    <span class="keyword">public</span> ModelAndView <span class="title function_">customGenericExceptionHnadler</span><span class="params">(CustomGenericException exception)</span>&#123; <span class="comment">//还可以声明接收其他任意参数</span>
        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;generic_error&quot;</span>);
        modelAndView.addObject(<span class="string">&quot;errCode&quot;</span>,exception.getErrCode());
        modelAndView.addObject(<span class="string">&quot;errMsg&quot;</span>,exception.getErrMsg());
        <span class="keyword">return</span> modelAndView;
    &#125;

    <span class="comment">//可以通过ResponseStatus配置返回的状态码</span>
    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span>
    <span class="meta">@ExceptionHandler(Exception.class)</span><span class="comment">//可以直接写@EceptionHandler，IOExeption继承于Exception</span>
    <span class="keyword">public</span> ModelAndView <span class="title function_">allExceptionHandler</span><span class="params">(Exception exception)</span>&#123;
        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;generic_error&quot;</span>);
        modelAndView.addObject(<span class="string">&quot;errMsg&quot;</span>, <span class="string">&quot;this is Exception.class&quot;</span>);
        <span class="keyword">return</span> modelAndView;
    &#125;
&#125;</code></pre>
<blockquote>
<p>此时<code>ExceptionsHandler</code>类就会捕获Controller中的所有异常</p>
</blockquote>
<h5 id="errorpagejsp"><a class="markdownIt-Anchor" href="#errorpagejsp"></a> errorPage.jsp</h5>
<pre><code class="highlight xml">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
 
<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:500px;border:1px solid lightgray;margin:200px auto;padding:80px&quot;</span>&gt;</span>
 
系统 出现了异常，异常原因是：
    $&#123;exception&#125;
    <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>
    出现异常的地址是：
    $&#123;url&#125;
    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></code></pre>
<h5 id="重启测试"><a class="markdownIt-Anchor" href="#重启测试"></a> 重启测试</h5>
<pre><code class="highlight plaintext">http://127.0.0.1:8080/hello</code></pre>
<h3 id="单元测试"><a class="markdownIt-Anchor" href="#单元测试"></a> 单元测试</h3>
<p><strong>添加依赖</strong></p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<p><strong>定义测试类</strong></p>
<ul>
<li><code>@RunWith(SpringRunner.class)</code></li>
<li><code>@SpringBootTest(classes=SpringbootdemoApplication.class)</code></li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.springbootdemo;

<span class="keyword">import</span> org.junit.Test;
<span class="keyword">import</span> org.junit.runner.RunWith;
<span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<span class="meta">@RunWith(SpringRunner.class)</span>
<span class="meta">@SpringBootTest(classes=SpringbootdemoApplication.class)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootdemoApplicationTests</span> &#123;

    <span class="meta">@Autowired</span>
    <span class="keyword">private</span> ISomeService service;
    
    <span class="meta">@Test</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;
        service.doSome();
    &#125;

&#125;</code></pre>
<h3 id="多环境选择"><a class="markdownIt-Anchor" href="#多环境选择"></a> 多环境选择</h3>
<p>在开发应用时，通常同一套程序会被运行在多个不同的环境，例如，开发、测试、生产环境等。每个环境的数据库地址、服务器端口号等配置都会不同。若在不同环境下运行时将配置文件修改为不同内容，那么，这种做法不仅非常繁琐，而且很容易发生错误。</p>
<p>在开发应用时，有时不同的环境，其需要运行的接口的实现类也是不同的。例如，若要开发一个具有短信发送功能的应用，开发环境中要执行的send()方法仅需调用短信模拟器即可，而生产环境中要执行的send()则需要调用短信运营商所提供的短信发送接口。这种情况下，就需要开发两个相关接口的实现类去实现send()方法。</p>
<p>对于不同的环境，需要使用不同的配置文件，执行不同的类。而<strong>这个选择只需在SpringBoot的主配置文件中指定即可</strong>。</p>
<p>下面以不同的环境“使用配置有不同的端口号的配置文件，及调用不同接口实现类”为例来演示多环境选择问题的解决</p>
<p>有时候在本地测试使用8080端口，可是上线使用的又是80端口，此时就可以通过多配置文件实现多配置支持的灵活切换</p>
<h4 id="多配置文件"><a class="markdownIt-Anchor" href="#多配置文件"></a> 多配置文件</h4>
<p><strong>3个配置文件：</strong></p>
<p>核心配置文件：<code>application.properties</code><br />
开发环境用的配置文件：<code>application-dev.properties</code><br />
生产环境用的配置文件：<code>application-pro.properties</code></p>
<p><strong>通过spring.profiles.active 灵活地来切换使用环境</strong></p>
<ul>
<li>该命令指定即为运行和编译要使用的配置文件</li>
<li>填写的值为其他application-之后，后缀名之前的简写名</li>
</ul>
<hr />
<ul>
<li>application.properties</li>
</ul>
<pre><code class="highlight properties"><span class="attr">spring.profiles.active</span>=<span class="string">pro</span>

<span class="attr">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span></code></pre>
<ul>
<li>application-dev.properties</li>
</ul>
<pre><code class="highlight properties"><span class="comment">#开发环境</span>
<span class="attr">server.port</span>=<span class="string">8088</span>
<span class="attr">server.context-path</span>=<span class="string">/test</span></code></pre>
<ul>
<li>application-pro.properties</li>
</ul>
<pre><code class="highlight properties"><span class="comment">#生产环境</span>
<span class="attr">server.port</span>=<span class="string">80</span>
<span class="attr">server.context-path</span>=<span class="string">/</span></code></pre>
<p>@<strong>Profile</strong>注释</p>
<ul>
<li>该注释可以标记在类上或方法上</li>
<li>即标记在哪个配置文件环境下生效</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MsgService</span>&#123;
    String <span class="title function_">send</span><span class="params">()</span>;
&#125;</code></pre>
<pre><code class="highlight java"><span class="meta">@Service</span>
<span class="meta">@Profile(&quot;dev&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DevMsgServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MsgService</span>&#123;
    String <span class="title function_">send</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> <span class="string">&quot;dev&quot;</span>;
    &#125;
&#125;</code></pre>
<pre><code class="highlight java"><span class="meta">@Service</span>
<span class="meta">@Profile(&quot;pro&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProMsgServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MsgService</span>&#123;
    String <span class="title function_">send</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> <span class="string">&quot;pro&quot;</span>;
    &#125;
&#125;</code></pre>
<pre><code class="highlight java"><span class="meta">@RestController</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgController</span>&#123;
    <span class="meta">@Autowired</span>
    <span class="keyword">private</span> MsgService service;
    
    <span class="meta">@GitMapping(&quot;/send&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">sendHandler</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> service.send();
    &#125;
&#125;</code></pre>
<h4 id="部署-2"><a class="markdownIt-Anchor" href="#部署-2"></a> 部署</h4>
<p>不仅可以通过修改application.properties文件进行切换，还可以在部署环境下，指定不同的参数来确保生产环境总是使用的希望的那套配置</p>
<p>构建</p>
<pre><code class="highlight plaintext">cd C:\Users\X7TI\Downloads\springboot
mvn install</code></pre>
<p>运行</p>
<pre><code class="highlight plaintext">java -jar target/springboot-0.0.1-SNAPSHOT.jar --spring.profiles.active=pro</code></pre>
<pre><code class="highlight plaintext">java -jar target/springboot-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev</code></pre>
<blockquote>
<p>这样就可以保证在开发环境总是用的8080端口，而到了生产环境总是用的80端口，免去了每次上线还要修改端口号的麻烦</p>
</blockquote>
<h3 id="禁用自动配置"><a class="markdownIt-Anchor" href="#禁用自动配置"></a> 禁用自动配置</h3>
<p>Spring Boot大量使用自动配置和默认配置，极大地减少了代码，通常只需要加上几个注解，并按照默认规则设定一下必要的配置即可。例如，配置JDBC，默认情况下，只需要配置一个spring.datasource：</p>
<pre><code class="highlight plaintext">spring:
  datasource:
    url: jdbc:hsqldb:file:testdb
    username: sa
    password:
    dirver-class-name: org.hsqldb.jdbc.JDBCDriver</code></pre>
<p>Spring Boot就会自动创建出DataSource、JdbcTemplate、DataSourceTransactionManager，非常方便。</p>
<p>但是，有时候，我们又必须要禁用某些自动配置。例如，系统有主从两个数据库，而Spring Boot的自动配置只能配一个，怎么办？</p>
<p>这个时候，针对DataSource相关的自动配置，就必须关掉。我们需要用exclude指定需要关掉的自动配置：</p>
<pre><code class="highlight java"><span class="meta">@SpringBootApplication</span>
<span class="comment">// 启动自动配置，但排除指定的自动配置:</span>
<span class="meta">@EnableAutoConfiguration(exclude = DataSourceAutoConfiguration.class)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;
    ...
&#125;</code></pre>
<p>现在，Spring Boot不再给我们自动创建DataSource、JdbcTemplate和DataSourceTransactionManager了，要实现主从数据库支持，怎么办？</p>
<p>让我们一步一步开始编写支持主从数据库的功能。首先，我们需要把主从数据库配置写到application.yml中，仍然按照Spring Boot默认的格式写，但datasource改为datasource-master和datasource-slave：</p>
<pre><code class="highlight yml"><span class="attr">spring:</span>
  <span class="attr">datasource-master:</span>
    <span class="attr">url:</span> <span class="string">jdbc:hsqldb:file:testdb</span>
    <span class="attr">username:</span> <span class="string">sa</span>
    <span class="attr">password:</span>
    <span class="attr">dirver-class-name:</span> <span class="string">org.hsqldb.jdbc.JDBCDriver</span>
  <span class="attr">datasource-slave:</span>
    <span class="attr">url:</span> <span class="string">jdbc:hsqldb:file:testdb</span>
    <span class="attr">username:</span> <span class="string">sa</span>
    <span class="attr">password:</span>
    <span class="attr">dirver-class-name:</span> <span class="string">org.hsqldb.jdbc.JDBCDriver</span></code></pre>
<p>注意到两个数据库实际上是同一个库。如果使用MySQL，可以创建一个只读用户，作为datasource-slave的用户来模拟一个从库。</p>
<p>下一步，我们分别创建两个HikariCP的DataSource：</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MasterDataSourceConfiguration</span> &#123;
    <span class="meta">@Bean(&quot;masterDataSourceProperties&quot;)</span>
    <span class="meta">@ConfigurationProperties(&quot;spring.datasource-master&quot;)</span>
    DataSourceProperties <span class="title function_">dataSourceProperties</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();
    &#125;

    <span class="meta">@Bean(&quot;masterDataSource&quot;)</span>
    DataSource <span class="title function_">dataSource</span><span class="params">(<span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;masterDataSourceProperties&quot;)</span> DataSourceProperties props)</span> &#123;
        <span class="keyword">return</span> props.initializeDataSourceBuilder().build();
    &#125;
&#125;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SlaveDataSourceConfiguration</span> &#123;
    <span class="meta">@Bean(&quot;slaveDataSourceProperties&quot;)</span>
    <span class="meta">@ConfigurationProperties(&quot;spring.datasource-slave&quot;)</span>
    DataSourceProperties <span class="title function_">dataSourceProperties</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();
    &#125;

    <span class="meta">@Bean(&quot;slaveDataSource&quot;)</span>
    DataSource <span class="title function_">dataSource</span><span class="params">(<span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;slaveDataSourceProperties&quot;)</span> DataSourceProperties props)</span> &#123;
        <span class="keyword">return</span> props.initializeDataSourceBuilder().build();
    &#125;
&#125;</code></pre>
<p>注意到上述class并未添加@Configuration和@Component，要使之生效，可以使用@Import导入：</p>
<pre><code class="highlight java"><span class="meta">@SpringBootApplication</span>
<span class="meta">@EnableAutoConfiguration(exclude = DataSourceAutoConfiguration.class)</span>
<span class="meta">@Import(&#123; MasterDataSourceConfiguration.class, SlaveDataSourceConfiguration.class&#125;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;
    ...
&#125;</code></pre>
<p>此外，上述两个DataSource的Bean名称分别为masterDataSource和slaveDataSource，我们还需要一个最终的@Primary标注的DataSource，它采用Spring提供的AbstractRoutingDataSource，代码实现如下：</p>
<pre><code class="highlight java"><span class="keyword">class</span> <span class="title class_">RoutingDataSource</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutingDataSource</span> &#123;
    <span class="meta">@Override</span>
    <span class="keyword">protected</span> Object <span class="title function_">determineCurrentLookupKey</span><span class="params">()</span> &#123;
        <span class="comment">// 从ThreadLocal中取出key:</span>
        <span class="keyword">return</span> RoutingDataSourceContext.getDataSourceRoutingKey();
    &#125;
&#125;</code></pre>
<p>RoutingDataSource本身并不是真正的DataSource，它通过Map关联一组DataSource，下面的代码创建了包含两个DataSource的RoutingDataSource，关联的key分别为masterDataSource和slaveDataSource：</p>
<pre><code class="highlight java">
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingDataSourceConfiguration</span> &#123;
    <span class="meta">@Primary</span>
    <span class="meta">@Bean</span>
    DataSource <span class="title function_">dataSource</span><span class="params">(</span>
<span class="params">            <span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;masterDataSource&quot;)</span> DataSource masterDataSource,</span>
<span class="params">            <span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;slaveDataSource&quot;)</span> DataSource slaveDataSource)</span> &#123;
        <span class="type">var</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoutingDataSource</span>();
        <span class="comment">// 关联两个DataSource:</span>
        ds.setTargetDataSources(Map.of(
                <span class="string">&quot;masterDataSource&quot;</span>, masterDataSource,
                <span class="string">&quot;slaveDataSource&quot;</span>, slaveDataSource));
        <span class="comment">// 默认使用masterDataSource:</span>
        ds.setDefaultTargetDataSource(masterDataSource);
        <span class="keyword">return</span> ds;
    &#125;

    <span class="meta">@Bean</span>
    JdbcTemplate <span class="title function_">jdbcTemplate</span><span class="params">(<span class="meta">@Autowired</span> DataSource dataSource)</span> &#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>(dataSource);
    &#125;

    <span class="meta">@Bean</span>
    DataSourceTransactionManager <span class="title function_">dataSourceTransactionManager</span><span class="params">(<span class="meta">@Autowired</span> DataSource dataSource)</span> &#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>(dataSource);
    &#125;
&#125;</code></pre>
<p>仍然需要自己创建JdbcTemplate和PlatformTransactionManager，注入的是标记为@Primary的RoutingDataSource。这样，我们通过如下的代码就可以切换RoutingDataSource底层使用的真正的DataSource：</p>
<pre><code class="highlight java">RoutingDataSourceContext.setDataSourceRoutingKey(<span class="string">&quot;slaveDataSource&quot;</span>);
jdbcTemplate.query(...);</code></pre>
<p>只不过写代码切换DataSource即麻烦又容易出错，更好的方式是通过注解配合AOP实现自动切换，这样，客户端代码实现如下：</p>
<pre><code class="highlight java"><span class="meta">@Controllerpublic</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;
        <span class="meta">@RoutingWithSlave</span> <span class="comment">// &lt;-- 指示在此方法中使用slave数据库</span>
        <span class="meta">@GetMapping(&quot;/profile&quot;)</span>
        <span class="keyword">public</span> ModelAndView <span class="title function_">profile</span><span class="params">(HttpSession session)</span> &#123;
        ...
    &#125;
&#125;</code></pre>
<p>实现上述功能需要编写一个@RoutingWithSlave注解，一个AOP织入和一个ThreadLocal来保存key。由于代码比较简单，这里我们不再详述。</p>
<p>如果我们想要确认是否真的切换了DataSource，可以覆写determineTargetDataSource()方法并打印出DataSource的名称：</p>
<pre><code class="highlight java"><span class="keyword">class</span> <span class="title class_">RoutingDataSource</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutingDataSource</span> &#123;
    ...

    <span class="meta">@Override</span>
    <span class="keyword">protected</span> DataSource <span class="title function_">determineTargetDataSource</span><span class="params">()</span> &#123;
        <span class="type">DataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="built_in">super</span>.determineTargetDataSource();
        logger.info(<span class="string">&quot;determin target datasource: &#123;&#125;&quot;</span>, ds);
        <span class="keyword">return</span> ds;
    &#125;
&#125;</code></pre>
<p>访问不同的URL，可以在日志中看到两个DataSource，分别是HikariPool-1和hikariPool-2：</p>
<pre><code class="highlight plaintext">2020-06-14 17:55:21.676  INFO 91561 --- [nio-8080-exec-7] c.i.learnjava.config.RoutingDataSource   : determin target datasource: HikariDataSource (HikariPool-1)
2020-06-14 17:57:08.992  INFO 91561 --- [io-8080-exec-10] c.i.learnjava.config.RoutingDataSource   : determin target datasource: HikariDataSource (HikariPool-2)</code></pre>
<p>我们用一个图来表示创建的DataSource以及相关Bean的关系：</p>
<p>注意到DataSourceTransactionManager和JdbcTemplate引用的都是RoutingDataSource，所以，这种设计的一个限制就是：在一个请求中，一旦切换了内部数据源，在同一个事务中，不能再切到另一个，否则，DataSourceTransactionManager和JdbcTemplate操作的就不是同一个数据库连接。</p>
<h3 id="使用profiles"><a class="markdownIt-Anchor" href="#使用profiles"></a> 使用Profiles</h3>
<p>Profile本身是Spring提供的功能，我们在使用条件装配中已经讲到了，Profile表示一个环境的概念，如开发、测试和生产这3个环境：</p>
<ul>
<li>native</li>
<li>test</li>
<li>production</li>
</ul>
<p>或者按git分支定义master、dev这些环境：</p>
<ul>
<li>master</li>
<li>dev在启动一个Spring应用程序的时候，可以传入一个或多个环境，例如：</li>
</ul>
<pre><code class="highlight plaintext">-Dspring.profiles.active=test,master</code></pre>
<p>大多数情况下，使用一个环境就足够了。</p>
<p>Spring Boot对Profiles的支持在于，可以在application.yml中为每个环境进行配置。下面是一个示例配置：</p>
<pre><code class="highlight yml"><span class="attr">spring:</span>
  <span class="attr">application:</span>
    <span class="attr">name:</span> <span class="string">$&#123;APP_NAME:unnamed&#125;</span>
  <span class="attr">datasource:</span>
    <span class="attr">url:</span> <span class="string">jdbc:hsqldb:file:testdb</span>
    <span class="attr">username:</span> <span class="string">sa</span>
    <span class="attr">password:</span>
    <span class="attr">dirver-class-name:</span> <span class="string">org.hsqldb.jdbc.JDBCDriver</span>
    <span class="attr">hikari:</span>
      <span class="attr">auto-commit:</span> <span class="literal">false</span>
      <span class="attr">connection-timeout:</span> <span class="number">3000</span>
      <span class="attr">validation-timeout:</span> <span class="number">3000</span>
      <span class="attr">max-lifetime:</span> <span class="number">60000</span>
      <span class="attr">maximum-pool-size:</span> <span class="number">20</span>
      <span class="attr">minimum-idle:</span> <span class="number">1</span>

<span class="attr">pebble:</span>
  <span class="attr">suffix:</span>
  <span class="attr">cache:</span> <span class="literal">false</span>

<span class="attr">server:</span>
  <span class="attr">port:</span> <span class="string">$&#123;APP_PORT:8080&#125;</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="attr">spring:</span>
  <span class="attr">config:</span>
    <span class="attr">activate:</span>
      <span class="attr">on-profile:</span> <span class="string">test</span>

<span class="attr">server:</span>
  <span class="attr">port:</span> <span class="number">8000</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="attr">spring:</span>
  <span class="attr">config:</span>
    <span class="attr">activate:</span>
      <span class="attr">on-profile:</span> <span class="string">production</span>

<span class="attr">server:</span>
  <span class="attr">port:</span> <span class="number">80</span>

<span class="attr">pebble:</span>
  <span class="attr">cache:</span> <span class="literal">true</span></code></pre>
<p>注意到分隔符—，最前面的配置是默认配置，不需要指定Profile，后面的每段配置都必须以spring.config.activate.on-profile.profiles: xxx开头，表示一个Profile。上述配置默认使用8080端口，但是在test环境下，使用8000端口，在production环境下，使用80端口，并且启用Pebble的缓存。</p>
<p>如果我们不指定任何Profile，直接启动应用程序，那么Profile实际上就是default，可以从Spring Boot启动日志看出：</p>
<pre><code class="highlight plaintext">...
2022-11-25T11:10:34.006+08:00  INFO 13537 --- [           main] com.itranswarp.learnjava.Application     : No active profile set, falling back to 1 default profile: &quot;default&quot;</code></pre>
<p>上述日志显示未设置Profile，使用默认的Profile为default。</p>
<p>要以test环境启动，可输入如下命令：</p>
<pre><code class="highlight plaintext">$ java -Dspring.profiles.active=test -jar springboot-profiles-1.0-SNAPSHOT.jar

...
2022-11-25T11:09:02.946+08:00  INFO 13510 --- [           main] com.itranswarp.learnjava.Application     : The following 1 profile is active: &quot;test&quot;
...
2022-11-25T11:09:05.124+08:00  INFO 13510 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8000 (http) with context path &#x27;&#x27;
...</code></pre>
<p>从日志看到活动的Profile是test，Tomcat的监听端口是8000。</p>
<p>通过Profile可以实现一套代码在不同环境启用不同的配置和功能。假设我们需要一个存储服务，在本地开发时，直接使用文件存储即可，但是，在测试和生产环境，需要存储到云端如S3上，如何通过Profile实现该功能？</p>
<p>首先，我们要定义存储接口StorageService：</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageService</span> &#123;

    <span class="comment">// 根据URI打开InputStream:</span>
    InputStream <span class="title function_">openInputStream</span><span class="params">(String uri)</span> <span class="keyword">throws</span> IOException;

    <span class="comment">// 根据扩展名+InputStream保存并返回URI:</span>
    String <span class="title function_">store</span><span class="params">(String extName, InputStream input)</span> <span class="keyword">throws</span> IOException;
&#125;</code></pre>
<p>本地存储可通过LocalStorageService实现：</p>
<pre><code class="highlight java"><span class="meta">@Component</span>
<span class="meta">@Profile(&quot;default&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalStorageService</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;
    <span class="meta">@Value(&quot;$&#123;storage.local:/var/static&#125;&quot;)</span>
    String localStorageRootDir;

    <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());

    <span class="keyword">private</span> File localStorageRoot;

    <span class="meta">@PostConstruct</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;
        logger.info(<span class="string">&quot;Intializing local storage with root dir: &#123;&#125;&quot;</span>, <span class="built_in">this</span>.localStorageRootDir);
        <span class="built_in">this</span>.localStorageRoot = <span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.localStorageRootDir);
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> InputStream <span class="title function_">openInputStream</span><span class="params">(String uri)</span> <span class="keyword">throws</span> IOException &#123;
        <span class="type">File</span> <span class="variable">targetFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.localStorageRoot, uri);
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(targetFile));
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">store</span><span class="params">(String extName, InputStream input)</span> <span class="keyword">throws</span> IOException &#123;
        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + <span class="string">&quot;.&quot;</span> + extName;
        <span class="type">File</span> <span class="variable">targetFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.localStorageRoot, fileName);
        <span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(targetFile))) &#123;
            input.transferTo(output);
        &#125;
        <span class="keyword">return</span> fileName;
    &#125;
&#125;</code></pre>
<p>而云端存储可通过CloudStorageService实现：</p>
<pre><code class="highlight java">
<span class="meta">@Component</span>
<span class="meta">@Profile(&quot;!default&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CloudStorageService</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;
    <span class="meta">@Value(&quot;$&#123;storage.cloud.bucket:&#125;&quot;)</span>
    String bucket;

    <span class="meta">@Value(&quot;$&#123;storage.cloud.access-key:&#125;&quot;)</span>
    String accessKey;

    <span class="meta">@Value(&quot;$&#123;storage.cloud.access-secret:&#125;&quot;)</span>
    String accessSecret;

    <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());

    <span class="meta">@PostConstruct</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;
        <span class="comment">// <span class="doctag">TODO:</span></span>
        logger.info(<span class="string">&quot;Initializing cloud storage...&quot;</span>);
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> InputStream <span class="title function_">openInputStream</span><span class="params">(String uri)</span> <span class="keyword">throws</span> IOException &#123;
        <span class="comment">// <span class="doctag">TODO:</span></span>
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;File not found: &quot;</span> + uri);
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">store</span><span class="params">(String extName, InputStream input)</span> <span class="keyword">throws</span> IOException &#123;
        <span class="comment">// <span class="doctag">TODO:</span></span>
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;Unable to access cloud storage.&quot;</span>);
    &#125;
&#125;</code></pre>
<p>注意到LocalStorageService使用了条件装配@Profile(“default”)，即默认启用LocalStorageService，而CloudStorageService使用了条件装配@Profile(“!default”)，即非default环境时，自动启用CloudStorageService。这样，一套代码，就实现了不同环境启用不同的配置。</p>
<h3 id="使用conditional"><a class="markdownIt-Anchor" href="#使用conditional"></a> 使用Conditional</h3>
<p>使用Profile能根据不同的Profile进行条件装配，但是Profile控制比较糙，如果想要精细控制，例如，配置本地存储，AWS存储和阿里云存储，将来很可能会增加Azure存储等，用Profile就很难实现。</p>
<p>Spring本身提供了条件装配@Conditional，但是要自己编写比较复杂的Condition来做判断，比较麻烦。Spring Boot则为我们准备好了几个非常有用的条件：</p>
<ul>
<li>@ConditionalOnProperty：如果有指定的配置，条件生效；</li>
<li>@ConditionalOnBean：如果有指定的Bean，条件生效；</li>
<li>@ConditionalOnMissingBean：如果没有指定的Bean，条件生效；</li>
<li>@ConditionalOnMissingClass：如果没有指定的Class，条件生效；</li>
<li>@ConditionalOnWebApplication：在Web环境中条件生效；</li>
<li>@ConditionalOnExpression：根据表达式判断条件是否生效。</li>
</ul>
<p>我们以最常用的@ConditionalOnProperty为例，把上一节的StorageService改写如下。首先，定义配置storage.type=xxx，用来判断条件，默认为local：</p>
<pre><code class="highlight plaintext">storage:
  type: $&#123;STORAGE_TYPE:local&#125;</code></pre>
<p>设定为local时，启用LocalStorageService：</p>
<pre><code class="highlight java"><span class="meta">@Component</span>
<span class="meta">@ConditionalOnProperty(value = &quot;storage.type&quot;, havingValue = &quot;local&quot;, matchIfMissing = true)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalStorageService</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;
    ...
&#125;</code></pre>
<p>设定为aws时，启用AwsStorageService：</p>
<pre><code class="highlight java"><span class="meta">@Component</span>
<span class="meta">@ConditionalOnProperty(value = &quot;storage.type&quot;, havingValue = &quot;aws&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AwsStorageService</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;
    ...
&#125;</code></pre>
<p>设定为aliyun时，启用AliyunStorageService：</p>
<pre><code class="highlight java"><span class="meta">@Component</span>
<span class="meta">@ConditionalOnProperty(value = &quot;storage.type&quot;, havingValue = &quot;aliyun&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunStorageService</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;
    ...
&#125;</code></pre>
<p>注意到LocalStorageService的注解，当指定配置为local，或者配置不存在，均启用LocalStorageService。</p>
<h3 id="lombok"><a class="markdownIt-Anchor" href="#lombok"></a> Lombok</h3>
<p>lombok是一个自动生成getter/setter/toString等方法的一个idea插件</p>
<p><strong>lombok插件安装</strong></p>
<p><strong>添加依赖</strong></p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<p><strong>使用</strong></p>
<ul>
<li>添加<code>@Data</code>注解即可</li>
</ul>
<pre><code class="highlight java"><span class="meta">@Data</span>
<span class="meta">@NoArgsConstructor</span>     <span class="comment">//没有参数的构造方法</span>
<span class="meta">@AllArgsConstructor</span>     <span class="comment">//全部参数的构造方法</span>
<span class="keyword">public</span> <span class="keyword">void</span> Student&#123;
    <span class="keyword">private</span> <span class="type">int</span> id;
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> <span class="type">int</span> age;
    
    <span class="comment">//剩下的代码lombok会自动生成</span>
&#125;</code></pre>
<h3 id="读取自定义配置"><a class="markdownIt-Anchor" href="#读取自定义配置"></a> 读取自定义配置</h3>
<p>自定义配置，可以是定义在主配置文件application.properties中的自定义属性，也可以是自定义配置文件中的属性。</p>
<ul>
<li>通过@Value(“${ }”)读取指定的自定义属性</li>
<li>若要读取自定义配置文件，则需要在该读取类上添加@PropertySource注解</li>
<li>自定义配置文件不能是yml文件，只能是properties</li>
</ul>
<h4 id="读取配置文件中的属性"><a class="markdownIt-Anchor" href="#读取配置文件中的属性"></a> 读取配置文件中的属性</h4>
<p>修改主配置文件：<code>application.properties</code></p>
<pre><code class="highlight plaintext">student.name=张三</code></pre>
<p>在类中读取：</p>
<pre><code class="highlight java"><span class="meta">@Controller</span>
<span class="meta">@RequestMapping(&quot;/test&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomeHandler</span>&#123;
    <span class="meta">@Value(&quot;$&#123;student.name&#125;&quot;)</span>
    <span class="keyword">private</span> String name;

    <span class="meta">@GetMapping(&quot;some&quot;)</span>
    <span class="meta">@ResponseBody</span>
    <span class="keyword">public</span> String <span class="title function_">someHandler</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> name;
    &#125;
&#125;</code></pre>
<h4 id="读取指定配置文件中的属性"><a class="markdownIt-Anchor" href="#读取指定配置文件中的属性"></a> 读取指定配置文件中的属性</h4>
<p>一般情况下，主配置文件中存放系统中定义好的属性设置，而自定义属性一般会写入自定义的配置文件中。也就是说，Java代码除了可以读取主配置文件中的属性外，还可以读取指定配置文件中的属性，可以通过@PropertySource注解加载指定的配置文件。</p>
<blockquote>
<p>spring boot官网给出说明，@PropertySource注解不能加载yml文件。所以其建议自定快速开发框架 自定义配置文件就使用属性文件。</p>
</blockquote>
<p><strong>自定义配置文件</strong></p>
<p>定义配置文件<code>myapp.properties</code>，存放在src/main/resource目录中</p>
<pre><code class="highlight plaintext">student.name=张三</code></pre>
<p><strong>类中取值</strong></p>
<p>使用<code>@PropertySource</code>注解，若属性的值存在中文，则需要添加encoding属性</p>
<pre><code class="highlight java"><span class="meta">@Controller</span>
<span class="meta">@RequestMapping(&quot;/test&quot;)</span>
<span class="meta">@PropertySource(value=&quot;classpath:myapp.properties&quot;,encoding=&quot;utf-8&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomeHandler</span>&#123;
    <span class="meta">@Value(&quot;$&#123;student.name&#125;&quot;)</span>
    <span class="keyword">private</span> String name;

    <span class="meta">@GetMapping(&quot;some&quot;)</span>
    <span class="meta">@ResponseBody</span>
    <span class="keyword">public</span> String <span class="title function_">someHandler</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> name;
    &#125;
&#125;</code></pre>
<h4 id="读取对象属性"><a class="markdownIt-Anchor" href="#读取对象属性"></a> 读取对象属性</h4>
<p><code>myapp.properties</code></p>
<pre><code class="highlight plaintext">student.name=zhangsan
student.age=24
student.score=93.5</code></pre>
<p><strong>类中读取值</strong></p>
<ul>
<li><code>@ProertySource</code>用于指定要读取的配置文件</li>
<li><code>@ConfigurationProperties</code>用于指定要读取配置文件中的对象属性</li>
<li><code>@Component</code>表示当前从配置文件读取来的对象，由Spring容器创建</li>
</ul>
<blockquote>
<p>这里的类名可以随便起，不用和配置文件相同，但是成员变量名必须相同</p>
</blockquote>
<pre><code class="highlight java"><span class="meta">@Component</span>
<span class="meta">@PropertySource(value=&quot;classpath:myapp.properties&quot;,encoding=&quot;utf-8&quot;)</span>
<span class="meta">@ConfigurationProperties(&quot;student&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span>&#123;
    
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> <span class="type">int</span> age;
    <span class="keyword">private</span> <span class="type">double</span> score;

    <span class="comment">//getter and setter</span>
&#125;</code></pre>
<h4 id="读取list-string"><a class="markdownIt-Anchor" href="#读取list-string"></a> 读取List-String</h4>
<p><code>myapp.properties</code></p>
<pre><code class="highlight properties"><span class="attr">country.cities[0]</span>=<span class="string">beijing</span>
<span class="attr">country.cities[1]</span>=<span class="string">shanghai</span>
<span class="attr">country.cities[2]</span>=<span class="string">xian</span></code></pre>
<p><strong>在类中取值</strong></p>
<pre><code class="highlight java"><span class="meta">@Component</span> <span class="meta">@PropertySource(value=&quot;classpath:myapp.properties&quot;,encoding=&quot;utf-8&quot;)</span> <span class="meta">@ConfigurationProperties(&quot;country&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Country</span>&#123;
    <span class="keyword">private</span> List&lt;String&gt; cities;
    
    <span class="comment">//getter and setter</span>
&#125;</code></pre>
<h4 id="读取list-object"><a class="markdownIt-Anchor" href="#读取list-object"></a> 读取List-Object</h4>
<p><code>myapp.properties</code></p>
<pre><code class="highlight properties"><span class="attr">group.students[0].name</span>=<span class="string">zhangdan</span>
<span class="attr">group.students[0].age</span>=<span class="string">23</span>
<span class="attr">group.students[0].score</span>=<span class="string">93</span>

<span class="attr">group.students[1].name</span>=<span class="string">lisi</span>
<span class="attr">group.students[1].age</span>=<span class="string">25</span>
<span class="attr">group.students[1].score</span>=<span class="string">80</span>

<span class="attr">group.students[2].name</span>=<span class="string">wangwu</span>
<span class="attr">group.students[2].age</span>=<span class="string">26</span>
<span class="attr">group.students[2].score</span>=<span class="string">99</span></code></pre>
<p><strong>在类中取值</strong></p>
<blockquote>
<p>Student类无需任何注解</p>
</blockquote>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span>&#123;
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> <span class="type">int</span> age;
    <span class="keyword">private</span> <span class="type">double</span> score;
    
    <span class="comment">//getter and setter</span>
&#125;</code></pre>
<pre><code class="highlight java"><span class="meta">@Component</span> <span class="meta">@PropertySource(value=&quot;classpath:myapp.properties&quot;,encoding=&quot;utf-8&quot;)</span> <span class="meta">@ConfigurationProperties(&quot;group&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Country</span>&#123;
    <span class="keyword">private</span> List&lt;Student&gt; student;
    
    <span class="comment">//getter and setter</span>
&#125;</code></pre>
<h3 id="jsp"><a class="markdownIt-Anchor" href="#jsp"></a> JSP</h3>
<p>在Spring Boot下直接使用JSP文件，其是无法解析的，需要做专门的配置。</p>
<p>spring boot的默认视图支持使Thymeleaf</p>
<ul>
<li>在pom文件中注册JSP解析器依赖</li>
<li>在pom文件中注册资源目录</li>
<li>在主配置文件中注册视图前辍与后辍（不是必须的）</li>
</ul>
<h4 id="1-直接添加jsp文件"><a class="markdownIt-Anchor" href="#1-直接添加jsp文件"></a> 1 直接添加JSP文件</h4>
<p><strong>创建webapp目录</strong></p>
<p>在src/main下创建webapp目录，用于存放jsp文件。这就是一个普通的目录，无需执行Mark Directory As。</p>
<p><strong>创建index.jsp</strong></p>
<p>在spring boot工程中若要创建jsp文件，一般是需要在src/main下创建webapp目录，然后在该目录下创建jsp文件。但通过Alt + Insert发现没有创建jsp文件的选项。此时，需要打开Project Structrue窗口，将webapp目录指定为web资源目录，然后才可以创建jsp文件</p>
<p>指定后便可看到下面的窗口情况。</p>
<p>此时，便可在webapp中找到jsp的创建选项了。</p>
<p>创建index页面</p>
<p>此时启动工程后在浏览器直接访问，发现其并没有显示index页面。因为当前工程不能识别jsp文件</p>
<h4 id="2-使用物理视图"><a class="markdownIt-Anchor" href="#2-使用物理视图"></a> 2 使用物理视图</h4>
<p><strong>添加jasper依赖</strong></p>
<p>在pom中添加一个Tomcat内嵌的jsp引擎jasper依赖。jsp引擎是用于解析jsp文件的，即将jsp文件解析为Servlet是由jsp引擎完成的。embed，嵌入。</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> 
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> 
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> 
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
</code></pre>
<p><strong>注册webapp目录</strong></p>
<p>在pom文件中将webapp目录注册为资源目录。</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">build</span>&gt;</span>
    <span class="comment">&lt;!--spring提供的打包插件--&gt;</span>
    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>
        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>
    <span class="comment">&lt;!--注册webapp目录为资源目录--&gt;</span>
    <span class="tag">&lt;<span class="name">resources</span>&gt;</span>
        <span class="tag">&lt;<span class="name">resource</span>&gt;</span>
            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/webapp<span class="tag">&lt;/<span class="name">directory</span>&gt;</span>
            <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>META-INF/resource<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span>
            <span class="tag">&lt;<span class="name">includes</span>&gt;</span>
                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span>
<span class="tag">&lt;/<span class="name">build</span>&gt;</span></code></pre>
<p>不过，我们一般会注册两个目录：还会注册dao包下的mybatis映射文件为资源目录</p>
<pre><code class="highlight xml"><span class="comment">&lt;!--注册dao包下mybatis映射文件为资源目录--&gt;</span>
<span class="tag">&lt;<span class="name">resource</span>&gt;</span>
    <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span>
    <span class="tag">&lt;<span class="name">includes</span>&gt;</span>
        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">includes</span>&gt;</span>
<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></code></pre>
<p><strong>创建welcome.jsp</strong></p>
<p>在webapp目录下再创建一个子目录jsp，在其中创建welcome.jsp文件。</p>
<p><strong>编写controller类</strong></p>
<p><strong>访问</strong></p>
<h4 id="3-使用逻辑视图"><a class="markdownIt-Anchor" href="#3-使用逻辑视图"></a> 3 使用逻辑视图</h4>
<p>修改主配置文件<code>application.properties</code></p>
<pre><code class="highlight properties"><span class="attr">spring.mvc.view.prefix</span>=<span class="string">/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span></code></pre>
<p>修改Controller</p>
<blockquote>
<p><strong>关于静态资源请求</strong></p>
</blockquote>
<p>查看控制台的启动日志，DispatcherServlet的<url-pattern>为/。我们之前在学习SpringMVC时强调过，若DispatcherServlet的<url-pattern>为/，则中央调度器会拦截静态资源，即所有静态资源是无法访问的，若要访问，则需要再行配置。但，通过前面的运行可知，Spring Boot对于静态资源的访问是没有问题的。即，Spring Boot已经处理好了静态资源访问问题。</p>
<h3 id="mybatis"><a class="markdownIt-Anchor" href="#mybatis"></a> MyBatis</h3>
<p>在Spring Boot中使用MyBatis无需定义MyBatis的主配置文件，需要完成以下三个步骤：</p>
<ul>
<li>在pom文件中导入三个依赖：MyBatis与Spring Boot整合依赖、MySQL驱动依赖，及Druid依赖</li>
<li>在Spring Boot主配置文件中注册三个信息：映射文件、实体类别名，及数据源</li>
<li>在Dao接口上添加@Mapper注解</li>
</ul>
<p><strong>pom.xml依赖</strong></p>
<blockquote>
<p>注意，<code>spring boot与mybaits整合依赖</code>这个依赖是由mybatis开发，并非由Spring开发，所以这里需要指明版本号。因为父工程中没有定义该版本号。</p>
</blockquote>
<blockquote>
<p>注意，<code>mysql驱动依赖</code>该依赖要指定版本号，若不指定其也会从父工程中继承，但版本过高，代码运行</p>
</blockquote>
<pre><code class="highlight xml"><span class="comment">&lt;!--spring boot与mybaits整合依赖--&gt;</span>
 <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
 <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
 <span class="comment">&lt;!--mysql驱动依赖--&gt;</span>
 <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
     <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
 <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
 <span class="comment">&lt;!--阿里连接池--&gt;</span>
 <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
 <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<p><strong>注册dao包下mybatis映射文件为资源目录</strong></p>
<pre><code class="highlight xml"><span class="comment">&lt;!--注册dao包下mybatis映射文件为资源目录--&gt;</span>
<span class="tag">&lt;<span class="name">build</span>&gt;</span>
    <span class="tag">&lt;<span class="name">resource</span>&gt;</span>
        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span>
        <span class="tag">&lt;<span class="name">includes</span>&gt;</span>
            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span>
<span class="tag">&lt;/<span class="name">build</span>&gt;</span></code></pre>
<p><strong>定义Service接口及实现类</strong></p>
<p>service接口</p>
<p>service实现类</p>
<p><strong>定义实体类和数据库表</strong></p>
<p>定义实体类</p>
<p>在DB的test数据库中定义student</p>
<p><strong>定义Dao接口和映射文件</strong></p>
<p>Dao接口上要添加@Mapper注解。</p>
<p>映射文件</p>
<p><strong>定义Controller</strong></p>
<p><strong>修改主配置文件</strong></p>
<ul>
<li>注册映射文件</li>
<li>注册实体类别名</li>
<li>注册数据源</li>
</ul>
<p><code>application.properties</code></p>
<pre><code class="highlight properties"><span class="comment"># 配置jsp的寻找路径 </span>
<span class="attr">spring.mvc.view.prefix</span>=<span class="string">/ </span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp </span>
<span class="comment"></span>
<span class="comment">#注册映射文件</span>
<span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:com/abc/primary/dao/*.xml</span>
<span class="comment">#注册实体类别名</span>
<span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.abc.primary.beans</span>
<span class="comment"></span>
<span class="comment"></span>
<span class="comment">#datasource数据源 </span>
<span class="attr">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span>
<span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver </span>
<span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/lee_test?characterEncoding=UTF-8 </span>
<span class="attr">spring.datasource.username</span>=<span class="string">root </span>
<span class="attr">spring.datasource.password</span>=<span class="string">admin </span>
<span class="comment"></span>
<span class="comment"></span>
<span class="comment">#新增数据库链接必须的参数 </span>
<span class="attr">spring.jpa.properties.hibernate.hbm2ddl.auto</span>=<span class="string">update</span>
</code></pre>
<h3 id="对事务的支持"><a class="markdownIt-Anchor" href="#对事务的支持"></a> 对事务的支持</h3>
<p>Spring Boot对于事务的支持，只需完成两个步骤：</p>
<ul>
<li>在<strong>启动类</strong>上添加<code>@EnableTransactionManagement</code>注解，开启事务</li>
<li>在Service<strong>实现类</strong>的方法上添加<code>@Transactional</code>注解</li>
</ul>
<p><strong>修改启动类</strong></p>
<pre><code class="highlight java"><span class="meta">@SpringBootApplication</span>
<span class="meta">@EnableTransactionManagement</span>   <span class="comment">//开启事务</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootdemoApplication</span> &#123;

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
        SpringApplication.run(SpringbootdemoApplication.class, args);
    &#125;
&#125;</code></pre>
<p><strong>修改Service启动类</strong></p>
<pre><code class="highlight java">
<span class="meta">@Service</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ISomeService</span> &#123;
    
    <span class="meta">@Autowired</span>
    <span class="keyword">private</span> IStudentDao dao;
    
    <span class="meta">@Transactional</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStudent</span><span class="params">(Student student)</span>&#123;
        <span class="comment">//该插入会发生回滚，无法插入到db</span>
        dao.insertStudent(student);
        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span> / <span class="number">0</span>;      <span class="comment">//抛出异常语句</span>
        dao.insertStudent(student);
    &#125;
&#125;</code></pre>
<p><strong>正常测试</strong></p>
<p>以上代码运行后，页面与代码均会显示报错，查看DB表，没有任何记录插入。</p>
<p><strong>对比测试</strong></p>
<p>将Service实现类中的@Transactional注解注释掉，再运行，页面与代码仍均会显示报错，但查看DB表，会发现插入了一条记录，即异常前的插入语句没有回滚。</p>
<h3 id="对日志的控制"><a class="markdownIt-Anchor" href="#对日志的控制"></a> 对日志的控制</h3>
<p>Spring Boot中使用的日志技术为logback。其与Log4J都出自同一人，性能要优于Log4J，是Log4J的替代者。</p>
<p>在Spring Boot中若要使用logback，则需要具有spring-boot-starter-logging依赖，而该依赖被spring-boot-starter-web所依赖，即不用直接导入spring-boot-starter-logging依赖。</p>
<p><strong>方式一：添加配置属性</strong></p>
<pre><code class="highlight properties"><span class="comment">#日志显示格式</span>
<span class="attr">logging.pattern.console</span>:<span class="string">%level %msg%n</span>
<span class="comment">#减少项目启动时的日志输出</span>
<span class="attr">logging.level.root</span>:<span class="string">warn</span>
<span class="comment">#显示Dao层执行的sql语句</span>
<span class="attr">logging.level.com.bjpowernode.primary.dao</span>:<span class="string">debug</span></code></pre>
<blockquote>
<p>注意，在日志显示格式的属性值前面的xxx:是随意内容。在yml文件中的属性值若以%开头会报错，所以添加一些随意字符。在properties文件中不存在该问题。</p>
</blockquote>
<p><strong>方式二：添加配置文件</strong></p>
<p>该文件名为logback.xml，且必须要放在src/main/resources类路径下。</p>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version= <span class="string">&quot;1.0&quot;</span> encoding= <span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;myConsoLe&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoLeAppender&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span>
            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%-5level - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span>
    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;myConsole&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">root</span>&gt;</span>
    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.bjpowernode.primary.dao&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span>
<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<p><strong>使用</strong></p>
<h3 id="redis"><a class="markdownIt-Anchor" href="#redis"></a> Redis</h3>
<p>使用Redis缓存的数据划分为两类：</p>
<ul>
<li>DB中相关表更新后，Redis缓存中的存放的相关数据要清除，否则客户端获取到的就不是最新数据，这是一类数据；</li>
<li>还有一类数据是，对数据的准确性要求不是很高的数据，其可以与DB中数据不一致，但差别不能太大，所以该类数据一般会设置过期时效。</li>
</ul>
<p>Spring Boot对于以上两类数据，均可使用API方式与注解方式进行缓存。但Spring Boot使用注解方式在对指定缓存空间设置缓存时效时非常麻烦，所以对于两类数据的缓存可以分别使用两种方式实现。</p>
<h4 id="注解详解"><a class="markdownIt-Anchor" href="#注解详解"></a> 注解详解</h4>
<h5 id="cacheable"><a class="markdownIt-Anchor" href="#cacheable"></a> @Cacheable</h5>
<p>@Cacheable可以标记在一个<strong>方法</strong>上，也可以标记在一个<strong>类</strong>上。当标记在一个方法上时表示该方法是<strong>支持缓存</strong>的，当标记在一个类上时则表示该类所有的方法都是支持缓存的。对于一个支持缓存的方法，<strong>Spring会在其被调用后将其返回值缓存起来，以保证下次利用同样的参数来执行该方法时可以直接从缓存中获取结果，而不需要再次执行该方法</strong>。Spring在缓存方法的返回值时是以键值对进行缓存的，值就是方法的返回结果，至于键的话，Spring又支持两种策略，默认策略和自定义策略，这个稍后会进行说明。需要注意的是当一个支持缓存的方法在对象内部被调用时是不会触发缓存功能的。@Cacheable可以指定三个属性，value、key和condition。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>缓存的名称，在 spring 配置文件中定义，必须指定至少一个</td>
<td>例如: @Cacheable(value=”mycache”) @Cacheable(value={”cache1”,”cache2”}</td>
</tr>
<tr>
<td>key</td>
<td>缓存的 key，可以为空，如果指定要按照 SpEL 表达式编写，如果不指定，则缺省按照方法的所有参数进行组合</td>
<td>@Cacheable(value=”testcache”,key=”#userName”)</td>
</tr>
<tr>
<td>condition</td>
<td>缓存的条件，可以为空，使用 SpEL 编写，返回 true 或者 false，只有为 true 才进行缓存</td>
<td><code>@Cacheable(value=”testcache”,condition=”#userName.length()&gt;2”)</code></td>
</tr>
</tbody>
</table>
<p><strong>value属性指定Cache名称</strong></p>
<p>value属性是必须指定的，其表示当前方法的返回值是会被缓存在哪个Cache上的，对应Cache的名称。其可以是一个Cache也可以是多个Cache，当需要指定多个Cache时其是一个数组。</p>
<pre><code class="highlight java"><span class="meta">@Cacheable(&quot;cache1&quot;)</span><span class="comment">//Cache是发生在cache1上的</span>
   <span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;
      returnnull;
   &#125;
  <span class="meta">@Cacheable(&#123;&quot;cache1&quot;, &quot;cache2&quot;&#125;)</span><span class="comment">//Cache是发生在cache1和cache2上的</span>
   <span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;
      returnnull;
   &#125;</code></pre>
<p><strong>key使用示例</strong></p>
<p>key属性是用来指定Spring缓存方法的返回结果时对应的key的。该属性支持SpringEL表达式。当我们没有指定该属性时，Spring将使用默认策略生成key。我们这里先来看看自定义策略，至于默认策略会在后文单独介绍。<br />
自定义策略是指我们可以通过Spring的EL表达式来指定我们的key。这里的EL表达式可以使用方法参数及它们对应的属性。使用方法参数时我们可以直接使用“#参数名”或者“#p参数index”。下面是几个使用参数作为key的示例。</p>
<pre><code class="highlight java"><span class="comment">/**</span>
<span class="comment">* key 是指传入时的参数</span>
<span class="comment">*</span>
<span class="comment">*/</span>
   <span class="meta">@Cacheable(value=&quot;users&quot;, key=&quot;#id&quot;)</span>
   <span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;
      returnnull;
   &#125;
<span class="comment">// 表示第一个参数</span>
  <span class="meta">@Cacheable(value=&quot;users&quot;, key=&quot;#p0&quot;)</span>
   <span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;
      returnnull;
   &#125;
<span class="comment">// 表示User中的id值</span>
   <span class="meta">@Cacheable(value=&quot;users&quot;, key=&quot;#user.id&quot;)</span>
   <span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(User user)</span> &#123;
      returnnull;
   &#125;
 <span class="comment">// 表示第一个参数里的id属性值</span>
   <span class="meta">@Cacheable(value=&quot;users&quot;, key=&quot;#p0.id&quot;)</span>
   <span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(User user)</span> &#123;
      returnnull;
   &#125;
</code></pre>
<blockquote>
<p>除了上述使用方法参数作为key之外，Spring还为我们提供了一个root对象可以用来生成key。通过该root对象我们可以获取到以下信息。</p>
</blockquote>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>methodName</td>
<td>当前方法名</td>
<td>#root.methodName</td>
</tr>
<tr>
<td>method</td>
<td>当前方法</td>
<td>#<a target="_blank" rel="noopener" href="http://root.method.name">root.method.name</a></td>
</tr>
<tr>
<td>target</td>
<td>当前被调用的对象</td>
<td>#root.target</td>
</tr>
<tr>
<td>targetClass</td>
<td>当前被调用的对象的class</td>
<td>#root.targetClass</td>
</tr>
<tr>
<td>args</td>
<td>当前方法参数组成的数组</td>
<td>#root.args[0]</td>
</tr>
<tr>
<td>caches</td>
<td>当前被调用的方法使用的Cache</td>
<td>#root.caches[0].name</td>
</tr>
</tbody>
</table>
<blockquote>
<p>当我们要使用root对象的属性作为key时我们也可以将“#root”省略，因为Spring默认使用的就是root对象的属性</p>
</blockquote>
<p><strong>自定义key值的默认值</strong></p>
<pre><code class="highlight java"><span class="meta">@Configuration</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCacheConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;

    <span class="comment">//自动生成key的结构，类名_方法名_参数值</span>
    <span class="keyword">public</span> KeyGenerator <span class="title function_">keyGenerator</span><span class="params">()</span> &#123;
        <span class="comment">//函数式接口的写法</span>
        <span class="keyword">return</span> (target,method, params) -&gt;&#123;
            <span class="comment">//获取注解所标方法所在的类名</span>
            <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> target.getClass().getName();
            <span class="comment">//获取注解所标方法的方法名</span>
            <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> method.getName();
            <span class="keyword">return</span> className+<span class="string">&quot;_&quot;</span>+methodName+<span class="string">&quot;_&quot;</span>+params[<span class="number">0</span>].toString();
        &#125;;
    &#125;
&#125;</code></pre>
<p><strong>condition属性指定发生的条件</strong></p>
<p>有的时候我们可能并不希望缓存一个方法所有的返回结果。通过condition属性可以实现这一功能。condition属性默认为空，表示将缓存所有的调用情形。其值是通过SpringEL表达式来指定的，当为true时表示进行缓存处理；当为false时表示不进行缓存处理，即每次调用该方法时该方法都会执行一次。如下示例表示只有当user的id为偶数时才会进行缓存</p>
<pre><code class="highlight java"><span class="comment">// 根据条件判断是否缓存</span>
 <span class="meta">@Cacheable(value=&#123;&quot;users&quot;&#125;, key=&quot;#user.id&quot;, condition=&quot;#user.id%2==0&quot;)</span>
<span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(User user)</span> &#123;
   System.out.println(<span class="string">&quot;find user by user &quot;</span> + user);
   <span class="keyword">return</span> user;
&#125;</code></pre>
<h5 id="cacheput"><a class="markdownIt-Anchor" href="#cacheput"></a> @CachePut</h5>
<p>在支持Spring Cache的环境下，对于使用@Cacheable标注的方法，Spring在每次执行前都会检查Cache中是否存在相同key的缓存元素，如果存在就不再执行该方法，而是直接从缓存中获取结果进行返回，否则才会执行并将返回结果存入指定的缓存中。@CachePut也可以声明一个方法支持缓存功能。<strong>与@Cacheable不同的是使用@CachePut标注的方法在执行前不会去检查缓存中是否存在之前执行过的结果，而是每次都会执行该方法，并将执行结果以键值对的形式存入指定的缓存中</strong></p>
<pre><code class="highlight java"><span class="comment">//@CachePut也可以标注在类上和方法上。使用@CachePut时我们可以指定的属性跟@Cacheable是一样的。</span>
   <span class="meta">@CachePut(&quot;users&quot;)</span><span class="comment">//每次都会执行方法，并将结果存入指定的缓存中</span>
   <span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;
      returnnull;
   &#125;
</code></pre>
<h5 id="cacheevict"><a class="markdownIt-Anchor" href="#cacheevict"></a> @CacheEvict</h5>
<p>@CacheEvict是用来标注在需要清除缓存元素的方法或类上的。当标记在一个类上时表示其中所有的方法的<strong>执行都会触发缓存的清除操作</strong>。@CacheEvict可以指定的属性有value、key、condition、allEntries和beforeInvocation。其中value、key和condition的语义与@Cacheable对应的属性类似。即<strong>value表示清除操作是发生在哪些Cache上的</strong>（对应Cache的名称）；<strong>key表示需要清除的是哪个key</strong>，如未指定则会使用默认策略生成的key；condition表示清除操作发生的条件。下面我们来介绍一下新出现的两个属性allEntries和beforeInvocation。</p>
<p><strong>allEntries属性</strong></p>
<p>allEntries是boolean类型，表示是否需要清除缓存中的所有元素。默认为false，表示不需要。当指定了allEntries为true时，Spring Cache将忽略指定的key。有的时候我们需要Cache一下清除所有的元素，这比一个一个清除元素更有效率。</p>
<pre><code class="highlight java"><span class="meta">@CacheEvict(value=&quot;users&quot;, allEntries=true)</span>
<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> &#123;
    System.out.println(<span class="string">&quot;delete user by id: &quot;</span> + id);
&#125;</code></pre>
<p><strong>beforeInvocation属性</strong></p>
<p>清除操作默认是在对应方法成功执行之后触发的，即方法如果因为抛出异常而未能成功返回时也不会触发清除操作。使用beforeInvocation可以改变触发清除操作的时间，当我们指定该属性值为true时，Spring会在调用该方法之前清除缓存中的指定元素。</p>
<pre><code class="highlight java"><span class="meta">@CacheEvict(value=&quot;users&quot;, beforeInvocation=true)</span>
<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> &#123;
   System.out.println(<span class="string">&quot;delete user by id: &quot;</span> + id);
&#125;</code></pre>
<h5 id="caching"><a class="markdownIt-Anchor" href="#caching"></a> @Caching</h5>
<p>@Caching注解可以让我们在一个方法或者类上同时指定多个Spring Cache相关的注解。其拥有三个属性：cacheable、put和evict，分别用于指定@Cacheable、@CachePut和@CacheEvict。</p>
<pre><code class="highlight java"><span class="meta">@Caching(cacheable = @Cacheable(&quot;users&quot;), evict = &#123; @CacheEvict(&quot;cache2&quot;),</span>
<span class="meta">@CacheEvict(value = &quot;cache3&quot;, allEntries = true) &#125;)</span>
<span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;
  returnnull;
&#125;</code></pre>
<h4 id="总步骤"><a class="markdownIt-Anchor" href="#总步骤"></a> 总步骤</h4>
<p>（1） <strong>都需要的步骤</strong></p>
<ul>
<li>在pom文件中添加spring boot与redis整合依赖</li>
<li>在主配置文件中注册redis连接信息、MyBatis中实体类的别名</li>
<li>由于要将查询的实体类对象缓存到Redis，Redis要求实体类必须序列化。所以需要实体类实现序列化接口</li>
</ul>
<p>（2） <strong>使用注解方式还需要的步骤</strong></p>
<ul>
<li>在工程入口类上添加<code>@EnableCaching</code>注解</li>
<li>在查询方法上添加<code>@Cacheable</code>注解，在增删改方法上添加<code>@CacheEvict</code>注解</li>
<li>在主配置文件中注册缓存空间名称</li>
</ul>
<p>（3） <strong>使用API方式还需要的步骤</strong></p>
<ul>
<li>Service中被自动注入的RedisTemplate需要的泛型，key与value要求类型相同，要么都是String，要么都是Object。建议使用Object，其通用性更好</li>
<li>在Service的查询方法中通过RedisTemplate对象获取到Redis的操作对象，然后再对Redis进行读写操作</li>
</ul>
<h4 id="依赖配置"><a class="markdownIt-Anchor" href="#依赖配置"></a> 依赖/配置</h4>
<p><strong>pom依赖</strong></p>
<p>在pom中添加spring boot与Redis整合依赖</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<p><strong>修改主配置文件</strong></p>
<pre><code class="highlight properties"><span class="comment">#连接单机Redis</span>
<span class="attr">spring.redis.host</span>=<span class="string">osRedis</span>
<span class="attr">spring.redis.port</span>=<span class="string">6379</span>
<span class="attr">spring.redis.password</span>=<span class="string">111</span>
<span class="comment">#连接redis高可用集群</span>
<span class="comment">#spring.redis.sentinel.master=mymaster</span>
<span class="comment">#spring.redis.sentinel.nodes=sentinel1:26379,sentinel2:26379,sentinel3:26379</span>
<span class="comment"></span>
<span class="comment">#开启缓存，指定cache类型</span>
<span class="attr">spring.cache.type</span>=<span class="string">redis</span>
<span class="comment">#缓存区域名</span>
<span class="attr">spring.cache.cache-names</span>=<span class="string">realTimeCache</span></code></pre>
<h4 id="类编写"><a class="markdownIt-Anchor" href="#类编写"></a> 类编写</h4>
<p>当前工程完成让用户在页面中输入要查询学生的id，其首先会查看Redis缓存中是否存在，若存在，则直接从Redis中读取；若不存在，则先从DB中查询出来，然后再存放到Redis缓存中。但用户也可以通过页面注册学生，一旦有新的学生注册，则需要将缓存中的学生信息清空。根据id查询出的学生信息要求必须是实时性的，其适合使用注解方式的Redis缓存。</p>
<p>同时，通过页面还可以查看到总学生数，但对其要求是差不多就行，无需是实时性的。对于Spring Boot工程，其适合使用API方式的Redis缓存，该方式方便设置缓存的到期时限。</p>
<p><strong>工程入口类添加@EnableCaching注解</strong></p>
<pre><code class="highlight java"><span class="meta">@SpringBootApplication</span>
<span class="meta">@EnableCaching</span>          <span class="comment">//开启缓存</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootwarApplication</span> &#123;

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
        SpringApplication.run(SpringbootwarApplication.class, args);

    &#125;
&#125;</code></pre>
<p><strong>修改实体类Student</strong></p>
<p>由于要将查询的实体类对象缓存到Redis，Redis要求实体类必须<strong>序列化</strong>。所以需要实体类实现序列化接口</p>
<p><strong>修改index页面</strong></p>
<p><strong>修改Controller</strong><br />
在其中添加两个处理器方法。</p>
<p><strong>修改Service接口</strong></p>
<p><strong>修改Service实现类</strong>注解方式</p>
<ul>
<li>在<strong>查询方法上</strong>添加@<strong>Cacheable</strong>注解，在<strong>增删改方法</strong>上添加@<strong>CacheEvict</strong>注解</li>
<li>value值为 在主配置文件中注册缓存空间名称</li>
</ul>
<blockquote>
<p>@Cacheable会先用&quot;student_id&quot;从缓存中查询，如果有值，则直接返回，不会调用方法内部的语句</p>
</blockquote>
<blockquote>
<p>@CacheEvict会清掉realTimeCache缓存空间中的所有值（allEntries=true表示所有）</p>
</blockquote>
<blockquote>
<p>所以建议尽量让缓存空间小，一个表对应一个缓存空间</p>
</blockquote>
<p><strong>修改Service实现类</strong>代码方式</p>
<p><em>count数据并不需要实时的更新，只需要确保它相对准确就可以</em></p>
<blockquote>
<p>只要我们为一个缓存设置了缓存时间，就要考虑热点缓存问题（即时间到期后会有大量的并发访问该条记录）</p>
</blockquote>
<blockquote>
<p>我们可以用双重检测机制防止解决热点缓存</p>
</blockquote>
<p>redisTemplate对象我们直接注入就可以：</p>
<p>双重检测锁：</p>
<blockquote>
<p>这里使用<strong>synchronized的前提是该类是单例</strong>，因为我们的类都交给了spring管理，所以是单例的</p>
</blockquote>
<p><strong>修改Dao接口</strong></p>
<p><strong>修改映射文件</strong></p>
<h4 id="启动redis"><a class="markdownIt-Anchor" href="#启动redis"></a> 启动Redis</h4>
<p><strong>启动redis</strong></p>
<p><strong>启动Redis集群</strong><br />
该示例需要启动三台Redis主机，三台Redis哨兵主机。</p>
<p>逐台启动三台Redis主机，即启动Redis</p>
<p><strong>登录Redis</strong><br />
逐台登录三台Redis</p>
<p><strong>查看Redis角色</strong></p>
<p>逐台查看Redis的角色。</p>
<p><strong>启动sentinel集群</strong><br />
逐台启动三台Sentinel主机，即启动Sentinel集群。</p>
<h3 id="拦截器"><a class="markdownIt-Anchor" href="#拦截器"></a> 拦截器</h3>
<p>在非Spring Boot工程中若要使用SpringMVC的拦截器，在定义好拦截器后，需要在Spring配置文件中对其进行注册。但Spring Boot工程中没有了Spring配置文件，那么如何使用拦截器呢？</p>
<p>Spring Boot对于原来在配置文件配置的内容，现在全部体现在一个类中，该类需要继承自WebMvcConfigurationSupport类，并使用@Configuration进行注解，表示该类为一个JavaConfig/CodeConfig类，其充当配置文件的角色。</p>
<p><strong>定义拦截器</strong></p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomeInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response,Object handler)</span> <span class="keyword">throws</span> Exception&#123;
        System.out.println(<span class="string">&quot;执行拦截器&quot;</span> + request.getRequestURI());
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;
&#125;</code></pre>
<p><strong>定义处理器</strong></p>
<p><strong>定义配置文件类</strong></p>
<ul>
<li><code>*表示只有一级目录，**表示后面所有的目录</code></li>
</ul>
<pre><code class="highlight java"><span class="comment">//表示该文件相当于配置文件</span>
<span class="meta">@Configuration</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;
    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span>&#123;
        SomeInterceptor si= <span class="keyword">new</span> <span class="title class_">SomeInterceptor</span>();
        <span class="comment">//拦截first开头的路径，不拦截second开头的路径</span>
        registry.addInterceptor(si).addPathPatterns(<span class="string">&quot;/first/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/second/**&quot;</span>);
    &#125;
&#125;</code></pre>
<h3 id="servlet"><a class="markdownIt-Anchor" href="#servlet"></a> Servlet</h3>
<p>在Spring Boot中使用Servlet，根据Servlet注册方式的不同，有两种使用方式。若使用的Servlet3.0+版本，则两种方式均可使用；若使用的是Servlet2.5版本，则只能使用配置</p>
<h4 id="注解方式"><a class="markdownIt-Anchor" href="#注解方式"></a> 注解方式</h4>
<p>若使用的是Servlet3.0+版本，可以直接使用Servlet的注解对Servlet进行注册。其总步骤有两步：</p>
<ul>
<li>在定义好的Servlet上使用<code>@WebServlet</code>注解</li>
<li>在入口类上添加<code>@ServletComponentScan</code>注解</li>
</ul>
<p><strong>创建Servlet</strong><br />
这里在创建Servlet时需要注意，不能直接使用Eclipse中的向导直接创建Servlet，无法创建。需要通过创建一个class，让其继承自HttpServlet方式创建。然后在Servlet上添加@WebServlet注解。</p>
<p><strong>修改入口类</strong></p>
<p>在入口类中添加Servlet扫描注解。</p>
<h4 id="配置类方式"><a class="markdownIt-Anchor" href="#配置类方式"></a> 配置类方式</h4>
<p>若使用的是Servlet2.5版本，没有Servlet注解，此时只能使用配置类方式。其总步骤有两步，无需在入口类上添加@ServletComponentScan注解。</p>
<ul>
<li>定义Servlet</li>
<li>定义配置类</li>
</ul>
<p><strong>定义Servlet</strong></p>
<p><strong>定义配置类</strong></p>
<h3 id="filter过滤器"><a class="markdownIt-Anchor" href="#filter过滤器"></a> Filter过滤器</h3>
<p>在Spring Boot中使用Filter与前面的使用Servlet相似，根据Filter注册方式的不同，有两种使用方式。若使用的是Servlet3.0+版本，则两种方式均可使用；若使用的是Servlet2.5版本，则只能使用配置类方式。</p>
<h4 id="注解方式-2"><a class="markdownIt-Anchor" href="#注解方式-2"></a> 注解方式</h4>
<p>若使用的是Servlet3.0+版本，可以直接使用Filter的注解对Filter进行注册。其总步骤有两步：</p>
<ul>
<li>在定义好的Filter上使用<code>@WebFilter</code>注解</li>
<li>在入口类上添加<code>@ServletComponentScan</code>注解</li>
</ul>
<p><strong>创建Filter</strong><br />
这里在创建Filter时需要注意，不能直接使用Eclipse中的向导直接创建Filter，无法创建。需要通过创建一个class，让其实现Filter接口方式创建。然后在Filter上添加@WebFilter注解。</p>
<p><strong>修改入口类</strong><br />
在@ServletComponentScan注解中注册Filter所在的包，当然，Spring Boot支持通配符的使用。</p>
<h4 id="配置类方式-2"><a class="markdownIt-Anchor" href="#配置类方式-2"></a> 配置类方式</h4>
<p>若使用的是Servlet2.5版本，没有Filter注解，此时只能使用配置类方式。其总步骤有两步，与@ServletComponentScan注解无关。</p>
<ul>
<li>定义Filter</li>
<li>定义配置类</li>
</ul>
<p><strong>定义Filter</strong></p>
<p><strong>修改配置类</strong><br />
在配置类中添加如下方法</p>
<h2 id="持久层支持"><a class="markdownIt-Anchor" href="#持久层支持"></a> 持久层支持</h2>
<h3 id="jpa"><a class="markdownIt-Anchor" href="#jpa"></a> JPA</h3>
<p>JPA（Java persistence API）是Sun官方提出的Java持久化规范，用来方便大家操作数据库。</p>
<p>真正干活的可能是hibernate，tomlink等等实现了JPA规范的不同的厂商</p>
<h4 id="数据库准备"><a class="markdownIt-Anchor" href="#数据库准备"></a> 数据库准备</h4>
<p>创建表</p>
<pre><code class="highlight sql">use lee_test;
<span class="keyword">CREATE TABLE</span> category (
  id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,
  name <span class="type">varchar</span>(<span class="number">30</span>),
  <span class="keyword">PRIMARY KEY</span> (id)
) <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>UTF8;</code></pre>
<p>准备数据</p>
<pre><code class="highlight sql">
<span class="keyword">insert into</span> category <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;category 1&#x27;</span>);
<span class="keyword">insert into</span> category <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;category 2&#x27;</span>);
<span class="keyword">insert into</span> category <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;category 3&#x27;</span>);
<span class="keyword">insert into</span> category <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;category 4&#x27;</span>);
</code></pre>
<h4 id="applicationproperties"><a class="markdownIt-Anchor" href="#applicationproperties"></a> application.properties</h4>
<pre><code class="highlight properties"><span class="comment"># 配置jsp的寻找路径</span>
<span class="attr">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span>
<span class="comment">#更改tomcat默认端口号</span>
<span class="attr">server.port</span>=<span class="string">8088</span>
<span class="comment">#更改访问上下文路径/访问路径 localhost:8088/leeBoot/...</span>
<span class="attr">server.context-path</span>=<span class="string">/leeBoot</span>
<span class="comment"></span>
<span class="comment">#datasource数据源</span>
<span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/lee_test?characterEncoding=UTF-8</span>
<span class="attr">spring.datasource.username</span>=<span class="string">root</span>
<span class="attr">spring.datasource.password</span>=<span class="string">admin</span>
<span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span>
<span class="comment">#新增数据库链接必须的参数</span>
<span class="attr">spring.jpa.properties.hibernate.hbm2ddl.auto</span>=<span class="string">update</span></code></pre>
<h4 id="pomxml"><a class="markdownIt-Anchor" href="#pomxml"></a> pom.xml</h4>
<p>增加对MySQL和 jpa的支持</p>
<pre><code class="highlight xml"><span class="comment">&lt;!-- mysql--&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
<span class="comment">&lt;!-- jpa--&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
</code></pre>
<h4 id="实体类"><a class="markdownIt-Anchor" href="#实体类"></a> 实体类</h4>
<ul>
<li><code>@Entity</code> 注解表示这是个实体类</li>
<li><code>@Table(name = &quot;category&quot;)</code> 表示这个类对应的表名是 category_ ，注意有下划线哦</li>
<li><code>@Id</code> 表明主键</li>
<li><code>@GeneratedValue(strategy = GenerationType.IDENTITY)</code> 表明自增长方式</li>
<li><code>@Column(name = &quot;id&quot;)</code> 表明对应的数据库字段名</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.pojo;

<span class="keyword">import</span> javax.persistence.*;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="comment">//表示这是个实体类</span>
<span class="meta">@Entity</span>
<span class="comment">//表示这个实体类对应的表为category</span>
<span class="meta">@Table(name=&quot;category&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
    <span class="comment">//表明主键</span>
    <span class="meta">@Id</span>
    <span class="comment">//表示自增长方式</span>
    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="comment">//表示对应的数据库字段名</span>
    <span class="meta">@Column(name=&quot;id&quot;)</span>
    <span class="keyword">private</span> <span class="type">int</span> id;

    <span class="meta">@Column(name=&quot;name&quot;)</span>
    <span class="keyword">private</span> String name;


    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;

    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
&#125;
</code></pre>
<h4 id="dao"><a class="markdownIt-Anchor" href="#dao"></a> DAO</h4>
<p>创建dao接口CategoryDAO，继承了JpaRespository，并且提供泛型&lt;Category,Integer&gt;表示这个是针对Category类的DAO，Integer表示主键是Integer类型</p>
<p>JpaRespository这个父接口，就提供了CRUD，分页等等一系列的查询了，直接拿来用</p>
<p><strong>JpaRespository</strong>是一个接口，<code>org.springframework.data.jpa.repository.support</code>包有一个实现类<strong>SimpleJpaRepository</strong>，会纳入spring bean管理，所以所有继承了该接口的Dao类，实际传入的对象都是该实现类对象</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.dao;

<span class="keyword">import</span> com.leeboer.springboot.pojo.Category;
<span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="comment">//泛型&lt;Category,Integer&gt; 表示这个是针对Category类的DAO,Integer表示主键是Integer类型</span>
<span class="comment">//JpaRepository 这个父接口，就提供了CRUD, 分页等等一系列的查询了，直接拿来用，都不需要二次开发的了</span>
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryDAO</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Category,Integer&gt; &#123;
&#125;
</code></pre>
<h4 id="controller"><a class="markdownIt-Anchor" href="#controller"></a> Controller</h4>
<p>创建CategoryController 类</p>
<pre><code>1. 接受listCategory映射
2. 然后获取所有的分类数据
3. 接着放入Model中
4. 跳转到listCategory.jsp中
</code></pre>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.web;

<span class="keyword">import</span> com.leeboer.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.leeboer.springboot.pojo.Category;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;
    <span class="meta">@Autowired</span>
    CategoryDAO categoryDAO;

    <span class="meta">@RequestMapping(&quot;/listCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">listCategory</span><span class="params">(Model model)</span>&#123;
        List&lt;Category&gt; list = categoryDAO.findAll();
        <span class="keyword">for</span>(Category c:list)&#123;
            System.out.println(c.getName());
        &#125;
        model.addAttribute(<span class="string">&quot;cs&quot;</span>,list);
        <span class="keyword">return</span> <span class="string">&quot;listCategory&quot;</span>;
    &#125;
&#125;
</code></pre>
<h4 id="jsp-2"><a class="markdownIt-Anchor" href="#jsp-2"></a> JSP</h4>
<pre><code class="highlight html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
 
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
   
<span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">&#x27;center&#x27;</span> <span class="attr">border</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cellspacing</span>=<span class="string">&#x27;0&#x27;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">tr</span>&gt;</span>
        <span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
        <span class="tag">&lt;<span class="name">td</span>&gt;</span>name<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>
    <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;cs&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;c&quot;</span> <span class="attr">varStatus</span>=<span class="string">&quot;st&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">tr</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;c.id&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;c.name&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                
        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span>
<span class="tag">&lt;/<span class="name">table</span>&gt;</span></code></pre>
<h4 id="测试"><a class="markdownIt-Anchor" href="#测试"></a> 测试</h4>
<pre><code class="highlight plaintext">http://127.0.0.1:8088/leeBoot
/listCategory</code></pre>
<h3 id="mybatis-注解方式"><a class="markdownIt-Anchor" href="#mybatis-注解方式"></a> MyBatis-注解方式</h3>
<h4 id="applicationproperties-2"><a class="markdownIt-Anchor" href="#applicationproperties-2"></a> application.properties</h4>
<pre><code class="highlight properties"><span class="comment"># 配置jsp的寻找路径</span>
<span class="attr">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span>
<span class="comment">#更改tomcat默认端口号</span>
<span class="attr">server.port</span>=<span class="string">8088</span>
<span class="comment">#更改访问上下文路径/访问路径 localhost:8088/leeBoot/...</span>
<span class="attr">server.context-path</span>=<span class="string">/leeBoot</span>

<span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/lee_test?characterEncoding=UTF-8</span>
<span class="attr">spring.datasource.username</span>=<span class="string">root</span>
<span class="attr">spring.datasource.password</span>=<span class="string">admin</span>
<span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span>
<span class="comment">#新增数据库链接必须的参数（jpa方式要加，mybatis方式不用加）</span>
<span class="comment">#spring.jpa.properties.hibernate.hbm2ddl.auto=update</span></code></pre>
<h4 id="pomxml-2"><a class="markdownIt-Anchor" href="#pomxml-2"></a> pom.xml</h4>
<p>增加对MySQL和mybatis的支持</p>
<pre><code class="highlight xml"><span class="comment">&lt;!-- mysql--&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
	<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>

<span class="comment">&lt;!-- mybatis --&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<h4 id="mapper"><a class="markdownIt-Anchor" href="#mapper"></a> Mapper</h4>
<p>其他与JPA方式相同，只需把dao改为Mapper即可</p>
<p>使用注解@Mapper表示这是一个Mybatis Mapper接口<br />
使用@Select注解表示调用findAll方法会执行对应的sql语句</p>
<blockquote>
<p><strong>在工程主类application.java 上面添加注解<code>@MapperScan(&quot;com.leeboer.springboot.mapper&quot;)</code>，这样就可以省去在每个接口Mapper中添加<code>@Mapper</code>注解</strong></p>
</blockquote>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.dao;
<span class="comment">/**</span>
<span class="comment"> * mybatis方式</span>
<span class="comment"> */</span>
<span class="keyword">import</span> com.leeboer.springboot.pojo.Category;
<span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="keyword">import</span> org.apache.ibatis.annotations.Select;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="meta">@Mapper</span>
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> &#123;
    <span class="meta">@Select(&quot;select * from category&quot;)</span>
    List&lt;Category&gt; <span class="title function_">findAll</span><span class="params">()</span>;
&#125;
</code></pre>
<h4 id="测试-2"><a class="markdownIt-Anchor" href="#测试-2"></a> 测试</h4>
<p>测试会发现，两种方式的执行效果相同</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.web;

<span class="keyword">import</span> com.leeboer.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.leeboer.springboot.dao.CategoryMapper;
<span class="keyword">import</span> com.leeboer.springboot.pojo.Category;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;
    <span class="comment">//jpa方式</span>
    <span class="meta">@Autowired</span>
    CategoryDAO categoryDAO;
    <span class="comment">//Mapper方式</span>
    <span class="meta">@Autowired</span>
    CategoryMapper categoryMapper;

    <span class="meta">@RequestMapping(&quot;/listCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">listCategory</span><span class="params">(Model model)</span>&#123;

        List&lt;Category&gt; list = categoryDAO.findAll();

        List&lt;Category&gt; list2 = categoryMapper.findAll();

        <span class="keyword">for</span>(Category c:list2)&#123;
            System.out.println(c.getName());
        &#125;
        model.addAttribute(<span class="string">&quot;cs&quot;</span>,list2);
        <span class="keyword">return</span> <span class="string">&quot;listCategory&quot;</span>;
    &#125;
&#125;
</code></pre>
<h3 id="mybatis-xml方式"><a class="markdownIt-Anchor" href="#mybatis-xml方式"></a> MyBatis-xml方式</h3>
<p>基于上一个例子的基础上</p>
<h4 id="categorymapper"><a class="markdownIt-Anchor" href="#categorymapper"></a> CategoryMapper</h4>
<pre><code class="highlight java"><span class="keyword">import</span> java.util.List;
 
<span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="keyword">import</span> org.apache.ibatis.annotations.Select;
 
<span class="keyword">import</span> com.how2java.springboot.pojo.Category;
 
<span class="meta">@Mapper</span>
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> &#123;
 
    List&lt;Category&gt; <span class="title function_">findAll</span><span class="params">()</span>;
 
&#125;
</code></pre>
<h4 id="categoryxml"><a class="markdownIt-Anchor" href="#categoryxml"></a> Category.xml</h4>
<p>在Mapper类旁边，新增加Category.xml文件</p>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span>
<span class="meta">    <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="meta">    <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
  
    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.leeboer.springboot.mapper.CategoryMapper&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Category&quot;</span>&gt;</span>
            select * from category
        <span class="tag">&lt;/<span class="name">select</span>&gt;</span>   
    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<h4 id="applicationproperties-3"><a class="markdownIt-Anchor" href="#applicationproperties-3"></a> application.properties</h4>
<pre><code class="highlight properties"><span class="comment"># 配置jsp的寻找路径</span>
<span class="attr">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span>
<span class="comment">#更改tomcat默认端口号</span>
<span class="attr">server.port</span>=<span class="string">8088</span>
<span class="comment">#更改访问上下文路径/访问路径 localhost:8088/leeBoot/...</span>
<span class="attr">server.context-path</span>=<span class="string">/leeBoot</span>

<span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/lee_test?characterEncoding=UTF-8</span>
<span class="attr">spring.datasource.username</span>=<span class="string">root</span>
<span class="attr">spring.datasource.password</span>=<span class="string">admin</span>
<span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span>
<span class="comment">#新增数据库链接必须的参数（jpa方式要加，mybatis方式不用加）</span>
<span class="comment">#spring.jpa.properties.hibernate.hbm2ddl.auto=update</span>
<span class="comment"></span>
<span class="comment">#mybaits基于注解要额外加两条配置</span>
<span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:com/leeboer/springboot/mapper/*.xml</span>
<span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.leeboer.springboot.pojo</span>
</code></pre>
<h4 id="测试-3"><a class="markdownIt-Anchor" href="#测试-3"></a> 测试</h4>
<p>调用方法与抢两个类似，不在概述</p>
<h2 id="crud分页"><a class="markdownIt-Anchor" href="#crud分页"></a> CRUD/分页</h2>
<h3 id="jpa-2"><a class="markdownIt-Anchor" href="#jpa-2"></a> JPA</h3>
<p>该种方式实现分页无需修改其他代码，只需在<code>controller</code>层增加相应响应即可，因为<code>CategoryDao</code>实现了<code>JpaRepository</code>接口，该接口的实现类<code>SimpleJpaRepository</code>基本实现了要用的所有方法</p>
<h4 id="controller-2"><a class="markdownIt-Anchor" href="#controller-2"></a> Controller</h4>
<p>Sort：表示一个排序对象，设置倒排序</p>
<pre><code class="highlight java"><span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sort</span>(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>);</code></pre>
<p>Pageable：分页对象</p>
<pre><code class="highlight java"><span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageRequest</span>(start, size, sort);</code></pre>
<p>CategoryDAO通过分页对象获取结果page</p>
<pre><code class="highlight java">Page&lt;Category&gt; page =categoryDAO.findAll(pageable);</code></pre>
<blockquote>
<p>在这个page对象里，不仅包含了分页信息，还包含了数据信息，即有哪些分类数据。 这个可以通过getContent()获取出来</p>
</blockquote>
<p>CategoryController.java</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.web;

<span class="keyword">import</span> com.leeboer.springboot.Mapper.CategoryMapper;
<span class="keyword">import</span> com.leeboer.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.leeboer.springboot.pojo.Category;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.data.domain.Page;
<span class="keyword">import</span> org.springframework.data.domain.PageRequest;
<span class="keyword">import</span> org.springframework.data.domain.Pageable;
<span class="keyword">import</span> org.springframework.data.domain.Sort;
<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;
    <span class="comment">//jpa方式</span>
    <span class="meta">@Autowired</span>
    CategoryDAO categoryDAO;
    <span class="comment">//Mapper方式</span>
    <span class="meta">@Autowired</span>
    CategoryMapper categoryMapper;

    <span class="meta">@RequestMapping(&quot;/listCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">listCategory</span><span class="params">(Model model,<span class="meta">@RequestParam(value = &quot;start&quot;, defaultValue = &quot;0&quot;)</span> <span class="type">int</span> start,<span class="meta">@RequestParam(value = &quot;size&quot;, defaultValue = &quot;5&quot;)</span> <span class="type">int</span> size)</span>&#123;

        <span class="comment">//分页</span>
        <span class="comment">//如果首页开始坐标小于0则返回0</span>
        start = start&lt;<span class="number">0</span>?<span class="number">0</span>:start;
        <span class="comment">//设置倒序排序</span>
        <span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sort</span>(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>);
        <span class="comment">//根据start,size,sort创建分页对象</span>
        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageRequest</span>(start, size, sort);
        <span class="comment">//dao根据分页对象获取结果page</span>
        <span class="comment">//在这个page对象里，不仅包含了分页信息，还包含了数据信息，即有哪些分类数据。 这个可以通过getContent()获取出来</span>
        Page&lt;Category&gt; page =categoryDAO.findAll(pageable);
        model.addAttribute(<span class="string">&quot;page&quot;</span>, page);
        <span class="keyword">return</span> <span class="string">&quot;listCategory&quot;</span>;
    &#125;
    <span class="comment">//增</span>
    <span class="meta">@RequestMapping(&quot;/addCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">addCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryDAO.save(c);<span class="comment">//JPA 新增和修改用的都是save. 它根据实体类的id是否为0来判断是进行增加还是修改</span>
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="comment">//删</span>
    <span class="meta">@RequestMapping(&quot;/deleteCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">deleteCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryDAO.delete(c);
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="comment">//改</span>
    <span class="meta">@RequestMapping(&quot;/updateCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">updateCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryDAO.save(c);<span class="comment">//JPA 新增和修改用的都是save. 它根据实体类的id是否为0来判断是进行增加还是修改</span>
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="comment">//查</span>
    <span class="meta">@RequestMapping(&quot;/editCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">editCategory</span><span class="params">(<span class="type">int</span> id,Model m)</span> <span class="keyword">throws</span> Exception &#123;
        Category c= categoryDAO.getOne(id);
        m.addAttribute(<span class="string">&quot;c&quot;</span>, c);
        <span class="keyword">return</span> <span class="string">&quot;editCategory&quot;</span>;
    &#125;
&#125;
</code></pre>
<h4 id="jsp-3"><a class="markdownIt-Anchor" href="#jsp-3"></a> jsp</h4>
<p>通过page.getContent遍历当前页面的Category对象</p>
<p>在分页的时候通过page.number获取当前页面，page.totalPages获取总页面数</p>
<blockquote>
<p>page.getContent会返回一个泛型是Category的集合</p>
</blockquote>
<p>listCategory.jsp</p>
<pre><code class="highlight html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
         pageEncoding=&quot;UTF-8&quot;%&gt;

&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;

<span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>

<span class="tag">&lt;/<span class="name">div</span>&gt;</span>

<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:500px;margin:20px auto;text-align: center&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">&#x27;center&#x27;</span> <span class="attr">border</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cellspacing</span>=<span class="string">&#x27;0&#x27;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">tr</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>name<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>
        <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;page.content&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;c&quot;</span> <span class="attr">varStatus</span>=<span class="string">&quot;st&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;c.id&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;c.name&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;editCategory?id=$&#123;c.id&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;deleteCategory?id=$&#123;c.id&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span>

    <span class="tag">&lt;/<span class="name">table</span>&gt;</span>
    <span class="tag">&lt;<span class="name">br</span>&gt;</span>
    <span class="tag">&lt;<span class="name">div</span>&gt;</span>
        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=0&quot;</span>&gt;</span>[首  页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.number-1&#125;&quot;</span>&gt;</span>[上一页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.number+1&#125;&quot;</span>&gt;</span>[下一页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.totalPages-1&#125;&quot;</span>&gt;</span>[末  页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
    <span class="tag">&lt;<span class="name">br</span>&gt;</span>
    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;addCategory&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span>

        name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span>
        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span>

    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>
<span class="tag">&lt;/<span class="name">div</span>&gt;</span></code></pre>
<p>editCategory.jsp</p>
<pre><code class="highlight html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
 pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin:0px auto; width:500px&quot;</span>&gt;</span>
 
<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;updateCategory&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span>
 
name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;c.name&#125;&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span>
 
<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;c.id&#125;&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span>
 
<span class="tag">&lt;/<span class="name">form</span>&gt;</span>
<span class="tag">&lt;/<span class="name">div</span>&gt;</span></code></pre>
<h3 id="mybatis-2"><a class="markdownIt-Anchor" href="#mybatis-2"></a> MyBatis</h3>
<h4 id="pomxml-3"><a class="markdownIt-Anchor" href="#pomxml-3"></a> pom.xml</h4>
<p>增加对PageHelper的支持</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<h4 id="pagehelperconfig"><a class="markdownIt-Anchor" href="#pagehelperconfig"></a> PageHelperConfig</h4>
<p>添加一个类PageHelperConfig ，其中进行PageHelper相关配置</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.config;

<span class="keyword">import</span> java.util.Properties;

<span class="keyword">import</span> org.springframework.context.annotation.Bean;
<span class="keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="keyword">import</span> com.github.pagehelper.PageHelper;

<span class="meta">@Configuration</span>
<span class="comment">//表示该类是spring容器配置类，相当于基于xml启动的spring的application.xml配置文件</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageHelperConfig</span> &#123;

    <span class="meta">@Bean</span>
    <span class="comment">//表示application.xml中的一个&lt;bean&gt;&lt;/bean&gt;元素，改bean元素的id为pageHelper</span>
    <span class="keyword">public</span> PageHelper <span class="title function_">pageHelper</span><span class="params">()</span> &#123;
        <span class="type">PageHelper</span> <span class="variable">pageHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageHelper</span>();
        <span class="type">Properties</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();
        <span class="comment">//offsetAsPageNum:设置为true时，会将RowBounds第一个参数offset当成pageNum页码使用</span>
        p.setProperty(<span class="string">&quot;offsetAsPageNum&quot;</span>, <span class="string">&quot;true&quot;</span>);
        <span class="comment">//rowBoundsWithCount:设置为true时，使用RowBounds分页会进行count查询</span>
        p.setProperty(<span class="string">&quot;rowBoundsWithCount&quot;</span>, <span class="string">&quot;true&quot;</span>);
        <span class="comment">//reasonable：启用合理化时，如果pageNum&lt;1会查询第一页，如果pageNum&gt;pages会查询最后一页</span>
        p.setProperty(<span class="string">&quot;reasonable&quot;</span>, <span class="string">&quot;true&quot;</span>);
        pageHelper.setProperties(p);
        <span class="keyword">return</span> pageHelper;
    &#125;
&#125;</code></pre>
<h4 id="mapper-2"><a class="markdownIt-Anchor" href="#mapper-2"></a> Mapper</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.Mapper;
<span class="comment">/**</span>
<span class="comment"> * mybatis 注解方式（xml方式删掉Mapper注解和select注解新增xml文件即可）</span>
<span class="comment"> */</span>
<span class="keyword">import</span> com.leeboer.springboot.pojo.Category;
<span class="keyword">import</span> org.apache.ibatis.annotations.*;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="meta">@Mapper</span>
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> &#123;

    <span class="meta">@Select(&quot;select * from category &quot;)</span>
    List&lt;Category&gt; <span class="title function_">findAll</span><span class="params">()</span>;

    <span class="meta">@Insert(&quot; insert into category ( name ) values (#&#123;name&#125;) &quot;)</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">save</span><span class="params">(Category category)</span>;

    <span class="meta">@Delete(&quot; delete from category where id= #&#123;id&#125; &quot;)</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> id)</span>;

    <span class="meta">@Select(&quot;select * from category where id= #&#123;id&#125; &quot;)</span>
    <span class="keyword">public</span> Category <span class="title function_">get</span><span class="params">(<span class="type">int</span> id)</span>;

    <span class="meta">@Update(&quot;update category set name=#&#123;name&#125; where id=#&#123;id&#125; &quot;)</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Category category)</span>;
&#125;
</code></pre>
<h4 id="controller-3"><a class="markdownIt-Anchor" href="#controller-3"></a> Controller</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.springboot.web;

<span class="keyword">import</span> com.github.pagehelper.PageHelper;
<span class="keyword">import</span> com.github.pagehelper.PageInfo;
<span class="keyword">import</span> com.leeboer.springboot.Mapper.CategoryMapper;
<span class="keyword">import</span> com.leeboer.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.leeboer.springboot.pojo.Category;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.data.domain.Page;
<span class="keyword">import</span> org.springframework.data.domain.PageRequest;
<span class="keyword">import</span> org.springframework.data.domain.Pageable;
<span class="keyword">import</span> org.springframework.data.domain.Sort;
<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;
    <span class="comment">//jpa方式</span>
    <span class="meta">@Autowired</span>
    CategoryDAO categoryDAO;
    <span class="comment">//Mapper方式</span>
    <span class="meta">@Autowired</span>
    CategoryMapper categoryMapper;

    <span class="comment">//mybatis-PageHelper增删该查和注解的使用</span>
    <span class="meta">@RequestMapping(&quot;/addCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">listCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryMapper.save(c);
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="meta">@RequestMapping(&quot;/deleteCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">deleteCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryMapper.delete(c.getId());
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="meta">@RequestMapping(&quot;/updateCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">updateCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryMapper.update(c);
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="meta">@RequestMapping(&quot;/editCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">listCategory</span><span class="params">(<span class="type">int</span> id,Model m)</span> <span class="keyword">throws</span> Exception &#123;
        Category c= categoryMapper.get(id);
        m.addAttribute(<span class="string">&quot;c&quot;</span>, c);
        <span class="keyword">return</span> <span class="string">&quot;listCategory&quot;</span>;
    &#125;

    <span class="meta">@RequestMapping(&quot;/listCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">listCategory</span><span class="params">(Model m,<span class="meta">@RequestParam(value = &quot;start&quot;, defaultValue = &quot;0&quot;)</span> <span class="type">int</span> start,<span class="meta">@RequestParam(value = &quot;size&quot;, defaultValue = &quot;5&quot;)</span> <span class="type">int</span> size)</span> <span class="keyword">throws</span> Exception &#123;
        PageHelper.startPage(start,size,<span class="string">&quot;id desc&quot;</span>);
        List&lt;Category&gt; cs=categoryMapper.findAll();
        PageInfo&lt;Category&gt; page = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(cs);
        m.addAttribute(<span class="string">&quot;page&quot;</span>, page);
        <span class="keyword">return</span> <span class="string">&quot;listCategoryPageHelper&quot;</span>;
    &#125;

&#125;
</code></pre>
<h4 id="jsp-4"><a class="markdownIt-Anchor" href="#jsp-4"></a> jsp</h4>
<p>通过page.getList遍历当前页面的Category对象。<br />
在分页的时候通过page.pageNum获取当前页面，page.pages获取总页面数。</p>
<blockquote>
<p>注：page.getList会返回一个泛型是Category的集合</p>
</blockquote>
<p>listCategory.jsp</p>
<pre><code class="highlight html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
  
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
    
<span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>
  
<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
  
<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:500px;margin:20px auto;text-align: center&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">&#x27;center&#x27;</span> <span class="attr">border</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cellspacing</span>=<span class="string">&#x27;0&#x27;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">tr</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>name<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>
        <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;page.list&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;c&quot;</span> <span class="attr">varStatus</span>=<span class="string">&quot;st&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;c.id&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;c.name&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;editCategory?id=$&#123;c.id&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;deleteCategory?id=$&#123;c.id&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span>
          
    <span class="tag">&lt;/<span class="name">table</span>&gt;</span>
    <span class="tag">&lt;<span class="name">br</span>&gt;</span>
    <span class="tag">&lt;<span class="name">div</span>&gt;</span>
                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=1&quot;</span>&gt;</span>[首  页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.pageNum-1&#125;&quot;</span>&gt;</span>[上一页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.pageNum+1&#125;&quot;</span>&gt;</span>[下一页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.pages&#125;&quot;</span>&gt;</span>[末  页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
    <span class="tag">&lt;<span class="name">br</span>&gt;</span>
    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;addCategory&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span>
      
    name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span>
    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span>
      
    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>
<span class="tag">&lt;/<span class="name">div</span>&gt;</span></code></pre>
<h4 id="测试运行-2"><a class="markdownIt-Anchor" href="#测试运行-2"></a> 测试运行</h4>
<h3 id="sqlite"><a class="markdownIt-Anchor" href="#sqlite"></a> SQLite</h3>
<p>SQLite 是一种数据库，它是跑在 JVM里面的，所以不需要像 mysql 那样得独立安装配置，而是直接拿来就用</p>
<h4 id="pomxml-4"><a class="markdownIt-Anchor" href="#pomxml-4"></a> pom.xml</h4>
<p>增加sqlite依赖</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xerial<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sqlite-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<h4 id="配置sqlite方言"><a class="markdownIt-Anchor" href="#配置sqlite方言"></a> 配置SQLite方言</h4>
<p>因为是使用 JPA 来链接 SQlite, 而 JPA 默认用的是 Hibernate，所以要为 Hibernate 配置专门的方言</p>
<p>方便 Hibernate和 Sqlite打交道。 方言的英文是 Dialect， 所以就有了SQLiteDialect 这个类了</p>
<h5 id="sqlitedialect"><a class="markdownIt-Anchor" href="#sqlitedialect"></a> SQLiteDialect</h5>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.sqlite;

<span class="keyword">import</span> java.sql.SQLException;
<span class="keyword">import</span> java.sql.Types;

<span class="keyword">import</span> org.hibernate.JDBCException;
<span class="keyword">import</span> org.hibernate.ScrollMode;
<span class="keyword">import</span> org.hibernate.dialect.Dialect;
<span class="keyword">import</span> org.hibernate.dialect.function.AbstractAnsiTrimEmulationFunction;
<span class="keyword">import</span> org.hibernate.dialect.function.NoArgSQLFunction;
<span class="keyword">import</span> org.hibernate.dialect.function.SQLFunction;
<span class="keyword">import</span> org.hibernate.dialect.function.SQLFunctionTemplate;
<span class="keyword">import</span> org.hibernate.dialect.function.StandardSQLFunction;
<span class="keyword">import</span> org.hibernate.dialect.function.VarArgsSQLFunction;
<span class="keyword">import</span> org.hibernate.dialect.identity.IdentityColumnSupport;
<span class="keyword">import</span> org.hibernate.dialect.pagination.AbstractLimitHandler;
<span class="keyword">import</span> org.hibernate.dialect.pagination.LimitHandler;
<span class="keyword">import</span> org.hibernate.dialect.pagination.LimitHelper;
<span class="keyword">import</span> org.hibernate.dialect.unique.DefaultUniqueDelegate;
<span class="keyword">import</span> org.hibernate.dialect.unique.UniqueDelegate;
<span class="keyword">import</span> org.hibernate.engine.spi.RowSelection;
<span class="keyword">import</span> org.hibernate.exception.DataException;
<span class="keyword">import</span> org.hibernate.exception.JDBCConnectionException;
<span class="keyword">import</span> org.hibernate.exception.LockAcquisitionException;
<span class="keyword">import</span> org.hibernate.exception.spi.SQLExceptionConversionDelegate;
<span class="keyword">import</span> org.hibernate.exception.spi.TemplatedViolatedConstraintNameExtracter;
<span class="keyword">import</span> org.hibernate.exception.spi.ViolatedConstraintNameExtracter;
<span class="keyword">import</span> org.hibernate.internal.util.JdbcExceptionHelper;
<span class="keyword">import</span> org.hibernate.mapping.Column;
<span class="keyword">import</span> org.hibernate.type.StandardBasicTypes;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SQLiteDialect</span> <span class="keyword">extends</span> <span class="title class_">Dialect</span> &#123;
    <span class="keyword">private</span> <span class="keyword">final</span> UniqueDelegate uniqueDelegate;

    <span class="keyword">public</span> <span class="title function_">SQLiteDialect</span><span class="params">()</span> &#123;
        registerColumnType(Types.BIT, <span class="string">&quot;boolean&quot;</span>);
        registerColumnType(Types.DECIMAL, <span class="string">&quot;decimal&quot;</span>);
        registerColumnType(Types.CHAR, <span class="string">&quot;char&quot;</span>);
        registerColumnType(Types.LONGVARCHAR, <span class="string">&quot;longvarchar&quot;</span>);
        registerColumnType(Types.TIMESTAMP, <span class="string">&quot;datetime&quot;</span>);
        registerColumnType(Types.BINARY, <span class="string">&quot;blob&quot;</span>);
        registerColumnType(Types.VARBINARY, <span class="string">&quot;blob&quot;</span>);
        registerColumnType(Types.LONGVARBINARY, <span class="string">&quot;blob&quot;</span>);

        registerFunction(<span class="string">&quot;concat&quot;</span>, <span class="keyword">new</span> <span class="title class_">VarArgsSQLFunction</span>(StandardBasicTypes.STRING, <span class="string">&quot;&quot;</span>, <span class="string">&quot;||&quot;</span>, <span class="string">&quot;&quot;</span>));
        registerFunction(<span class="string">&quot;mod&quot;</span>, <span class="keyword">new</span> <span class="title class_">SQLFunctionTemplate</span>(StandardBasicTypes.INTEGER, <span class="string">&quot;?1 % ?2&quot;</span>));
        registerFunction(<span class="string">&quot;quote&quot;</span>, <span class="keyword">new</span> <span class="title class_">StandardSQLFunction</span>(<span class="string">&quot;quote&quot;</span>, StandardBasicTypes.STRING));
        registerFunction(<span class="string">&quot;random&quot;</span>, <span class="keyword">new</span> <span class="title class_">NoArgSQLFunction</span>(<span class="string">&quot;random&quot;</span>, StandardBasicTypes.INTEGER));
        registerFunction(<span class="string">&quot;round&quot;</span>, <span class="keyword">new</span> <span class="title class_">StandardSQLFunction</span>(<span class="string">&quot;round&quot;</span>));
        registerFunction(<span class="string">&quot;substr&quot;</span>, <span class="keyword">new</span> <span class="title class_">StandardSQLFunction</span>(<span class="string">&quot;substr&quot;</span>, StandardBasicTypes.STRING));
        registerFunction(<span class="string">&quot;trim&quot;</span>, <span class="keyword">new</span> <span class="title class_">AbstractAnsiTrimEmulationFunction</span>() &#123;
            <span class="meta">@Override</span>
            <span class="keyword">protected</span> SQLFunction <span class="title function_">resolveBothSpaceTrimFunction</span><span class="params">()</span> &#123;
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQLFunctionTemplate</span>(StandardBasicTypes.STRING, <span class="string">&quot;trim(?1)&quot;</span>);
            &#125;

            <span class="meta">@Override</span>
            <span class="keyword">protected</span> SQLFunction <span class="title function_">resolveBothSpaceTrimFromFunction</span><span class="params">()</span> &#123;
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQLFunctionTemplate</span>(StandardBasicTypes.STRING, <span class="string">&quot;trim(?2)&quot;</span>);
            &#125;

            <span class="meta">@Override</span>
            <span class="keyword">protected</span> SQLFunction <span class="title function_">resolveLeadingSpaceTrimFunction</span><span class="params">()</span> &#123;
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQLFunctionTemplate</span>(StandardBasicTypes.STRING, <span class="string">&quot;ltrim(?1)&quot;</span>);
            &#125;

            <span class="meta">@Override</span>
            <span class="keyword">protected</span> SQLFunction <span class="title function_">resolveTrailingSpaceTrimFunction</span><span class="params">()</span> &#123;
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQLFunctionTemplate</span>(StandardBasicTypes.STRING, <span class="string">&quot;rtrim(?1)&quot;</span>);
            &#125;

            <span class="meta">@Override</span>
            <span class="keyword">protected</span> SQLFunction <span class="title function_">resolveBothTrimFunction</span><span class="params">()</span> &#123;
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQLFunctionTemplate</span>(StandardBasicTypes.STRING, <span class="string">&quot;trim(?1, ?2)&quot;</span>);
            &#125;

            <span class="meta">@Override</span>
            <span class="keyword">protected</span> SQLFunction <span class="title function_">resolveLeadingTrimFunction</span><span class="params">()</span> &#123;
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQLFunctionTemplate</span>(StandardBasicTypes.STRING, <span class="string">&quot;ltrim(?1, ?2)&quot;</span>);
            &#125;

            <span class="meta">@Override</span>
            <span class="keyword">protected</span> SQLFunction <span class="title function_">resolveTrailingTrimFunction</span><span class="params">()</span> &#123;
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQLFunctionTemplate</span>(StandardBasicTypes.STRING, <span class="string">&quot;rtrim(?1, ?2)&quot;</span>);
            &#125;
        &#125;);
        uniqueDelegate = <span class="keyword">new</span> <span class="title class_">SQLiteUniqueDelegate</span>(<span class="built_in">this</span>);
    &#125;

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SQLiteDialectIdentityColumnSupport</span> <span class="variable">IDENTITY_COLUMN_SUPPORT</span> <span class="operator">=</span> <span class="keyword">new</span>
            <span class="title class_">SQLiteDialectIdentityColumnSupport</span>(<span class="keyword">new</span> <span class="title class_">SQLiteDialect</span>());

    <span class="meta">@Override</span>
    <span class="keyword">public</span> IdentityColumnSupport <span class="title function_">getIdentityColumnSupport</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> IDENTITY_COLUMN_SUPPORT;
    &#125;

    <span class="comment">// limit/offset support ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AbstractLimitHandler</span> <span class="variable">LIMIT_HANDLER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AbstractLimitHandler</span>() &#123;
        <span class="meta">@Override</span>
        <span class="keyword">public</span> String <span class="title function_">processSql</span><span class="params">(String sql, RowSelection selection)</span> &#123;
            <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">hasOffset</span> <span class="operator">=</span> LimitHelper.hasFirstRow(selection);
            <span class="keyword">return</span> sql + (hasOffset ? <span class="string">&quot; limit ? offset ?&quot;</span> : <span class="string">&quot; limit ?&quot;</span>);
        &#125;

        <span class="meta">@Override</span>
        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsLimit</span><span class="params">()</span> &#123;
            <span class="keyword">return</span> <span class="literal">true</span>;
        &#125;

        <span class="meta">@Override</span>
        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">bindLimitParametersInReverseOrder</span><span class="params">()</span> &#123;
            <span class="keyword">return</span> <span class="literal">true</span>;
        &#125;
    &#125;;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> LimitHandler <span class="title function_">getLimitHandler</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> LIMIT_HANDLER;
    &#125;

    <span class="comment">// lock acquisition support ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsLockTimeouts</span><span class="params">()</span> &#123;
        <span class="comment">// may be http://sqlite.org/c3ref/db_mutex.html ?</span>
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getForUpdateString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsOuterJoinForUpdate</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="comment">// current timestamp support ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsCurrentTimestampSelection</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCurrentTimestampSelectStringCallable</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getCurrentTimestampSelectString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;select current_timestamp&quot;</span>;
    &#125;

    <span class="comment">// SQLException support ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_BUSY</span> <span class="operator">=</span> <span class="number">5</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_LOCKED</span> <span class="operator">=</span> <span class="number">6</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_IOERR</span> <span class="operator">=</span> <span class="number">10</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_CORRUPT</span> <span class="operator">=</span> <span class="number">11</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_NOTFOUND</span> <span class="operator">=</span> <span class="number">12</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_FULL</span> <span class="operator">=</span> <span class="number">13</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_CANTOPEN</span> <span class="operator">=</span> <span class="number">14</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_PROTOCOL</span> <span class="operator">=</span> <span class="number">15</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_TOOBIG</span> <span class="operator">=</span> <span class="number">18</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_CONSTRAINT</span> <span class="operator">=</span> <span class="number">19</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_MISMATCH</span> <span class="operator">=</span> <span class="number">20</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SQLITE_NOTADB</span> <span class="operator">=</span> <span class="number">26</span>;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> SQLExceptionConversionDelegate <span class="title function_">buildSQLExceptionConversionDelegate</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQLExceptionConversionDelegate</span>() &#123;
            <span class="meta">@Override</span>
            <span class="keyword">public</span> JDBCException <span class="title function_">convert</span><span class="params">(SQLException sqlException, String message, String sql)</span> &#123;
                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">errorCode</span> <span class="operator">=</span> JdbcExceptionHelper.extractErrorCode(sqlException) &amp; <span class="number">0xFF</span>;
                <span class="keyword">if</span> (errorCode == SQLITE_TOOBIG || errorCode == SQLITE_MISMATCH) &#123;
                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataException</span>(message, sqlException, sql);
                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (errorCode == SQLITE_BUSY || errorCode == SQLITE_LOCKED) &#123;
                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LockAcquisitionException</span>(message, sqlException, sql);
                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((errorCode &gt;= SQLITE_IOERR &amp;&amp; errorCode &lt;= SQLITE_PROTOCOL) || errorCode == SQLITE_NOTADB) &#123;
                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JDBCConnectionException</span>(message, sqlException, sql);
                &#125;

                <span class="comment">// returning null allows other delegates to operate</span>
                <span class="keyword">return</span> <span class="literal">null</span>;
            &#125;
        &#125;;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> ViolatedConstraintNameExtracter <span class="title function_">getViolatedConstraintNameExtracter</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> EXTRACTER;
    &#125;

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ViolatedConstraintNameExtracter</span> <span class="variable">EXTRACTER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatedViolatedConstraintNameExtracter</span>() &#123;
        <span class="meta">@Override</span>
        <span class="keyword">protected</span> String <span class="title function_">doExtractConstraintName</span><span class="params">(SQLException sqle)</span> <span class="keyword">throws</span> NumberFormatException &#123;
            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">errorCode</span> <span class="operator">=</span> JdbcExceptionHelper.extractErrorCode(sqle) &amp; <span class="number">0xFF</span>;
            <span class="keyword">if</span> (errorCode == SQLITE_CONSTRAINT) &#123;
                <span class="keyword">return</span> extractUsingTemplate(<span class="string">&quot;constraint &quot;</span>, <span class="string">&quot; failed&quot;</span>, sqle.getMessage());
            &#125;
            <span class="keyword">return</span> <span class="literal">null</span>;
        &#125;
    &#125;;

    <span class="comment">// union subclass support ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsUnionAll</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;

    <span class="comment">// DDL support ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canCreateSchema</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasAlterTable</span><span class="params">()</span> &#123;
        <span class="comment">// As specified in NHibernate dialect</span>
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dropConstraints</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">qualifyIndexName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getAddColumnString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;add column&quot;</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getDropForeignKeyString</span><span class="params">()</span> &#123;
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;No drop foreign key syntax supported by SQLiteDialect&quot;</span>);
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getAddForeignKeyConstraintString</span><span class="params">(String constraintName,</span>
<span class="params">                                                   String[] foreignKey, String referencedTable, String[] primaryKey,</span>
<span class="params">                                                   <span class="type">boolean</span> referencesPrimaryKey)</span> &#123;
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;No add foreign key syntax supported by SQLiteDialect&quot;</span>);
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getAddPrimaryKeyConstraintString</span><span class="params">(String constraintName)</span> &#123;
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;No add primary key syntax supported by SQLiteDialect&quot;</span>);
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsCommentOn</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsIfExistsBeforeTableName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doesReadCommittedCauseWritersToBlockReaders</span><span class="params">()</span> &#123;
        <span class="comment">// TODO Validate (WAL mode...)</span>
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doesRepeatableReadCauseReadersToBlockWriters</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsTupleDistinctCounts</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getInExpressionCountLimit</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="number">1000</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> UniqueDelegate <span class="title function_">getUniqueDelegate</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> uniqueDelegate;
    &#125;

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SQLiteUniqueDelegate</span> <span class="keyword">extends</span> <span class="title class_">DefaultUniqueDelegate</span> &#123;
        <span class="keyword">public</span> <span class="title function_">SQLiteUniqueDelegate</span><span class="params">(Dialect dialect)</span> &#123;
            <span class="built_in">super</span>(dialect);
        &#125;

        <span class="meta">@Override</span>
        <span class="keyword">public</span> String <span class="title function_">getColumnDefinitionUniquenessFragment</span><span class="params">(Column column)</span> &#123;
            <span class="keyword">return</span> <span class="string">&quot; unique&quot;</span>;
        &#125;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getSelectGUIDString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;select hex(randomblob(16))&quot;</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> ScrollMode <span class="title function_">defaultScrollMode</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> ScrollMode.FORWARD_ONLY;
    &#125;
&#125;</code></pre>
<h5 id="sqlitedialectidentitycolumnsupport"><a class="markdownIt-Anchor" href="#sqlitedialectidentitycolumnsupport"></a> SQLiteDialectIdentityColumnSupport</h5>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.sqlite;

<span class="keyword">import</span> org.hibernate.dialect.Dialect;
<span class="keyword">import</span> org.hibernate.dialect.identity.IdentityColumnSupportImpl;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SQLiteDialectIdentityColumnSupport</span> <span class="keyword">extends</span> <span class="title class_">IdentityColumnSupportImpl</span> &#123;
    <span class="keyword">public</span> <span class="title function_">SQLiteDialectIdentityColumnSupport</span><span class="params">(Dialect dialect)</span> &#123;
        <span class="built_in">super</span>(dialect);
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsIdentityColumns</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasDataTypeInIdentityColumn</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getIdentitySelectString</span><span class="params">(String table, String column, <span class="type">int</span> type)</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;select last_insert_rowid()&quot;</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">getIdentityColumnString</span><span class="params">(<span class="type">int</span> type)</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;integer&quot;</span>;
    &#125;
&#125;</code></pre>
<h5 id="sqlitemetadatabuilderinitializer"><a class="markdownIt-Anchor" href="#sqlitemetadatabuilderinitializer"></a> SQLiteMetadataBuilderInitializer</h5>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.sqlite;


<span class="keyword">import</span> org.hibernate.boot.MetadataBuilder;
<span class="keyword">import</span> org.hibernate.boot.registry.StandardServiceRegistry;
<span class="keyword">import</span> org.hibernate.boot.spi.MetadataBuilderInitializer;
<span class="keyword">import</span> org.hibernate.engine.jdbc.dialect.internal.DialectResolverSet;
<span class="keyword">import</span> org.hibernate.engine.jdbc.dialect.spi.DialectResolver;
<span class="keyword">import</span> org.jboss.logging.Logger;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SQLiteMetadataBuilderInitializer</span> <span class="keyword">implements</span> <span class="title class_">MetadataBuilderInitializer</span> &#123;

    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(SQLiteMetadataBuilderInitializer.class);

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contribute</span><span class="params">(MetadataBuilder metadataBuilder, StandardServiceRegistry serviceRegistry)</span> &#123;
        <span class="type">DialectResolver</span> <span class="variable">dialectResolver</span> <span class="operator">=</span> serviceRegistry.getService(DialectResolver.class);

        <span class="keyword">if</span> (!(dialectResolver <span class="keyword">instanceof</span> DialectResolverSet)) &#123;
            logger.warnf(<span class="string">&quot;DialectResolver &#x27;%s&#x27; is not an instance of DialectResolverSet, not registering SQLiteDialect&quot;</span>,
                    dialectResolver);
            <span class="keyword">return</span>;
        &#125;

        ((DialectResolverSet) dialectResolver).addResolver(resolver);
    &#125;

    <span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">SQLiteDialect</span> <span class="variable">dialect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQLiteDialect</span>();

    <span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">DialectResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> (DialectResolver) info -&gt; &#123;
        <span class="keyword">if</span> (info.getDatabaseName().equals(<span class="string">&quot;SQLite&quot;</span>)) &#123;
            <span class="keyword">return</span> dialect;
        &#125;

        <span class="keyword">return</span> <span class="literal">null</span>;
    &#125;;
&#125;</code></pre>
<h4 id="applicationproperties-4"><a class="markdownIt-Anchor" href="#applicationproperties-4"></a> application.properties</h4>
<p>对 mysql 的配置，修改到了对 sqlite 的配置</p>
<pre><code class="highlight properties"><span class="comment"># 配置jsp的寻找路径</span>
<span class="attr">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span>
<span class="comment">#更改tomcat默认端口号</span>
<span class="attr">server.port</span>=<span class="string">8088</span>
<span class="comment">#更改访问上下文路径/访问路径 localhost:8088/leeBoot/...</span>
<span class="attr">server.context-path</span>=<span class="string">/leeBoot</span>
<span class="comment">#配置mysql数据源</span>
<span class="comment">#spring.datasource.url=jdbc:mysql://127.0.0.1:3306/lee_test?characterEncoding=UTF-8</span>
<span class="comment">#spring.datasource.username=root</span>
<span class="comment">#spring.datasource.password=admin</span>
<span class="comment">#spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span>
<span class="comment">#新增数据库链接必须的参数（jpa方式要加，mybatis方式不用加）</span>
<span class="comment">#spring.jpa.properties.hibernate.hbm2ddl.auto=update</span>
<span class="comment"></span>
<span class="comment">#mybaits基于xml要额外加两条配置</span>
<span class="comment">#mybatis.mapper-locations=classpath:com/leeboer/springboot/mapper/*.xml</span>
<span class="comment">#mybatis.type-aliases-package=com.leeboer.springboot.pojo</span>
<span class="comment"></span>
<span class="comment">#SQLite数据库配置</span>
<span class="attr">spring.jpa.database-platform</span>=<span class="string">com.leeboer.sqlite.SQLiteDialect</span>
<span class="comment">#表结构由hibernate根据实体类来帮你创建</span>
<span class="attr">spring.jpa.generate-ddl</span>=<span class="string">true</span>
<span class="comment">#自动根据Entity配置创建表</span>
<span class="attr">spring.jpa.hibernate.ddl-auto</span>=<span class="string">update</span>
<span class="comment">#数据库文件位置,该文件没有的话会自动创建</span>
<span class="attr">spring.datasource.url</span>=<span class="string">jdbc:sqlite:leeboer.db</span>
<span class="comment">#驱动名称</span>
<span class="attr">spring.datasource.driver-class-name</span>=<span class="string">org.sqlite.JDBC</span></code></pre>
<h4 id="sqlite创建表添加数据"><a class="markdownIt-Anchor" href="#sqlite创建表添加数据"></a> sqlite创建表/添加数据</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.leeboer.sqlite;

<span class="keyword">import</span> java.sql.Connection;
<span class="keyword">import</span> java.sql.DriverManager;
<span class="keyword">import</span> java.sql.ResultSet;
<span class="keyword">import</span> java.sql.Statement;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/7/5.</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateTableCategory</span> &#123;
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
        <span class="keyword">try</span> &#123;
            <span class="comment">// 加载驱动,连接sqlite的jdbc</span>
            Class.forName(<span class="string">&quot;org.sqlite.JDBC&quot;</span>);
            <span class="comment">// 连接数据库how2j.db,不用手动创建。。。</span>
            <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:sqlite:leeboer.db&quot;</span>);
            <span class="comment">// 创建连接对象，是Java的一个操作数据库的重要接口</span>
            <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();
            <span class="comment">// 判断是否有表tables的存在。有则删除</span>
            statement.executeUpdate(<span class="string">&quot;drop table if exists Category&quot;</span>);
            <span class="comment">// 创建表</span>
            statement.executeUpdate(<span class="string">&quot;create table Category(id int,name varchar(20))&quot;</span>);
            <span class="comment">//插入数据</span>
            statement.executeUpdate(<span class="string">&quot;insert into Category values(1,&#x27;Gareen&#x27;)&quot;</span>);
            statement.executeUpdate(<span class="string">&quot;insert into Category values(2,&#x27;yellow&#x27;)&quot;</span>);
            statement.executeUpdate(<span class="string">&quot;insert into Category values(3,&#x27;red&#x27;)&quot;</span>);
            statement.executeUpdate(<span class="string">&quot;insert into Category values(4,&#x27;black&#x27;)&quot;</span>);
            <span class="comment">// 搜索数据库，将搜索的放入数据集ResultSet中</span>
            <span class="type">ResultSet</span> <span class="variable">rSet</span> <span class="operator">=</span> statement.executeQuery(<span class="string">&quot;select * from Category&quot;</span>);
            <span class="keyword">while</span> (rSet.next()) &#123; <span class="comment">// 遍历这个数据集</span>
                System.out.println(<span class="string">&quot;id：&quot;</span> + rSet.getInt(<span class="number">1</span>));
                System.out.println(<span class="string">&quot;姓名：&quot;</span> + rSet.getString(<span class="number">2</span>));
            &#125;
            rSet.close();<span class="comment">// 关闭数据集</span>
            connection.close();<span class="comment">// 关闭数据库连接</span>
        &#125; <span class="keyword">catch</span> (Exception e) &#123;
            <span class="comment">// TODO Auto-generated catch block</span>
            e.printStackTrace();
        &#125;
    &#125;
&#125;
</code></pre>
<h4 id="测试运行-3"><a class="markdownIt-Anchor" href="#测试运行-3"></a> 测试运行</h4>
<p>配置好之后，即可基于之前的例子访问localhost:8088/leeBoot/listCategory可得到相同的结果</p>
<h2 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h2>
<h3 id="单元测试-2"><a class="markdownIt-Anchor" href="#单元测试-2"></a> 单元测试</h3>
<p><u>该案例基于前面的jpa案例</u></p>
<p>有时候，springboot里要做单元测试，而不是直接跑起来，比如jpa章节的查询数据，想跑个测试，看看数据库里的数据，接下来讲该怎么做</p>
<h4 id="pomxml-5"><a class="markdownIt-Anchor" href="#pomxml-5"></a> pom.xml</h4>
<ol>
<li>修改junit版本为4.12</li>
<li>增加spring-boot-starter-test</li>
</ol>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>

<span class="comment">&lt;!-- springboot test --&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
</code></pre>
<h4 id="测试类"><a class="markdownIt-Anchor" href="#测试类"></a> 测试类</h4>
<ol>
<li>需要加上2个注解
<ul>
<li>@RunWith(SpringRunner.class)</li>
<li>@SpringBooTest(classes=Application.class)</li>
</ul>
</li>
<li>自动装配CategoryDAO dao，以便使用</li>
<li>test方法加上@test注解，然后就可以使用dao来工作了</li>
<li>运行的时候选择JUnit Test方式</li>
</ol>
<pre><code class="highlight java"><span class="keyword">package</span> com.how2java.springboot.test;
 
<span class="keyword">import</span> java.util.List;
 
<span class="keyword">import</span> org.junit.Test;
<span class="keyword">import</span> org.junit.runner.RunWith;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span class="keyword">import</span> com.how2java.springboot.Application;
<span class="keyword">import</span> com.how2java.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.how2java.springboot.pojo.Category;
 
<span class="meta">@RunWith(SpringRunner.class)</span>
<span class="meta">@SpringBootTest(classes = Application.class)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJPA</span> &#123;
 
    <span class="meta">@Autowired</span> CategoryDAO dao;
     
    <span class="meta">@Test</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;
        List&lt;Category&gt; cs=  dao.findAll();
        <span class="keyword">for</span> (Category c : cs) &#123;
            System.out.println(<span class="string">&quot;c.getName():&quot;</span>+ c.getName());
        &#125;
         
    &#125;
&#125;</code></pre>
<h3 id="jpa条件查询"><a class="markdownIt-Anchor" href="#jpa条件查询"></a> JPA条件查询</h3>
<h4 id="jpa条件查询方式"><a class="markdownIt-Anchor" href="#jpa条件查询方式"></a> JPA条件查询方式</h4>
<p>JPA 条件查询方式很有意思，是不需要写 SQL 语句的，只需要在 dao 接口里按照规范的命名定义对应的方法名，及可达到查询相应字段的效果了。<br />
在如下代码里做了如下事情：</p>
<ol>
<li>首先通过 @Before 把 Category表里所有数据都删除了，并新增了10条。</li>
<li>然后 test1() 查询所有数据，看看新增的10条数据。</li>
<li>接着，test2() 通过自定义的接口方法 findByName，根据name 查询分类表</li>
<li>接着，test3() 通过自定义的接口方法 findByNameLikeAndIdGreaterThanOrderByNameAsc，根据名称模糊查询，id 大于某值, 并且名称正排序查询。</li>
</ol>
<p><strong>Category.java</strong></p>
<pre><code class="highlight java"><span class="keyword">import</span> javax.persistence.Column;
<span class="keyword">import</span> javax.persistence.Entity;
<span class="keyword">import</span> javax.persistence.GeneratedValue;
<span class="keyword">import</span> javax.persistence.GenerationType;
<span class="keyword">import</span> javax.persistence.Id;
<span class="keyword">import</span> javax.persistence.Table;
 
<span class="meta">@Entity</span>
<span class="meta">@Table(name = &quot;category_&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
 
    <span class="meta">@Id</span>
    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="meta">@Column(name = &quot;id&quot;)</span>
    <span class="keyword">private</span> <span class="type">int</span> id;
     
    <span class="meta">@Column(name = &quot;name&quot;)</span>
    <span class="keyword">private</span> String name;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Category [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;
    &#125;
     
&#125;</code></pre>
<p><strong>CategoryDAO.java</strong></p>
<pre><code class="highlight java">
<span class="keyword">import</span> java.util.List;
 
<span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;
 
<span class="keyword">import</span> com.how2java.springboot.pojo.Category;
 
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryDAO</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Category,Integer&gt;&#123;
 
    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">findByName</span><span class="params">(String name)</span>;
     
    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">findByNameLikeAndIdGreaterThanOrderByNameAsc</span><span class="params">(String name, <span class="type">int</span> id)</span>;
&#125;</code></pre>
<p><strong>TestJPA.java</strong></p>
<pre><code class="highlight java">
<span class="keyword">import</span> java.util.List;
 
<span class="keyword">import</span> org.junit.Before;
<span class="keyword">import</span> org.junit.Test;
<span class="keyword">import</span> org.junit.runner.RunWith;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
 
<span class="keyword">import</span> com.how2java.springboot.Application;
<span class="keyword">import</span> com.how2java.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.how2java.springboot.pojo.Category;
 
<span class="meta">@RunWith(SpringRunner.class)</span>
<span class="meta">@SpringBootTest(classes = Application.class)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJPA</span> &#123;
 
    <span class="meta">@Autowired</span> CategoryDAO dao;
     
    <span class="meta">@Before</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;
        List&lt;Category&gt; cs=  dao.findAll();
        <span class="keyword">for</span> (Category c : cs) &#123;
            dao.delete(c);
        &#125;
         
        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;
            <span class="type">Category</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();
            c.setName(<span class="string">&quot;category &quot;</span> + i);
            dao.save(c);
        &#125;
         
    &#125;
     
    <span class="meta">@Test</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;
        List&lt;Category&gt; cs=  dao.findAll();
        System.out.println(<span class="string">&quot;所有的分类信息：&quot;</span>);
        <span class="keyword">for</span> (Category c : cs) &#123;
            System.out.println(c.getName());
        &#125;
        System.out.println();
    &#125;
     
    <span class="meta">@Test</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;
        System.out.println(<span class="string">&quot;查询名称是 \&quot;category 1 \&quot;的分类:&quot;</span>);
        List&lt;Category&gt; cs=  dao.findByName(<span class="string">&quot;category 1&quot;</span>);
        <span class="keyword">for</span> (Category c : cs) &#123;
            System.out.println(<span class="string">&quot;c.getName():&quot;</span>+ c.getName());
        &#125;
        System.out.println();
    &#125;
    <span class="meta">@Test</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> &#123;
        System.out.println(<span class="string">&quot;根据名称模糊查询，id 大于5, 并且名称正排序查询&quot;</span>);
        List&lt;Category&gt; cs=  dao.findByNameLikeAndIdGreaterThanOrderByNameAsc(<span class="string">&quot;%3%&quot;</span>,<span class="number">5</span>);
        <span class="keyword">for</span> (Category c : cs) &#123;
            System.out.println(c);
        &#125;
        System.out.println();
         
    &#125;
&#125;</code></pre>
<h4 id="实现原理"><a class="markdownIt-Anchor" href="#实现原理"></a> 实现原理</h4>
<p>虽然JPA没有自己动手写sql语句，但是通过反射获取自定义的接口方法里提供的信息，就知道用户希望根据什么条件查询了，然后 JPA 底层再偷偷摸摸地拼装对应的 sql 语句，丢给数据库，就达到了条件查询的效果啦</p>
<h4 id="条件查询规范"><a class="markdownIt-Anchor" href="#条件查询规范"></a> 条件查询规范</h4>
<p>JPA条件查询方式只是个别举例，下表把jpa做的各种查询规范都列出来了，如果要做其他相关查询，按照表格中的规范设计接口方法即可。</p>
<h3 id="上传文件"><a class="markdownIt-Anchor" href="#上传文件"></a> 上传文件</h3>
<p>先讲解一个上传图片的案例</p>
<h4 id="jsp-5"><a class="markdownIt-Anchor" href="#jsp-5"></a> jsp</h4>
<p>在jsp目录下新建uploadPage.jsp需要注意几点：</p>
<ol>
<li><code>method=&quot;post&quot;</code>是必须的</li>
<li><code>enctype=&quot;multipart/form-data&quot;</code>是必须的，表示提交二进制文件</li>
<li><code>name=&quot;file&quot;</code>是必须的，和后续服务端对应</li>
<li><code>accept=&quot;image/*&quot;</code>表示只选择图片</li>
</ol>
<pre><code class="highlight html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
 
<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span>
  选择图片:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span>
  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span>
<span class="tag">&lt;/<span class="name">form</span>&gt;</span></code></pre>
<h4 id="controller-4"><a class="markdownIt-Anchor" href="#controller-4"></a> Controller</h4>
<ol>
<li>接收上传的 文件</li>
</ol>
<pre><code class="highlight java"><span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file</code></pre>
<ol start="2">
<li>根据时间戳创建新的文件名，防止覆盖</li>
</ol>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> System.currentTimeMillis()+file.getOriginalFilename();</code></pre>
<ol start="3">
<li>通过req.getServletContext().getRealPath(“”)获取当前项目真实路劲，然后拼接前面的文件名</li>
</ol>
<pre><code class="highlight java">String destFileName=req.getServletContext().getRealPath(<span class="string">&quot;&quot;</span>)+<span class="string">&quot;uploaded&quot;</span>+File.separator+fileName;</code></pre>
<ol start="4">
<li>第一次运行的时候，这个文件所在的目录往往是不存在的，这里需要创建一下目录</li>
</ol>
<pre><code class="highlight java"><span class="type">File</span> <span class="variable">destFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destFileName);
destFile.getParentFile().mkdirs();</code></pre>
<ol start="5">
<li>把浏览器上传的文件复制到希望的位置</li>
</ol>
<pre><code class="highlight java">file.transferTo(destFile);</code></pre>
<ol start="6">
<li>把文件名放在model里，方便后续使用</li>
</ol>
<pre><code class="highlight java">m.addAttribute(<span class="string">&quot;fileName&quot;</span>,fileName);</code></pre>
<pre><code class="highlight java"><span class="keyword">package</span> com.how2java.springboot.web;
<span class="keyword">import</span> java.io.File;
<span class="keyword">import</span> java.io.FileNotFoundException;
<span class="keyword">import</span> java.io.IOException;
 
<span class="keyword">import</span> javax.servlet.http.HttpServletRequest;
 
<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;
  
<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;
  
    <span class="meta">@RequestMapping(&quot;/uploadPage&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">uploadPage</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;uploadPage&quot;</span>;
    &#125;
     
    <span class="meta">@RequestMapping(value = &quot;/upload&quot;, method = RequestMethod.POST)</span>
    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(HttpServletRequest req, <span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file,Model m)</span> &#123;
            <span class="keyword">try</span> &#123;
                <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> System.currentTimeMillis()+file.getOriginalFilename();
                String destFileName=req.getServletContext().getRealPath(<span class="string">&quot;&quot;</span>)+<span class="string">&quot;uploaded&quot;</span>+File.separator+fileName;
                 
                <span class="type">File</span> <span class="variable">destFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destFileName);
                destFile.getParentFile().mkdirs();
                file.transferTo(destFile);
                 
                m.addAttribute(<span class="string">&quot;fileName&quot;</span>,fileName);
            &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;
                e.printStackTrace();
                <span class="keyword">return</span> <span class="string">&quot;上传失败,&quot;</span> + e.getMessage();
            &#125; <span class="keyword">catch</span> (IOException e) &#123;
                e.printStackTrace();
                <span class="keyword">return</span> <span class="string">&quot;上传失败,&quot;</span> + e.getMessage();
            &#125;
             
            <span class="keyword">return</span> <span class="string">&quot;showImg&quot;</span>;
    &#125;   
&#125;</code></pre>
<h4 id="设置上传文件的大小"><a class="markdownIt-Anchor" href="#设置上传文件的大小"></a> 设置上传文件的大小</h4>
<p>默认是1m，修改application.properties</p>
<pre><code class="highlight properties"><span class="attr">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span>
<span class="attr">spring.http.multipart.maxFileSize</span>=<span class="string">100Mb</span>
<span class="attr">spring.http.multipart.maxRequestSize</span>=<span class="string">100Mb</span></code></pre>
<h3 id="restful"><a class="markdownIt-Anchor" href="#restful"></a> Restful</h3>
<h4 id="restful风格是什么"><a class="markdownIt-Anchor" href="#restful风格是什么"></a> Restful风格是什么</h4>
<p>大家在做Web开发的过程中，method常用的值是get和post. 可事实上，method值还可以是put和delete等等其他值。<br />
既然method值如此丰富，那么就可以考虑使用同一个url，但是约定不同的method来实施不同的业务，这就是Restful的基本考虑。<br />
CRUD是最常见的操作，在使用Restful 风格之前，通常的增加做法是这样的：</p>
<pre><code class="highlight plaintext">/addCategory?name=xxx</code></pre>
<p>可是使用了Restful风格之后，增加就变成了：</p>
<pre><code class="highlight plaintext">/categories</code></pre>
<p>CRUD如下表所示，URL就都使用一样的 “/categories”，区别只是在于method不同，服务器根据method的不同来判断浏览器期望做的业务行为</p>
<h4 id="listcategoryjsp"><a class="markdownIt-Anchor" href="#listcategoryjsp"></a> listCategory.jsp</h4>
<p>对之前的listCategory.jsp做出如下修改</p>
<ol>
<li>
<p>增加<br />
1.1. action修改为&quot;categories&quot;</p>
</li>
<li>
<p>删除<br />
2.1. url修改为categories/id<br />
2.2 点击超链接后，会使用form提交，并且提交_method的值为delete，以达到和增加类似的效果</p>
</li>
</ol>
<pre><code class="highlight JavaScript">$(<span class="keyword">function</span>(<span class="params"></span>)&#123;
    $(<span class="string">&quot;.delete&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;
    <span class="keyword">var</span> href=$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>);
    $(<span class="string">&quot;#formdelete&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;action&quot;</span>,href).<span class="title function_">submit</span>();
    <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;)
&#125;)</code></pre>
<ol start="3">
<li>获取<br />
3.1. url修改为了/categories/id</li>
<li>在最开始增加了jQuery.main.js的引入</li>
</ol>
<pre><code class="highlight plaintext">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;</code></pre>
<pre><code class="highlight html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
 
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;
   
<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
 
    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript">       <span class="comment">/*将post method 改变为delete*/</span></span>
<span class="language-javascript">      $(<span class="keyword">function</span>(<span class="params"></span>)&#123;                    </span>
<span class="language-javascript">           $(<span class="string">&quot;.delete&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span>
<span class="language-javascript">               <span class="keyword">var</span> href=$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>);</span>
<span class="language-javascript">               $(<span class="string">&quot;#formdelete&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;action&quot;</span>,href).<span class="title function_">submit</span>();</span>
<span class="language-javascript">               <span class="keyword">return</span> <span class="literal">false</span>;</span>
<span class="language-javascript">           &#125;)</span>
<span class="language-javascript">       &#125;)</span>
<span class="language-javascript">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  
    
<span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>
 
<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
 
<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:500px;margin:20px auto;text-align: center&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">&#x27;center&#x27;</span> <span class="attr">border</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">cellspacing</span>=<span class="string">&#x27;0&#x27;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">tr</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>name<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;<span class="name">td</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>
        <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;page.content&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;c&quot;</span> <span class="attr">varStatus</span>=<span class="string">&quot;st&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;c.id&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;c.name&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;categories/$&#123;c.id&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">href</span>=<span class="string">&quot;categories/$&#123;c.id&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span>
         
    <span class="tag">&lt;/<span class="name">table</span>&gt;</span>
    <span class="tag">&lt;<span class="name">br</span>&gt;</span>
    <span class="tag">&lt;<span class="name">div</span>&gt;</span>
                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=0&quot;</span>&gt;</span>[首  页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.number-1&#125;&quot;</span>&gt;</span>[上一页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.number+1&#125;&quot;</span>&gt;</span>[下一页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?start=$&#123;page.totalPages-1&#125;&quot;</span>&gt;</span>[末  页]<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
    <span class="tag">&lt;<span class="name">br</span>&gt;</span>
    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;categories&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span>
    name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span>
    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span>
     
    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>
     
    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;formdelete&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> &gt;</span>
       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DELETE&quot;</span>&gt;</span>
   <span class="tag">&lt;/<span class="name">form</span>&gt;</span>
<span class="tag">&lt;/<span class="name">div</span>&gt;</span></code></pre>
<h4 id="editcategoryjsp"><a class="markdownIt-Anchor" href="#editcategoryjsp"></a> editCategory.jsp</h4>
<p>action修改为了categories/id</p>
<blockquote>
<p>注意：form 下增加 filed, 虽然这个form的method是post, 但是springmvc看到这个_method的值是put后，会把其修改为put.</p>
</blockquote>
<pre><code class="highlight plaintext">&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;PUT&quot;&gt;</code></pre>
<pre><code class="highlight html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
 pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;
 
<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin:0px auto; width:500px&quot;</span>&gt;</span>
 
<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;../categories/$&#123;c.id&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span>
name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;c.name&#125;&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span>
<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span>
 
<span class="tag">&lt;/<span class="name">form</span>&gt;</span>
<span class="tag">&lt;/<span class="name">div</span>&gt;</span></code></pre>
<h4 id="categorycontroller"><a class="markdownIt-Anchor" href="#categorycontroller"></a> CategoryController</h4>
<p>CRUD的RequestMapping都修改为了/categories,以前用的注解叫做@RequestMapper,现在分别叫做 GetMapper, PutMapper, PostMapper 和 DeleteMapper 用于表示接受对应的Method</p>
<pre><code class="highlight java"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.data.domain.Page;
<span class="keyword">import</span> org.springframework.data.domain.PageRequest;
<span class="keyword">import</span> org.springframework.data.domain.Pageable;
<span class="keyword">import</span> org.springframework.data.domain.Sort;
<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.DeleteMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.PutMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
 
<span class="keyword">import</span> com.how2java.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.how2java.springboot.pojo.Category;
  
<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;
    <span class="meta">@Autowired</span> CategoryDAO categoryDAO;
     
    <span class="meta">@GetMapping(&quot;/categories&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">listCategory</span><span class="params">(Model m,<span class="meta">@RequestParam(value = &quot;start&quot;, defaultValue = &quot;0&quot;)</span> <span class="type">int</span> start,<span class="meta">@RequestParam(value = &quot;size&quot;, defaultValue = &quot;5&quot;)</span> <span class="type">int</span> size)</span> <span class="keyword">throws</span> Exception &#123;
        start = start&lt;<span class="number">0</span>?<span class="number">0</span>:start;
        <span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sort</span>(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>);
        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageRequest</span>(start, size, sort);
        Page&lt;Category&gt; page =categoryDAO.findAll(pageable);
        m.addAttribute(<span class="string">&quot;page&quot;</span>, page);
        <span class="keyword">return</span> <span class="string">&quot;listCategory&quot;</span>;
    &#125;
 
    <span class="meta">@PostMapping(&quot;/categories&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">addCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryDAO.save(c);
        <span class="keyword">return</span> <span class="string">&quot;redirect:/categories&quot;</span>;
    &#125;
    <span class="meta">@DeleteMapping(&quot;/categories/&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">deleteCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryDAO.delete(c);
        <span class="keyword">return</span> <span class="string">&quot;redirect:/categories&quot;</span>;
    &#125;
    <span class="meta">@PutMapping(&quot;/categories/&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">updateCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryDAO.save(c);
        <span class="keyword">return</span> <span class="string">&quot;redirect:/categories&quot;</span>;
    &#125;
    <span class="meta">@GetMapping(&quot;/categories/&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">getCategory</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">int</span> id,Model m)</span> <span class="keyword">throws</span> Exception &#123;
        Category c= categoryDAO.getOne(id);
        m.addAttribute(<span class="string">&quot;c&quot;</span>, c);
        <span class="keyword">return</span> <span class="string">&quot;editCategory&quot;</span>;
    &#125;
&#125;</code></pre>
<h3 id="json"><a class="markdownIt-Anchor" href="#json"></a> JSON</h3>
<p>分别使用json的方式，提交，获取单个和获取多个</p>
<pre><code class="highlight plaintext">http://localhost:8080/submit.html</code></pre>
<pre><code class="highlight plaintext">http://localhost:8080/getOne.html</code></pre>
<pre><code class="highlight plaintext">http://localhost:8080/getMany.html</code></pre>
<h4 id="entity实体类"><a class="markdownIt-Anchor" href="#entity实体类"></a> Entity实体类</h4>
<p>增加一个注解：@JsonIgnoreProperties({<br />
“handler”,“hibernateLazyInitializer”})，否则会出错</p>
<pre><code class="highlight java"> 
<span class="keyword">import</span> javax.persistence.Column;
<span class="keyword">import</span> javax.persistence.Entity;
<span class="keyword">import</span> javax.persistence.GeneratedValue;
<span class="keyword">import</span> javax.persistence.GenerationType;
<span class="keyword">import</span> javax.persistence.Id;
<span class="keyword">import</span> javax.persistence.Table;
 
<span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;
 
<span class="meta">@Entity</span>
<span class="meta">@Table(name = &quot;category_&quot;)</span>
<span class="meta">@JsonIgnoreProperties(&#123; &quot;handler&quot;,&quot;hibernateLazyInitializer&quot; &#125;)</span> 
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
 
    <span class="meta">@Id</span>
    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="meta">@Column(name = &quot;id&quot;)</span>
    <span class="keyword">private</span> <span class="type">int</span> id;
     
    <span class="meta">@Column(name = &quot;name&quot;)</span>
    <span class="keyword">private</span> String name;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Category [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;
    &#125;
     
&#125;</code></pre>
<h4 id="controller-5"><a class="markdownIt-Anchor" href="#controller-5"></a> Controller</h4>
<p>控制器里提供三个方法，分别用来处理json提交，json获取单个对象，json获取多个对象</p>
<p><strong>@RestController</strong> 表示@ResponseBody<br />
和@Controller两个注解的结合，前者的作用是标注框架，该controller中返回的http数据包不是http页面，是json或者是xml等其他数据格式（即修改http数据包包头中的相关字段）</p>
<p><strong>@ResquestBody</strong> 如果要接受json或xml数据，给Controller的方法参数注释该注解，根据HTTP Request Header的content-Type的内容,通过适当的HttpMessageConverter转换为JAVA类</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.util.List;
 
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.data.domain.Page;
<span class="keyword">import</span> org.springframework.data.domain.PageRequest;
<span class="keyword">import</span> org.springframework.data.domain.Pageable;
<span class="keyword">import</span> org.springframework.data.domain.Sort;
<span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="keyword">import</span> org.springframework.web.bind.annotation.PutMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;
 
<span class="keyword">import</span> com.how2java.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.how2java.springboot.pojo.Category;
  
<span class="meta">@RestController</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;
    <span class="meta">@Autowired</span> CategoryDAO categoryDAO;
     
    <span class="meta">@GetMapping(&quot;/category&quot;)</span>
    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">listCategory</span><span class="params">(<span class="meta">@RequestParam(value = &quot;start&quot;, defaultValue = &quot;0&quot;)</span> <span class="type">int</span> start,<span class="meta">@RequestParam(value = &quot;size&quot;, defaultValue = &quot;5&quot;)</span> <span class="type">int</span> size)</span> <span class="keyword">throws</span> Exception &#123;
        start = start&lt;<span class="number">0</span>?<span class="number">0</span>:start;
        <span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sort</span>(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>);
        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageRequest</span>(start, size, sort);
        Page&lt;Category&gt; page =categoryDAO.findAll(pageable);
        <span class="keyword">return</span> page.getContent();
    &#125;
     
    <span class="meta">@GetMapping(&quot;/category/&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception &#123;
        Category c= categoryDAO.getOne(id);
        System.out.println(c);
        <span class="keyword">return</span> c;
    &#125;
    <span class="meta">@PutMapping(&quot;/category&quot;)</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCategory</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span> <span class="keyword">throws</span> Exception &#123;
        System.out.println(<span class="string">&quot;springboot接受到浏览器以JSON格式提交的数据：&quot;</span>+category);
    &#125;
&#125;</code></pre>
<h4 id="ajax"><a class="markdownIt-Anchor" href="#ajax"></a> Ajax</h4>
<h5 id="submithtml"><a class="markdownIt-Anchor" href="#submithtml"></a> submit.html</h5>
<p>访问地址</p>
<pre><code class="highlight plaintext">http://localhost:8080/submit.html</code></pre>
<p>提交成功后，在springboot控制台查看使用json方式提交的数据</p>
<pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">title</span>&gt;</span>用AJAX以JSON方式提交数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span>
<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">body</span>&gt;</span>
    <span class="tag">&lt;<span class="name">form</span> &gt;</span>
       id：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>
       名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;category xxx&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sender&quot;</span>&gt;</span> 
    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>
    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;messageDiv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>
         
    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript">    $(<span class="string">&#x27;#sender&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span>
<span class="language-javascript">        <span class="keyword">var</span> id=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;id&#x27;</span>).<span class="property">value</span>;</span>
<span class="language-javascript">        <span class="keyword">var</span> name=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;name&#x27;</span>).<span class="property">value</span>;</span>
<span class="language-javascript">        <span class="keyword">var</span> category=&#123;<span class="string">&quot;name&quot;</span>:name,<span class="string">&quot;id&quot;</span>:id&#125;;</span>
<span class="language-javascript">        <span class="keyword">var</span> jsonData = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(category);</span>
<span class="language-javascript">        <span class="keyword">var</span> page=<span class="string">&quot;category&quot;</span>;</span>
<span class="language-javascript">          </span>
<span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span>
<span class="language-javascript">               <span class="attr">type</span>:<span class="string">&quot;put&quot;</span>,</span>
<span class="language-javascript">               <span class="attr">url</span>: page,</span>
<span class="language-javascript">               <span class="attr">data</span>:jsonData,</span>
<span class="language-javascript">               <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span>
<span class="language-javascript">               contentType : <span class="string">&quot;application/json;charset=UTF-8&quot;</span>,</span>
<span class="language-javascript">               <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">result</span>)&#123;</span>
<span class="language-javascript">               &#125;</span>
<span class="language-javascript">            &#125;);</span>
<span class="language-javascript">           <span class="title function_">alert</span>(<span class="string">&quot;提交成功，请在springboot控制台查看服务端接收到的数据&quot;</span>);</span>
<span class="language-javascript">  </span>
<span class="language-javascript">    &#125;);</span>
<span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
<span class="tag">&lt;/<span class="name">body</span>&gt;</span>
     
<span class="tag">&lt;/<span class="name">html</span>&gt;</span></code></pre>
<h5 id="getonehtml"><a class="markdownIt-Anchor" href="#getonehtml"></a> getOne.html</h5>
<p>访问地址：</p>
<pre><code class="highlight plaintext">http://localhost:8080/getOne.html</code></pre>
<pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">title</span>&gt;</span>用AJAX以JSON方式获取数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span>
<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">body</span>&gt;</span>
    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;通过AJAX获取一个Hero对象---&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sender&quot;</span>&gt;</span> 
     
    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;messageDiv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>
         
    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript">    $(<span class="string">&#x27;#sender&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span>
<span class="language-javascript">        <span class="keyword">var</span> url=<span class="string">&quot;category/10&quot;</span>;</span>
<span class="language-javascript">        $.<span class="title function_">get</span>(</span>
<span class="language-javascript">                url,</span>
<span class="language-javascript">                <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span>
<span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span>
<span class="language-javascript">                     <span class="keyword">var</span> json=data;</span>
<span class="language-javascript">                     <span class="keyword">var</span> name =json.<span class="property">name</span>;</span>
<span class="language-javascript">                     <span class="keyword">var</span> id = json.<span class="property">id</span>;</span>
<span class="language-javascript">                     $(<span class="string">&quot;#messageDiv&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;分类id：&quot;</span>+ id + <span class="string">&quot;&lt;br&gt;分类名称:&quot;</span> +name );</span>
<span class="language-javascript">                        </span>
<span class="language-javascript">         &#125;); </span>
<span class="language-javascript">    &#125;);</span>
<span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
<span class="tag">&lt;/<span class="name">body</span>&gt;</span>
     
<span class="tag">&lt;/<span class="name">body</span>&gt;</span>
<span class="tag">&lt;/<span class="name">html</span>&gt;</span></code></pre>
<h5 id="getmanyhtml"><a class="markdownIt-Anchor" href="#getmanyhtml"></a> getMany.html</h5>
<p>访问测试地址：</p>
<pre><code class="highlight plaintext">http://localhost:8080/getMany.html</code></pre>
<pre><code class="highlight html"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">title</span>&gt;</span>用AJAX以JSON方式获取数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span>
<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">body</span>&gt;</span>
    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;通过AJAX获取多个分类对象&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sender&quot;</span>&gt;</span> 
     
    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;messageDiv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>
         
    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript">    $(<span class="string">&#x27;#sender&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span>
<span class="language-javascript">        <span class="keyword">var</span> url=<span class="string">&quot;category?start=0&amp;size=100&quot;</span>;</span>
<span class="language-javascript">        $.<span class="title function_">get</span>(</span>
<span class="language-javascript">                url,</span>
<span class="language-javascript">                <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span>
<span class="language-javascript">                    <span class="keyword">var</span> categorys = data;</span>
<span class="language-javascript">                     <span class="keyword">for</span>(i <span class="keyword">in</span> categorys)&#123;</span>
<span class="language-javascript">                         <span class="keyword">var</span> old = $(<span class="string">&quot;#messageDiv&quot;</span>).<span class="title function_">html</span>();</span>
<span class="language-javascript">                         <span class="keyword">var</span> category = categorys[i];</span>
<span class="language-javascript">                         $(<span class="string">&quot;#messageDiv&quot;</span>).<span class="title function_">html</span>(old + <span class="string">&quot;&lt;br&gt;&quot;</span>+category.<span class="property">id</span>+<span class="string">&quot;   -----   &quot;</span>+category.<span class="property">name</span>);</span>
<span class="language-javascript">                     &#125;</span>
<span class="language-javascript">         &#125;); </span>
<span class="language-javascript">    &#125;);</span>
<span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
<span class="tag">&lt;/<span class="name">body</span>&gt;</span>
     
<span class="tag">&lt;/<span class="name">body</span>&gt;</span>
<span class="tag">&lt;/<span class="name">html</span>&gt;</span></code></pre>
<h3 id="redis-2"><a class="markdownIt-Anchor" href="#redis-2"></a> Redis</h3>
<p>下面的案例基于上述JPA分页教程</p>
<h4 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h4>
<p>Redis是一套key-value高性能数据库</p>
<h4 id="运行redis服务器"><a class="markdownIt-Anchor" href="#运行redis服务器"></a> 运行Redis服务器</h4>
<h4 id="pomxml-6"><a class="markdownIt-Anchor" href="#pomxml-6"></a> pom.xml</h4>
<p>增加对Redis支持的包</p>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span>
 
  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.how2java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
  <span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">name</span>&gt;</span>
  <span class="tag">&lt;<span class="name">description</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">description</span>&gt;</span>
  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span>
   
    <span class="tag">&lt;<span class="name">parent</span>&gt;</span>
        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span>
    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
             
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
              <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
              <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
        <span class="comment">&lt;!-- servlet依赖. --&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
               
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
              <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
                     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
                     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
              <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
        <span class="comment">&lt;!-- tomcat的支持.--&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
                
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>    
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span> <span class="comment">&lt;!-- 这个需要为 true 热部署才有效 --&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
         
        <span class="comment">&lt;!-- mysql--&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
 
        <span class="comment">&lt;!-- jpa--&gt;</span>
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
        <span class="comment">&lt;!-- redis --&gt;</span>       
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>       
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>       
        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
          <span class="tag">&lt;<span class="name">version</span>&gt;</span> 4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>       
    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>
 
    <span class="tag">&lt;<span class="name">properties</span>&gt;</span>
        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span>
 
    <span class="tag">&lt;<span class="name">build</span>&gt;</span>
        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>
            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>
                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">build</span>&gt;</span>
 
<span class="tag">&lt;/<span class="name">project</span>&gt;</span></code></pre>
<h4 id="applicationproperties-5"><a class="markdownIt-Anchor" href="#applicationproperties-5"></a> application.properties</h4>
<p>增加redis相关配置<br />
同时让hibernate的sql语句显示出来，这样才知道到底是通过Redis取到2的数据，还是依然从数据库中取得数据</p>
<pre><code class="highlight properties"><span class="attr">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/jsp/</span>
<span class="attr">spring.mvc.view.suffix</span>=<span class="string">.jsp</span>
<span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/how2java?characterEncoding=UTF-8</span>
<span class="attr">spring.datasource.username</span>=<span class="string">root</span>
<span class="attr">spring.datasource.password</span>=<span class="string">admin</span>
<span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span>
<span class="attr">spring.jpa.properties.hibernate.hbm2ddl.auto</span>=<span class="string">update</span>
<span class="comment"> </span>
<span class="comment">###########################redis#########################</span>
<span class="comment">#Redis数据库索引（默认为0）</span>
<span class="attr">spring.redis.database</span>=<span class="string">0</span>
<span class="comment">#Redis服务器地址</span>
<span class="attr">spring.redis.host</span>=<span class="string">127.0.0.1</span>
<span class="comment">#Redis服务器连接端口</span>
<span class="attr">spring.redis.port</span>=<span class="string">6379</span>
<span class="comment">#Redis服务器连接密码（默认为空）</span>
<span class="attr">spring.redis.password</span>=<span class="string"></span>
<span class="comment">#连接池最大连接数（使用负值表示没有限制）</span>
<span class="attr">spring.redis.pool.max-active</span>=<span class="string">10</span>
<span class="comment">#连接池最大阻塞等待时间（使用负值表示没有限制）</span>
<span class="attr">spring.redis.pool.max-wait</span>=<span class="string">-1</span>
<span class="comment">#连接池中的最大空闲连接</span>
<span class="attr">spring.redis.pool.max-idle</span>=<span class="string">8</span>
<span class="comment">#连接池中的最小空闲连接</span>
<span class="attr">spring.redis.pool.min-idle</span>=<span class="string">0</span>
<span class="comment">#连接超时时间（毫秒）</span>
<span class="attr">spring.redis.timeout</span>=<span class="string">0</span>
 
<span class="attr">spring.jpa.show-sql</span>=<span class="string">true</span></code></pre>
<h4 id="application"><a class="markdownIt-Anchor" href="#application"></a> Application</h4>
<p>增加注解，以开启缓存</p>
<pre><code class="highlight plaintext">@EnableCaching</code></pre>
<pre><code class="highlight java"><span class="keyword">package</span> com.how2java.springboot;
  
<span class="keyword">import</span> org.springframework.boot.SpringApplication;
<span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;
  
<span class="meta">@SpringBootApplication</span>
<span class="meta">@EnableCaching</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;
  
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
        SpringApplication.run(Application.class, args);
    &#125;
  
&#125;</code></pre>
<h4 id="redisconfigjava"><a class="markdownIt-Anchor" href="#redisconfigjava"></a> RedisConfig.java</h4>
<p>Redis缓存配置类<br />
这个配置，一个作用：让保存到Redis里的key和value都转换为刻度的json格式，否则会是二进制格式，通过RedisClient工具也无法识别</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.how2java.springboot.config;
<span class="keyword">import</span> org.springframework.cache.CacheManager;
<span class="keyword">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;
<span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;
<span class="keyword">import</span> org.springframework.context.annotation.Bean;
<span class="keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;
<span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;
<span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;
<span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;
 
<span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;
<span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;
<span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;
 <span class="comment">//该注解的意思是表示该类是一个spring配置类，相当于给spriApplication.xml中加一句话</span>
<span class="meta">@Configuration</span>
<span class="meta">@EnableCaching</span>
<span class="comment">//Redis 缓存配置类</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;
 
    <span class="meta">@Bean</span>
    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisTemplate&lt;?,?&gt; redisTemplate)</span> &#123;
        <span class="type">RedisSerializer</span> <span class="variable">stringSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();
        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);
        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.PUBLIC_ONLY);
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);
        redisTemplate.setKeySerializer(stringSerializer);
        redisTemplate.setHashKeySerializer(stringSerializer);  
         
        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);         
        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);
        <span class="type">CacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisCacheManager</span>(redisTemplate);
        <span class="keyword">return</span> cacheManager;
  
    &#125;
&#125;</code></pre>
<h4 id="page4navigator"><a class="markdownIt-Anchor" href="#page4navigator"></a> Page4Navigator</h4>
<p>创建一个工具类 Page4Navigator 用以替换 原本分页查询要返回的 org.springframework.data.domain.Page 类。 原因是 Page 类对json 还原不支持，在放如 Redis 之后，再拿出来，就会报错失败。</p>
<p>使用 Page4Navigator 对其包裹，就解决了这个问题了。</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.how2java.springboot.util;
 
<span class="keyword">import</span> java.util.List;
 
<span class="keyword">import</span> org.springframework.data.domain.Page;
 
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Page4Navigator</span>&lt;T&gt; &#123;
    Page&lt;T&gt; page4jpa;
    <span class="type">int</span> navigatePages;
     
    <span class="type">int</span> totalPages;
 
    <span class="type">int</span> number;
     
    <span class="type">long</span> totalElements;
     
    <span class="type">int</span> size;
 
    <span class="type">int</span> numberOfElements;
 
    List&lt;T&gt; content;
 
    <span class="type">boolean</span> isHasContent;
 
    <span class="type">boolean</span> first;
 
    <span class="type">boolean</span> last;
     
    <span class="type">boolean</span> isHasNext;
 
    <span class="type">boolean</span> isHasPrevious;
     
    <span class="type">int</span>[] navigatepageNums;
     
    <span class="keyword">public</span> <span class="title function_">Page4Navigator</span><span class="params">()</span> &#123;
        <span class="comment">//这个空的分页是为了 Redis 从 json格式转换为 Page4Navigator 对象而专门提供的</span>
    &#125;
     
    <span class="keyword">public</span> <span class="title function_">Page4Navigator</span><span class="params">(Page&lt;T&gt; page4jpa,<span class="type">int</span> navigatePages)</span> &#123;
        <span class="built_in">this</span>.page4jpa = page4jpa;
        <span class="built_in">this</span>.navigatePages = navigatePages;
         
        totalPages = page4jpa.getTotalPages();
         
        number  = page4jpa.getNumber() ;
         
        totalElements = page4jpa.getTotalElements();
         
        size = page4jpa.getSize();
         
        numberOfElements = page4jpa.getNumberOfElements();
         
        content = page4jpa.getContent();
         
        isHasContent = page4jpa.hasContent();
                 
        first = page4jpa.isFirst();
         
        last = page4jpa.isLast();
         
        isHasNext = page4jpa.hasNext();
         
        isHasPrevious  = page4jpa.hasPrevious();       
         
        calcNavigatepageNums();
         
    &#125;
 
    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">calcNavigatepageNums</span><span class="params">()</span> &#123;
        <span class="type">int</span> navigatepageNums[];
        <span class="type">int</span> <span class="variable">totalPages</span> <span class="operator">=</span> getTotalPages();
        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> getNumber();
        <span class="comment">//当总页数小于或等于导航页码数时</span>
        <span class="keyword">if</span> (totalPages &lt;= navigatePages) &#123;
            navigatepageNums = <span class="keyword">new</span> <span class="title class_">int</span>[totalPages];
            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; totalPages; i++) &#123;
                navigatepageNums[i] = i + <span class="number">1</span>;
            &#125;
        &#125; <span class="keyword">else</span> &#123; <span class="comment">//当总页数大于导航页码数时</span>
            navigatepageNums = <span class="keyword">new</span> <span class="title class_">int</span>[navigatePages];
            <span class="type">int</span> <span class="variable">startNum</span> <span class="operator">=</span> num - navigatePages / <span class="number">2</span>;
            <span class="type">int</span> <span class="variable">endNum</span> <span class="operator">=</span> num + navigatePages / <span class="number">2</span>;
 
            <span class="keyword">if</span> (startNum &lt; <span class="number">1</span>) &#123;
                startNum = <span class="number">1</span>;
                <span class="comment">//(最前navigatePages页</span>
                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; navigatePages; i++) &#123;
                    navigatepageNums[i] = startNum++;
                &#125;
            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (endNum &gt; totalPages) &#123;
                endNum = totalPages;
                <span class="comment">//最后navigatePages页</span>
                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> navigatePages - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;
                    navigatepageNums[i] = endNum--;
                &#125;
            &#125; <span class="keyword">else</span> &#123;
                <span class="comment">//所有中间页</span>
                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; navigatePages; i++) &#123;
                    navigatepageNums[i] = startNum++;
                &#125;
            &#125;
        &#125;  
        <span class="built_in">this</span>.navigatepageNums = navigatepageNums;
    &#125;
 
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNavigatePages</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> navigatePages;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNavigatePages</span><span class="params">(<span class="type">int</span> navigatePages)</span> &#123;
        <span class="built_in">this</span>.navigatePages = navigatePages;
    &#125;
 
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTotalPages</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> totalPages;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalPages</span><span class="params">(<span class="type">int</span> totalPages)</span> &#123;
        <span class="built_in">this</span>.totalPages = totalPages;
    &#125;
 
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumber</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> number;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNumber</span><span class="params">(<span class="type">int</span> number)</span> &#123;
        <span class="built_in">this</span>.number = number;
    &#125;
 
    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTotalElements</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> totalElements;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalElements</span><span class="params">(<span class="type">long</span> totalElements)</span> &#123;
        <span class="built_in">this</span>.totalElements = totalElements;
    &#125;
 
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> size;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSize</span><span class="params">(<span class="type">int</span> size)</span> &#123;
        <span class="built_in">this</span>.size = size;
    &#125;
 
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumberOfElements</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> numberOfElements;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNumberOfElements</span><span class="params">(<span class="type">int</span> numberOfElements)</span> &#123;
        <span class="built_in">this</span>.numberOfElements = numberOfElements;
    &#125;
 
    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">getContent</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> content;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(List&lt;T&gt; content)</span> &#123;
        <span class="built_in">this</span>.content = content;
    &#125;
 
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isHasContent</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> isHasContent;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHasContent</span><span class="params">(<span class="type">boolean</span> isHasContent)</span> &#123;
        <span class="built_in">this</span>.isHasContent = isHasContent;
    &#125;
 
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFirst</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> first;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFirst</span><span class="params">(<span class="type">boolean</span> first)</span> &#123;
        <span class="built_in">this</span>.first = first;
    &#125;
 
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLast</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> last;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLast</span><span class="params">(<span class="type">boolean</span> last)</span> &#123;
        <span class="built_in">this</span>.last = last;
    &#125;
 
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isHasNext</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> isHasNext;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHasNext</span><span class="params">(<span class="type">boolean</span> isHasNext)</span> &#123;
        <span class="built_in">this</span>.isHasNext = isHasNext;
    &#125;
 
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isHasPrevious</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> isHasPrevious;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHasPrevious</span><span class="params">(<span class="type">boolean</span> isHasPrevious)</span> &#123;
        <span class="built_in">this</span>.isHasPrevious = isHasPrevious;
    &#125;
 
    <span class="keyword">public</span> <span class="type">int</span>[] getNavigatepageNums() &#123;
        <span class="keyword">return</span> navigatepageNums;
    &#125;
 
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNavigatepageNums</span><span class="params">(<span class="type">int</span>[] navigatepageNums)</span> &#123;
        <span class="built_in">this</span>.navigatepageNums = navigatepageNums;
    &#125;
 
&#125;</code></pre>
<h4 id="categoryserviceimpl"><a class="markdownIt-Anchor" href="#categoryserviceimpl"></a> CategoryServiceImpl</h4>
<p>实现类CategoryService做了以下工作：</p>
<ol>
<li>实现CategoryService接口，提供crud</li>
<li>在相应方法实现的时候，都是通过调用dao实现的</li>
<li>CacheConfig，表示分类数据在redis中都放在category这个分组里</li>
</ol>
<pre><code class="highlight plaintext">@CacheConfig(cacheNames=&quot;category&quot;)</code></pre>
<ol start="4">
<li>list方法讲解<br />
<strong>#p0是指在加有@Cacheable注解的方法中的第一个参数，比如上述list(Pageable pageable)中第一个参数就是pageable。#p0.offset相当于pageable.offset的意思</strong></li>
</ol>
<pre><code class="highlight plaintext">@Cacheable(key=&quot;&#x27;category &#x27;+#p0.offset + &#x27;-&#x27; + #p0.pageSize &quot;)</code></pre>
<p>假如是第一页，即offset=0，pageSize=5，那么会创建一个 key: “category 0-5”<br />
首先根据这个key 到 redis中查询数据。 第一次是不会有数据的，那么就会从数据库中取到这5条数据，然后以这个 key: “category 0-5” 保存到 redis 数据库中。<br />
下一次再次访问的时候，根据这个key，就可以从 redis 里取到数据了</p>
<ol start="5">
<li>get方法注解</li>
</ol>
<pre><code class="highlight plaintext">@Cacheable(key=&quot;&#x27;category &#x27;+ #p0&quot;)</code></pre>
<p>假如是获取id=71的数据，那么就会以 key= “category 71” 到reids中去获取，如果没有就会从数据库中拿到，然后再以 key= “category 71” 这个值存放到 redis 当中。</p>
<p>下一次再次访问的时候，根据这个key，就可以从 redis 里取到数据了</p>
<ol start="6">
<li>add方法讲解</li>
</ol>
<pre><code class="highlight plaintext">@CacheEvict(allEntries=true)
// @CachePut(key=&quot;&#x27;category &#x27;+ #p0&quot;)</code></pre>
<p>可以看到，本来有个 CachePut，但是被注释掉了。 按理说，本来是应该用这个的。 这样会到在，在增加数据之后，就会在Redis 中以 key= “category 71” 缓存一条数据。 但是为什么被注释掉不用呢？</p>
<p>因为加入这样做了，那么 list 对应的数据，在缓存在对应的数据，并没有发生变化呀？ 因为 list 对应的数据是这样的 key: “category 0-5”。 如果用这种方式，就会导致数据不同步，即，虽然增加了，并且也增加到缓存中了，但是因为 key 不一样，通过查询拿到的数据，是不会包含新的这一条的。</p>
<p>所以，才会使用CacheEvict 这个注解，这个注解就表示清除掉缓存。 allEntries= true 是表示清除掉 category 分组 下所有的keys. 注意看截图，里面有一个 category~keys ，里面就表明了都有哪些 keys,都会被清除掉。</p>
<p>假如这个时候，还有一个分组 cacheNames=“product”, 那么它下面对应的缓存，都是不会被影响到的。 这样就保证了，只清楚当前分组下的缓存，而不是清除 redis 所有的数据了<br />
7. delete方法讲解</p>
<pre><code class="highlight plaintext">@CacheEvict(allEntries=true)
// @CacheEvict(key=&quot;&#x27;category &#x27;+ #p0&quot;)</code></pre>
<p>这个道理和 add 是一样的，仅仅删除 key= “category 71” ，没有什么意义， key: “category 0-5” 里面的数据没有影响呀。 所以还是通过 CacheEvict删除掉所有的缓存就好了</p>
<pre><code class="highlight java"><span class="keyword">package</span> com.how2java.springboot.service.impl;
 
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.cache.annotation.CacheConfig;
<span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;
<span class="keyword">import</span> org.springframework.cache.annotation.CachePut;
<span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;
<span class="keyword">import</span> org.springframework.data.domain.Page;
<span class="keyword">import</span> org.springframework.data.domain.Pageable;
<span class="keyword">import</span> org.springframework.stereotype.Service;
 
<span class="keyword">import</span> com.how2java.springboot.dao.CategoryDAO;
<span class="keyword">import</span> com.how2java.springboot.pojo.Category;
<span class="keyword">import</span> com.how2java.springboot.service.CategoryService;
<span class="keyword">import</span> com.how2java.springboot.util.Page4Navigator;
 
<span class="meta">@Service</span>
<span class="meta">@CacheConfig(cacheNames=&quot;category&quot;)</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CategoryService</span>&#123;
 
    <span class="meta">@Autowired</span> CategoryDAO categoryDAO;
     
    <span class="meta">@Override</span>
    <span class="meta">@Cacheable(key=&quot;&#x27;category &#x27;+#p0.offset + &#x27;-&#x27; + #p0.pageSize &quot;)</span>
    <span class="keyword">public</span> Page4Navigator&lt;Category&gt; <span class="title function_">list</span><span class="params">(Pageable pageable)</span> &#123;
        Page&lt;Category&gt; pageFromJPA=  categoryDAO.findAll(pageable);
        Page4Navigator&lt;Category&gt; page = <span class="keyword">new</span> <span class="title class_">Page4Navigator</span>&lt;&gt;(pageFromJPA,<span class="number">5</span>);
        <span class="keyword">return</span> page;
    &#125;
 
    <span class="meta">@Override</span>
    <span class="meta">@Cacheable(key=&quot;&#x27;category &#x27;+ #p0&quot;)</span>
    <span class="keyword">public</span> Category <span class="title function_">get</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="type">Category</span> <span class="variable">c</span> <span class="operator">=</span>categoryDAO.findOne(id);
        <span class="keyword">return</span> c;
    &#125;  
     
    <span class="meta">@Override</span>
    <span class="meta">@CacheEvict(allEntries=true)</span>
<span class="comment">//  @CachePut(key=&quot;&#x27;category &#x27;+ #p0&quot;)</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Category category)</span> &#123;
        <span class="comment">// TODO Auto-generated method stub</span>
        categoryDAO.save(category);
    &#125;
     
    <span class="meta">@Override</span>
    <span class="meta">@CacheEvict(allEntries=true)</span>
<span class="comment">//  @CacheEvict(key=&quot;&#x27;category &#x27;+ #p0&quot;)</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="comment">// TODO Auto-generated method stub</span>
        categoryDAO.delete(id);
    &#125;
 
&#125;</code></pre>
<h4 id="categorycontroller-2"><a class="markdownIt-Anchor" href="#categorycontroller-2"></a> CategoryController</h4>
<p>由原来的从dao获取，变为了从Service获取</p>
<pre><code class="highlight java"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.data.domain.PageRequest;
<span class="keyword">import</span> org.springframework.data.domain.Pageable;
<span class="keyword">import</span> org.springframework.data.domain.Sort;
<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
 
<span class="keyword">import</span> com.how2java.springboot.pojo.Category;
<span class="keyword">import</span> com.how2java.springboot.service.CategoryService;
<span class="keyword">import</span> com.how2java.springboot.util.Page4Navigator;
  
<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;
    <span class="meta">@Autowired</span> CategoryService categoryService;
     
    <span class="meta">@RequestMapping(&quot;/listCategory&quot;)</span>
     
    <span class="keyword">public</span> String <span class="title function_">listCategory</span><span class="params">(Model m,<span class="meta">@RequestParam(value = &quot;start&quot;, defaultValue = &quot;0&quot;)</span> <span class="type">int</span> start,<span class="meta">@RequestParam(value = &quot;size&quot;, defaultValue = &quot;5&quot;)</span> <span class="type">int</span> size)</span> <span class="keyword">throws</span> Exception &#123;
        start = start&lt;<span class="number">0</span>?<span class="number">0</span>:start;
        <span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sort</span>(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>);
        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageRequest</span>(start, size, sort);
        Page4Navigator&lt;Category&gt; page =categoryService.list(pageable);
        m.addAttribute(<span class="string">&quot;page&quot;</span>, page);
        <span class="keyword">return</span> <span class="string">&quot;listCategory&quot;</span>;
    &#125;
 
    <span class="meta">@RequestMapping(&quot;/addCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">addCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryService.save(c);
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="meta">@RequestMapping(&quot;/deleteCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">deleteCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryService.delete(c.getId());
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="meta">@RequestMapping(&quot;/updateCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">updateCategory</span><span class="params">(Category c)</span> <span class="keyword">throws</span> Exception &#123;
        categoryService.save(c);
        <span class="keyword">return</span> <span class="string">&quot;redirect:listCategory&quot;</span>;
    &#125;
    <span class="meta">@RequestMapping(&quot;/editCategory&quot;)</span>
    <span class="keyword">public</span> String <span class="title function_">ediitCategory</span><span class="params">(<span class="type">int</span> id,Model m)</span> <span class="keyword">throws</span> Exception &#123;
        Category c= categoryService.get(id);
        m.addAttribute(<span class="string">&quot;c&quot;</span>, c);
        <span class="keyword">return</span> <span class="string">&quot;editCategory&quot;</span>;
    &#125;
&#125;</code></pre>
</main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2026 Lism Blog | lisisism@qq.com</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>