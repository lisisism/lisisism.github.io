<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    MyBatis 丨
    

    Lism Blog
  </title>

  
  <link rel="shortcut icon" href="/icon.svg">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="/Lism Blog" type="application/atom+xml">
</head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">/Lism Blog</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">MyBatis</div>
  <div class="post-meta">
    <div class="date">2022 一月 4日</div>
    <div class="tags">
      
      <div class="tag-item">Java</div>
      
      <div class="tag-item">MyBatis</div>
      
    </div>
  </div>
  

  <main class="post-content"><h1 id="mybatis"><a class="markdownIt-Anchor" href="#mybatis"></a> MyBatis</h1>
<p>[TOC]</p>
<h2 id="mybatis基础"><a class="markdownIt-Anchor" href="#mybatis基础"></a> MyBatis基础</h2>
<p>mybaits：<code>http://www.mybatis.org/mybatis-3/zh/index.html</code></p>
<h3 id="mybatis框架简介"><a class="markdownIt-Anchor" href="#mybatis框架简介"></a> MyBatis框架简介</h3>
<p>MyBatis框架就是对JDBC的封装，主要目的就是简化JDBC开发流程，实现事务松耦合，将实体类与SQL命令进行动态对应</p>
<h4 id="什么是mybatis"><a class="markdownIt-Anchor" href="#什么是mybatis"></a> 什么是MyBatis</h4>
<ul>
<li>MyBatis最早起源自Apache基金会的一个开源项目ibatis，2010年这个项目由Apache software foundation迁移到了Google code，并改名为MyBatis；</li>
<li>Mybatis是支持普通SQL，存储过程和高级映射的优秀持久层框架</li>
<li>MyBatis是支持普通SQL查询，存储过程和高级映射的优秀持久层框架</li>
<li>MyBatis封装了几乎所有的JDBC代码和参数的手工设置以及结果集的检索</li>
<li>MyBatis使用简单的XML或注解做配置和定义映射关系，将Java的POJOs(Plain Old Java Object)映射成数据库中的记录</li>
</ul>
<h4 id="mybatis体系结构"><a class="markdownIt-Anchor" href="#mybatis体系结构"></a> MyBatis体系结构</h4>
<ul>
<li>加载配置
<ul>
<li>配置有两种形式，一种是XML配置文件，另一种是Java代码的注解，MyBatis将SQL的配置信息加载成为一个个的MappedStatement对象（包括传入参数映射配置，执行的SQL语句，结果映射配置），并将其存储在内存中</li>
</ul>
</li>
<li>SQL解析
<ul>
<li>当API接口层接收到调用请求时，会接收到传入SQL的ID和传入对象（可以是Map，JavaBean或者基本数据类型），MyBatis会根据SQL的ID找到对应的MappedStatement，然后根据传入参数对象对MappedStatement进行解析，解析后可以得到最终要执行的SQL语句和参数</li>
</ul>
</li>
<li>SQL执行
<ul>
<li>将最终得到的SQL和参数拿到数据库进行执行，得到操作数据库的结果</li>
</ul>
</li>
<li>结果映射
<ul>
<li>将操作数据库的结果按照映射的配置进行转换，可以转换成HashMap，JavaBean或者基本数据类型，并将最终结果返回</li>
</ul>
</li>
</ul>
<h4 id="通俗理解"><a class="markdownIt-Anchor" href="#通俗理解"></a> 通俗理解</h4>
<ul>
<li>平时我们都用JDBC访问数据库，除了需要自己写SQL之外，还必须操作Connection, Statement, ResultSet 这些其实只是手段的辅助类。 不仅如此，访问不同的表，还会写很多雷同的代码，显得繁琐和枯燥</li>
<li>那么用了Mybatis之后，只需要自己提供SQL语句，其他的工作，诸如建立连接，Statement， JDBC相关异常处理等等都交给Mybatis去做了，那些重复性的工作Mybatis也给做掉了，我们只需要关注在增删改查等操作层面上，而把技术细节都封装在了我们看不见的地方</li>
</ul>
<h4 id="mybatis配置文件"><a class="markdownIt-Anchor" href="#mybatis配置文件"></a> MyBatis配置文件</h4>
<ul>
<li>MyBatis框架的XML配置文件包含下面两种类型
<ul>
<li>mybatis-config.xml（1个）
<ul>
<li>主配置文件，用于指定数据库连接参数和框架参数</li>
</ul>
</li>
<li>SqlMap.xml（n个）
<ul>
<li>映射定义文件，用于定义SQL语句和映射信息</li>
</ul>
</li>
</ul>
</li>
<li><code>mybaits-config.xml</code></li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;environment&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;environment&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle.jdbc.OracleDriver&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc.oracle:thin:@localhost:tarena10g&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;demo&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">valueo</span>=<span class="string">&quot;demo&quot;</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span>
<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<ul>
<li><code>SqlMap.xml</code></li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">mapper</span>&gt;</span>
    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addDept&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span>
        insert into dept(DEPTNO,DNAME,LOC) values (#&#123;deptno&#125;,#&#123;dname&#125;,#&#123;loc&#125;)
    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span>
    
    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll1&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptMap&quot;</span>&gt;</span>
        select DEPTNO,DNAME,LOC from DEPT
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>
    
    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;org.tarena.entity.Dept1&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;no&quot;</span> <span class="attr">column</span>=<span class="string">&quot;DEPTNO&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;DNAME&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;loc&quot;</span> <span class="attr">column</span>=<span class="string">&quot;LOC&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span>
<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<h4 id="框架api简介"><a class="markdownIt-Anchor" href="#框架api简介"></a> 框架API简介</h4>
<ul>
<li>在使用MyBatis框架时，主要涉及以下几个API
<ul>
<li>SqlSessionFactoryBuilder
<ul>
<li>该对象负责根据MyBatis配置文件SqlMapConfig.xml构建SqlSessionFactory实例</li>
</ul>
</li>
<li>SqlSessionFactory
<ul>
<li>每一个MyBatis的应用程序都以一个SqlSessionFactory对象为核心，该对象负责创建SqlSession对象实例</li>
</ul>
</li>
<li>SqlSession
<ul>
<li>该对象包含了所有执行SQL操作的方法，用于执行已映射的SQL语句</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="jdbc访问回忆"><a class="markdownIt-Anchor" href="#jdbc访问回忆"></a> JDBC访问（回忆）</h4>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException &#123;
    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);
    <span class="type">Connection</span> <span class="variable">con</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/lee_test&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;admin&quot;</span>);
    con.setAutoCommit(<span class="literal">false</span>); <span class="comment">//设置事务由交接，由该应用程序负责</span>
    <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> con.prepareStatement(<span class="string">&quot;insert into category values (?,?)&quot;</span>);
    preparedStatement.setInt(<span class="number">1</span>,<span class="number">101</span>);
    preparedStatement.setString(<span class="number">2</span>,<span class="string">&quot;李老伯&quot;</span>);
    <span class="keyword">try</span> &#123;
        preparedStatement.executeUpdate();
        con.commit();
    &#125; <span class="keyword">catch</span> (Exception ex) &#123;
        con.rollback();
        ex.printStackTrace();
    &#125;<span class="keyword">finally</span> &#123;
        <span class="keyword">if</span> (preparedStatement != <span class="literal">null</span>) &#123;
            preparedStatement.close();
        &#125;
        <span class="keyword">if</span> (con != <span class="literal">null</span>) &#123;
            con.close();
        &#125;
    &#125;
&#125;</code></pre>
<h3 id="mybatis基本应用"><a class="markdownIt-Anchor" href="#mybatis基本应用"></a> MyBatis基本应用</h3>
<h4 id="搭建mybatis技术环境"><a class="markdownIt-Anchor" href="#搭建mybatis技术环境"></a> 搭建MyBatis技术环境</h4>
<h5 id="pomxml"><a class="markdownIt-Anchor" href="#pomxml"></a> pom.xml</h5>
<pre><code class="highlight xml"><span class="comment">&lt;!--mybatis基础jar包--&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
<span class="comment">&lt;!--添加MySQL的驱动包--&gt;</span>
<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></code></pre>
<h5 id="mybatis-configxml"><a class="markdownIt-Anchor" href="#mybatis-configxml"></a> mybatis-config.xml</h5>
<p>在src下添加MyBatis配置文件mybatis-config.xml (核心配置文件)</p>
<ul>
<li>配置表对应实体类位置</li>
<li>配置数据库驱动，数据库名称，账号密码</li>
<li>配置表查询语句XML文件地址</li>
</ul>
<h6 id="mysql"><a class="markdownIt-Anchor" href="#mysql"></a> MySQL</h6>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="comment">&lt;!-- 配置自动扫描com.lee.mybatis1.entity包下的类型，使得在后续配置文件Category.xml中使用resultType的时候可以直接使用Category</span>
<span class="comment">     而不用写全路径com.lee.mybaits1.entity.Category--&gt;</span>
    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span>
        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.lee.mybatis1.entity&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span>
    
    <span class="comment">&lt;!--配置数据库连接url，用户名和密码--&gt;</span>
    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/lee_test?characterEncoding=UTF-8&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span>
    
    <span class="comment">&lt;!--映射Catrgory.xml--&gt;</span>
    <span class="comment">&lt;!--映射,定位当前项目中所有映射文件的位置--&gt;</span> 
    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
         <span class="comment">&lt;!--两种方法二选一--&gt;</span> 
         <span class="comment">&lt;!--mapper中可以通过class,resource,url来定义一个具体的映射文件--&gt;</span> 
         <span class="comment">&lt;!--resource用于引用resource文件夹下的配置文件--&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/Category.xml&quot;</span>/&gt;</span>
        <span class="comment">&lt;!--url方式需给配置文件出固定地址--&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/BlogMapper.xml&quot;</span>/&gt;</span>
        <span class="comment">&lt;!--class方式用来配置接口文件--&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.BlogMapper&quot;</span>/&gt;</span>
        <span class="comment">&lt;!--可以指向具体的包路径,该路径的所有映射文件和接口将产生对应的连接关系--&gt;</span> 
        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.lee.dao&quot;</span>/&gt;</span> 
    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>
<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>
</code></pre>
<h6 id="oracle"><a class="markdownIt-Anchor" href="#oracle"></a> Oracle</h6>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="comment">&lt;!-- 配置自动扫描com.lee.mybatis1.entity包下的类型，使得在后续配置文件Category.xml中使用resultType的时候可以直接使用Category</span>
<span class="comment">     而不用写全路径com.lee.mybaits1.entity.Category--&gt;</span>
    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span>
        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.lee.mybatis1.entity&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span>

    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;environments&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;environments&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle.jdbc.OracleDriver&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:oracle:thin:@localhost:tarena10g&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span>
    <span class="comment">&lt;!--映射Catrgory.xml--&gt;</span>
    <span class="comment">&lt;!--映射,定位当前项目中所有映射文件的位置--&gt;</span> 
    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
         <span class="comment">&lt;!--两种方法二选一--&gt;</span> 
         <span class="comment">&lt;!--mapper中可以通过class,resource,url来定义一个具体的映射文件--&gt;</span> 
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Category.xml&quot;</span>/&gt;</span>
        <span class="comment">&lt;!--可以指向具体的包路径,该路径的所有映射文件和接口将产生对应的连接关系--&gt;</span> 
        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.lee.dao&quot;</span>/&gt;</span> 
    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>
<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>

<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<h5 id="数据库表"><a class="markdownIt-Anchor" href="#数据库表"></a> 数据库表</h5>
<pre><code class="highlight sql"><span class="keyword">CREATE TABLE</span> category_ (
  id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,
  name <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,
  <span class="keyword">PRIMARY KEY</span> (id)
) ENGINE<span class="operator">=</span>MyISAM AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</code></pre>
<h5 id="实体类"><a class="markdownIt-Anchor" href="#实体类"></a> 实体类</h5>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="comment">/**</span>
<span class="comment"> * 数据库表实体类</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name ;

    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;

    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
&#125;</code></pre>
<h5 id="mapper配置文件"><a class="markdownIt-Anchor" href="#mapper配置文件"></a> Mapper配置文件</h5>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="comment">&lt;!-- namespace表示命名空间，后续调用sql语句的时候会用到 --&gt;</span>
<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lee.mybatis1.CategorySpace&quot;</span>&gt;</span>
    <span class="comment">&lt;!--</span>
<span class="comment">        id:一个标识，唯一键，以供后续代码调用</span>
<span class="comment">        resultType:表示返回的数据和Category关联起来</span>
<span class="comment">        这里本来应该使Category用com.lee.mybatis1.entity.Category，但是因为在mybatis-config.xml中配置了别名，所以可以直接使用Catrgory</span>
<span class="comment">     --&gt;</span>
    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listCategory&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Category&quot;</span>&gt;</span>
        select * from category_
        <span class="comment">&lt;!--解析器会把这段sql语句#&#123;&#125;转换为问号，然后把#&#123;&#125;内的名字放到集合中，最后在调用的的时候用反射机制动态的从真正的对象中读取变量值赋值给sql语句然后执行--&gt;</span>
        <span class="comment">&lt;!--insert into category values (#&#123;name&#125;,#&#123;loc&#125;)--&gt;</span>   
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>

<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<h5 id="获取sqlsession实例"><a class="markdownIt-Anchor" href="#获取sqlsession实例"></a> 获取SqlSession实例</h5>
<p>利用MyBatis API编程，获取SqlSession实例</p>
<pre><code class="highlight java"><span class="comment">//根据配置文件mybatis-config.xml得到sqlSessionFactory</span>
<span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;
<span class="comment">//Reader reader = Resources.getResourceAsReader(conf);</span>
<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);
<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);

<span class="comment">//然后根据sqlSessionFactory得到session</span>
<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();


<span class="comment">//最后通过session的selectList方法，调用id名为listCategory的sql语句（这个语句就在Category.xml文件中）</span>
<span class="comment">//执行完成后返回一个Category集合</span>
List&lt;Category&gt; list = sqlSession.selectList(<span class="string">&quot;listCategory&quot;</span>);
<span class="comment">//注：session.selectList(&quot;listCategory&quot;)也可写成session.selectList(&quot;com.lee.mybatis1.CategorySpace.listCategory&quot;)</span>
<span class="comment">//前缀就是Category.xml中设置的命名表空间名字</span>
<span class="keyword">for</span> (Category c:list) &#123;
    System.out.println(c.getId()+<span class="string">&quot;:&quot;</span>+c.getName());
&#125;
sqlSession.commit();
sqlSession.close();</code></pre>
<h5 id="基本原理图"><a class="markdownIt-Anchor" href="#基本原理图"></a> 基本原理图</h5>
<ol>
<li>应用程序找Mybatis要数据</li>
<li>mybatis从数据库找来数据
<ul>
<li>通过mybatis-config.xml 定位哪个数据库</li>
<li>通过Category.xml执行对应的select语句</li>
<li>基于Category.xml把返回的数据库记录封装在Category对象中</li>
<li>把多个Category对象装在一个Category集合中</li>
</ul>
</li>
</ol>
<ul>
<li>返回一个Category集合</li>
<li></li>
</ul>
<h4 id="利用sqlsession实现crud操作"><a class="markdownIt-Anchor" href="#利用sqlsession实现crud操作"></a> 利用SqlSession实现CRUD操作</h4>
<ul>
<li>当获取SqlSession对象后，就可以利用它对数据表执行增删改查操作了，使用步骤如下
<ul>
<li>根据数据表编写实体类（Java POJO）</li>
<li>编写SqlMap.xml映射文件，定义SQL操作和映射信息</li>
<li>获取SqlSession对象，执行增删改查操作</li>
<li>提交事物（DML操作）</li>
<li>释放SqlSession对象资源</li>
</ul>
</li>
</ul>
<h5 id="添加"><a class="markdownIt-Anchor" href="#添加"></a> 添加</h5>
<ul>
<li><strong>添加</strong>操作的SqlMap.xml定义</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addProduct&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>   
    insert into product (name,price) values (#&#123;name&#125;,#&#123;price&#125;)
<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></code></pre>
<ul>
<li><strong>添加</strong>操作的Java代码</li>
</ul>
<pre><code class="highlight java"><span class="type">Product</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>(<span class="number">0</span>,<span class="string">&quot;小橘子&quot;</span>,<span class="number">8899</span>);
sqlSession.insert(<span class="string">&quot;addProduct&quot;</span>,p1);
sqlSession.commit();
sqlSession.close();</code></pre>
<h5 id="更新"><a class="markdownIt-Anchor" href="#更新"></a> 更新</h5>
<ul>
<li><strong>更新</strong>操作的SqlMap.xml定义</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateProduct&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
    update product set name=#&#123;name&#125;,price=#&#123;price&#125; where id=#&#123;id&#125;
<span class="tag">&lt;/<span class="name">update</span>&gt;</span></code></pre>
<ul>
<li><strong>更新</strong>操作的Java代码</li>
</ul>
<pre><code class="highlight java"><span class="type">Product</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>(<span class="number">2</span>,<span class="string">&quot;雷军&quot;</span>,<span class="number">8889</span>);
sqlSession.update(<span class="string">&quot;updateProduct&quot;</span>,p2);
sqlSession.commit();
sqlSession.close();</code></pre>
<h5 id="删除"><a class="markdownIt-Anchor" href="#删除"></a> 删除</h5>
<ul>
<li><strong>删除</strong>操作的SqlMap.xml定义</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteProductById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span>
    delete from Product where id=#&#123;id&#125;<span class="tag">&lt;/<span class="name">delete</span>&gt;</span></code></pre>
<ul>
<li><strong>删除</strong>操作的Java代码</li>
</ul>
<pre><code class="highlight java">sqlSession.delete(<span class="string">&quot;deleteProductById&quot;</span>,<span class="number">1</span>);
sqlSession.commit();
sqlSession.close();</code></pre>
<h5 id="查询单行记录"><a class="markdownIt-Anchor" href="#查询单行记录"></a> 查询单行记录</h5>
<ul>
<li>查询单行记录的SqlMap.xml定义</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getProductById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>    
    select * from product where id=#&#123;id&#125;
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>查询单行记录的Java代码</li>
</ul>
<pre><code class="highlight java"><span class="type">Product</span> <span class="variable">p3</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;getProductById&quot;</span>,<span class="number">4</span>);
System.out.println(p3.getId()+<span class="string">&quot;:&quot;</span>+p3.getName()+<span class="string">&quot;:&quot;</span>+p3.getPrice());
sqlSession.close();</code></pre>
<h5 id="查询多行记录"><a class="markdownIt-Anchor" href="#查询多行记录"></a> 查询多行记录</h5>
<ul>
<li>查询多行记录的SqlMap.xml定义</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>    
    select * from product
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>查询多行记录的Java代码</li>
</ul>
<pre><code class="highlight java">        List&lt;Product&gt; list = sqlSession.selectList(<span class="string">&quot;listProduct&quot;</span>);
        <span class="comment">//注：session.selectList(&quot;listCategory&quot;)也可写成session.selectList(&quot;com.lee.mybatis1.CategorySpace.listCategory&quot;)</span>
        <span class="comment">//前缀就是Category.xml中设置的命名表空间名字</span>
        <span class="keyword">for</span> (Product c:list) &#123;
            System.out.println(c.getId()+<span class="string">&quot;:&quot;</span>+c.getName()+<span class="string">&quot;:&quot;</span>+c.getPrice());
        &#125;
sqlSession.close();</code></pre>
<h5 id="模糊查询"><a class="markdownIt-Anchor" href="#模糊查询"></a> 模糊查询</h5>
<ul>
<li>模糊查询的sqlMap.xml定义</li>
</ul>
<pre><code class="highlight xml"><span class="comment">&lt;!-- 模糊查询 --&gt;</span>
<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProductByName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
    select * from product where name like concat(&#x27;%&#x27;,#&#123;0&#125;,&#x27;%&#x27;)
    <span class="comment">&lt;!--</span>
<span class="comment">        concat是MySQL的函数，用来连接字符串-</span>
<span class="comment">        Oracle语句：select * from product where name like &#x27;%&#x27;||#&#123;0&#125;||&#x27;%&#x27;</span>
<span class="comment">    --&gt;</span>
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>模糊查询java代码</li>
</ul>
<pre><code class="highlight java">List&lt;Product&gt; list1 = sqlSession.selectList(<span class="string">&quot;listProductByName&quot;</span>,<span class="string">&quot;橘&quot;</span>);
<span class="keyword">for</span> (Product c:list1) &#123;
    System.out.println(c.getId()+<span class="string">&quot;:&quot;</span>+c.getName()+<span class="string">&quot;:&quot;</span>+c.getPrice());
&#125;</code></pre>
<h5 id="多条件查询"><a class="markdownIt-Anchor" href="#多条件查询"></a> 多条件查询</h5>
<ul>
<li>多参数查询可以使用Map</li>
<li>多条件查询sqlMap.xml</li>
</ul>
<pre><code class="highlight xml"><span class="comment">&lt;!-- 多条件查询 --&gt;</span>
<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProductByNameAndId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Map&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
    select * from product where id&gt;#&#123;id&#125; and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>多条件查询java代码</li>
</ul>
<pre><code class="highlight java">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,Object&gt;();
map.put(<span class="string">&quot;id&quot;</span>,<span class="number">4</span>);
map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;橘&quot;</span>);
List&lt;Product&gt; list2 = sqlSession.selectList(<span class="string">&quot;listProductByNameAndId&quot;</span>,map);
<span class="keyword">for</span> (Product c: list2) &#123;
    System.out.println(c.getId()+<span class="string">&quot;:&quot;</span>+c.getName()+<span class="string">&quot;:&quot;</span>+c.getPrice());
&#125;</code></pre>
<h3 id="mybatis返回值的方式"><a class="markdownIt-Anchor" href="#mybatis返回值的方式"></a> Mybatis返回值的方式</h3>
<h4 id="resulttype"><a class="markdownIt-Anchor" href="#resulttype"></a> resultType</h4>
<ul>
<li>使用resultType进行输出映射，只有查询出来的列名和pojo中的属性名一致，该列才可以映射成功</li>
<li>如果查询出来的列名和pojo中的属性名全部不一致，没有创建pojo对象</li>
<li>只要查询出来的列名和pojo中的属性有一个一致，就会创建pojo对象。</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getProductById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>    
    select * from product where id=#&#123;id&#125;
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h4 id="返回map类型查询结果"><a class="markdownIt-Anchor" href="#返回map类型查询结果"></a> 返回Map类型查询结果</h4>
<ul>
<li>SqlMap.xml映射定义</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findDept&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.util.HashMap&quot;</span>&gt;</span>
    select DEPTNO,DNAME from DEPT where DEPTNO=#&#123;no&#125;
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>SqlSession用法</li>
</ul>
<pre><code class="highlight java"><span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sf.openSession();
<span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map)session.selectOne(<span class="string">&quot;findDept&quot;</span>,<span class="number">10</span>);

System.out.println(map.get(<span class="string">&quot;DEPTNO&quot;</span>));
System.out.println(map.get(<span class="string">&quot;DNAME&quot;</span>));</code></pre>
<h4 id="使用resultmap"><a class="markdownIt-Anchor" href="#使用resultmap"></a> 使用resultMap</h4>
<ul>
<li>在SqlMap.xml定义<select>操作时，如果查询结果字段名与Java POJO属性不一致时，需要使用<resultMap>元素显式指定映射关系</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll1&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptMap&quot;</span>&gt;</span>
    select DEPTNO,DNAME,LOC from DEPT
<span class="tag">&lt;/<span class="name">select</span>&gt;</span>
<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;org.tarena.entity.Dept&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;no&quot;</span> <span class="attr">column</span>=<span class="string">&quot;DEPTNO&quot;</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;DNAME&quot;</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;loc&quot;</span> <span class="attr">column</span>=<span class="string">&quot;LOC&quot;</span>/&gt;</span>
<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></code></pre>
<h5 id="一对多"><a class="markdownIt-Anchor" href="#一对多"></a> 一对多</h5>
<ul>
<li>Product类</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/5/23.</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> <span class="type">double</span> price;
    <span class="keyword">private</span> <span class="type">int</span> groups;
    
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">()</span>&#123;
    &#125;
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(<span class="type">int</span> id, String name, <span class="type">double</span> price,<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.id = id;
        <span class="built_in">this</span>.name = name;
        <span class="built_in">this</span>.price = price;
        <span class="built_in">this</span>.groups = groups;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> price;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">double</span> price)</span> &#123;
        <span class="built_in">this</span>.price = price;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getGroups</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> groups;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGroups</span><span class="params">(<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.groups = groups;
    &#125;
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Product&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +
                <span class="string">&quot;, price=&quot;</span> + price +
                <span class="string">&quot;, groups=&quot;</span> + groups +
                <span class="string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;</code></pre>
<ul>
<li>Category类
<ul>
<li>该类中有个成员变量为Product对象的list集合</li>
</ul>
</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;
<span class="keyword">import</span> java.util.List;
<span class="comment">/**</span>
<span class="comment"> * 数据库表实体类</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name ;
    <span class="keyword">private</span> List&lt;Product&gt; products;

    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getProducts</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> products;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> &#123;
        <span class="built_in">this</span>.products = products;
    &#125;
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Category&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span>;
    &#125;
&#125;
</code></pre>
<ul>
<li>Category.xml
<ul>
<li>通过left join关联查询，对Category和Product表进行关联查询</li>
</ul>
</li>
</ul>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="comment">&lt;!-- namespace表示命名空间，后续调用sql语句的时候会用到 --&gt;</span>
<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lee.mybatis1.CategorySpace&quot;</span>&gt;</span>
    <span class="comment">&lt;!--使用resultMap可以--&gt;</span>
    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;categoryBean&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Category&quot;</span>&gt;</span>
    <span class="comment">&lt;!--column表示数据库字段名，property表示类成员变量名--&gt;</span>
    <span class="comment">&lt;!--id为数据库主键，result为普通字段--&gt;</span>
        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span>
        
        
        <span class="comment">&lt;!--一对多</span>
<span class="comment">            collection表示一个集合</span>
<span class="comment">            collection中属性：</span>
<span class="comment">            property：表示products为Category类中的一个成员变量，相当于上一句result中的property</span>
<span class="comment">            ofType：表示这个成员变量集合元素是什么类型</span>
<span class="comment">            column：填写临时表中来自于一方表主键字段名，即临时表的主键，例如：该员工都属于10部门，10就是该临时表的主键</span>
<span class="comment">        --&gt;</span>
        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;products&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Product&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;pid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>
            <span class="comment">&lt;!--如果字段名与Java实体类名相同，可以不写下面的result，框架会自动映射--&gt;</span>
            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;groups&quot;</span> <span class="attr">property</span>=<span class="string">&quot;groups&quot;</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span>

<span class="comment">&lt;!--下面查询自动映射到上述resultMap中--&gt;</span>
    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listCategory&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;categoryBean&quot;</span>&gt;</span>
        select  c.id &#x27;cid&#x27;, c.name &#x27;cname&#x27;, p.id &#x27;pid&#x27;, p.name &#x27;pname&#x27;,p.price,p.groups from Category c left join Product p on c.id=p.groups
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>

<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<ul>
<li>测试运行</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;
    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;
    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);
    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);
    <span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession();
  
    List&lt;Category&gt; cs = session.selectList(<span class="string">&quot;listCategory&quot;</span>);
    <span class="keyword">for</span> (Category c : cs) &#123;
        System.out.println(c);
        List&lt;Product&gt; ps = c.getProducts();
        <span class="keyword">for</span> (Product p : ps) &#123;
            System.out.println(<span class="string">&quot;\t&quot;</span>+p);
        &#125;
    &#125;
    session.commit();
    session.close();</code></pre>
<h5 id="一对多级联查询"><a class="markdownIt-Anchor" href="#一对多级联查询"></a> 一对多级联查询</h5>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;dept&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;dept_depno&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deptNo&quot;</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;dname&quot;</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;loc&quot;</span> <span class="attr">property</span>=<span class="string">&quot;loc&quot;</span>/&gt;</span>
    <span class="comment">&lt;!--empList变量通过链接一个子查询获得，关联子查询的条件变量就是column中的字段--&gt;</span>
    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;empList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;employee&quot;</span> <span class="attr">select</span>=<span class="string">&quot;empFindByDeptno&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_deptno&quot;</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span>
<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span>
<span class="comment">&lt;!--级联查询--&gt;</span>
<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;empFindBydeptno&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span>
    select empno,ename,job from emp where deptno=#&#123;deptno&#125;
<span class="tag">&lt;/<span class="name">select</span>&gt;</span>

<span class="comment">&lt;!--主查询--&gt;</span>
<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;deptFindBydeptno&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptMap&quot;</span>&gt;</span>
    select deptno dept_deptno,dname,loc from dept where deptno=#&#123;deptno&#125;
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<blockquote>
<p><strong>此种方式会与数据库建立两次连接，会影响效率</strong></p>
</blockquote>
<blockquote>
<p><strong>如果设置了延迟加载，那么这种方式会更快一点</strong></p>
</blockquote>
<h5 id="多对一"><a class="markdownIt-Anchor" href="#多对一"></a> 多对一</h5>
<ul>
<li>Category类</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;
<span class="keyword">import</span> java.util.List;
<span class="comment">/**</span>
<span class="comment"> * 数据库表实体类</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name ;
<span class="comment">//    private List&lt;Product&gt; products;</span>
    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
<span class="comment">//    public List&lt;Product&gt; getProducts() &#123;</span>
<span class="comment">//        return products;</span>
<span class="comment">//    &#125;</span>
<span class="comment">//</span>
<span class="comment">//    public void setProducts(List&lt;Product&gt; products) &#123;</span>
<span class="comment">//        this.products = products;</span>
<span class="comment">//    &#125;</span>
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Category&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span>;
    &#125;
&#125;</code></pre>
<ul>
<li>Product类
<ul>
<li>新增字段Category,让Product类中包含Category，即一对多，Product类于Category中的成员变量是<strong>一对多</strong>的关系</li>
</ul>
</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;
<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/5/23.</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> <span class="type">double</span> price;
    <span class="keyword">private</span> <span class="type">int</span> groups;
    <span class="keyword">private</span> Category category;
    
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">()</span>&#123;
    &#125;
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(<span class="type">int</span> id, String name, <span class="type">double</span> price,<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.id = id;
        <span class="built_in">this</span>.name = name;
        <span class="built_in">this</span>.price = price;
        <span class="built_in">this</span>.groups = groups;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> price;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">double</span> price)</span> &#123;
        <span class="built_in">this</span>.price = price;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getGroups</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> groups;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGroups</span><span class="params">(<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.groups = groups;
    &#125;
    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> category;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCategory</span><span class="params">(Category category)</span> &#123;
        <span class="built_in">this</span>.category = category;
    &#125;
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Product&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +
                <span class="string">&quot;, price=&quot;</span> + price +
                <span class="string">&quot;, groups=&quot;</span> + groups +
                <span class="string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;</code></pre>
<ul>
<li>Product.xml</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;productBean&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
     <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>
     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span>
     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span>

     <span class="comment">&lt;!--多对一--&gt;</span>
     <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;category&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Category&quot;</span>&gt;</span>
         <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>
         <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span>
     <span class="tag">&lt;/<span class="name">association</span>&gt;</span>
 <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span>

 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;productBean&quot;</span>&gt;</span>
     select p.*,c.id &#x27;cid&#x27;,c.name &#x27;cname&#x27; from category c left join product p on c.id = p.groups
 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>测试运行</li>
</ul>
<pre><code class="highlight java">List&lt;Product&gt; list5 =  sqlSession.selectList(<span class="string">&quot;listProduct2&quot;</span>);
<span class="keyword">for</span> (Product p:list5) &#123;
    System.out.println(p+<span class="string">&quot;:::::::&quot;</span>+p.getCategory());
&#125;</code></pre>
<h5 id="多对多"><a class="markdownIt-Anchor" href="#多对多"></a> 多对多</h5>
<ul>
<li>假设有一个订单类Order，有一个产品类Products，一个关联订单和产品的OrderItem类</li>
<li>Order</li>
</ul>
<pre><code class="highlight java"><span class="keyword">import</span> java.util.List;
<span class="comment">//订单类</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id;
    <span class="keyword">private</span> String code;
     
    List&lt;OrderItem&gt; orderItems;
     
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> code;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(String code)</span> &#123;
        <span class="built_in">this</span>.code = code;
    &#125;
    <span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title function_">getOrderItems</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> orderItems;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrderItems</span><span class="params">(List&lt;OrderItem&gt; orderItems)</span> &#123;
        <span class="built_in">this</span>.orderItems = orderItems;
    &#125;
&#125;</code></pre>
<ul>
<li>OrderItem</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id;
    <span class="comment">//数量</span>
    <span class="keyword">private</span> <span class="type">int</span> number;
    <span class="comment">//订单</span>
    <span class="keyword">private</span> Order order;
    <span class="comment">//产品</span>
    <span class="keyword">private</span> Product product;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumber</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> number;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNumber</span><span class="params">(<span class="type">int</span> number)</span> &#123;
        <span class="built_in">this</span>.number = number;
    &#125;
    <span class="keyword">public</span> Order <span class="title function_">getOrder</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> order;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrder</span><span class="params">(Order order)</span> &#123;
        <span class="built_in">this</span>.order = order;
    &#125;
    <span class="keyword">public</span> Product <span class="title function_">getProduct</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> product;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProduct</span><span class="params">(Product product)</span> &#123;
        <span class="built_in">this</span>.product = product;
    &#125;
     
&#125;</code></pre>
<ul>
<li>Product</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;
<span class="comment">//在实体类中存的是对象，数据库表中存的是对象id</span>
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="comment">//产品名</span>
    <span class="keyword">private</span> String name;
    <span class="comment">//产品价格</span>
    <span class="keyword">private</span> <span class="type">double</span> price;
    <span class="comment">//产品分类</span>
    <span class="keyword">private</span> <span class="type">int</span> groups;
    <span class="comment">//产品分类详细信息</span>
    <span class="keyword">private</span> Category category;
    
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">()</span>&#123;

    &#125;
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(<span class="type">int</span> id, String name, <span class="type">double</span> price,<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.id = id;
        <span class="built_in">this</span>.name = name;
        <span class="built_in">this</span>.price = price;
        <span class="built_in">this</span>.groups = groups;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> price;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">double</span> price)</span> &#123;
        <span class="built_in">this</span>.price = price;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getGroups</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> groups;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGroups</span><span class="params">(<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.groups = groups;
    &#125;
    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> category;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCategory</span><span class="params">(Category category)</span> &#123;
        <span class="built_in">this</span>.category = category;
    &#125;
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Product&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +
                <span class="string">&quot;, price=&quot;</span> + price +
                <span class="string">&quot;, groups=&quot;</span> + groups +
                <span class="string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;</code></pre>
<ul>
<li>Order.xml</li>
</ul>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lee.mybatis1.entity.Order&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Order&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orderBean&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;oid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span> /&gt;</span>
        <span class="comment">&lt;!--多对多</span>
<span class="comment">            订单有一个OrderItem的List</span>
<span class="comment">        --&gt;</span>
        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderItems&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;OrderItem&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;oiid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span>
            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;number&quot;</span> <span class="attr">property</span>=<span class="string">&quot;number&quot;</span> /&gt;</span>
            <span class="comment">&lt;!--OrderItem类中又有一个Product对象--&gt;</span>
            <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;product&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
                <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;pid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">association</span>&gt;</span>
            
        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span>

<span class="comment">&lt;!--三个表关联查询出所有信息，mybait会自动插入对应的resultMap--&gt;</span>
    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listOrder&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;orderBean&quot;</span>&gt;</span>
        select o.*,p.*,oi.*, o.id &#x27;oid&#x27;, p.id &#x27;pid&#x27;, oi.id &#x27;oiid&#x27;, p.name &#x27;pname&#x27;
        from order_item oi
        left join orders o on oi.oid =o.id
        left join product p on  oi.pid =p.groups
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>
<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<ul>
<li>OrderItem</li>
</ul>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lee.mybatis1.entity&quot;</span>&gt;</span>

    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addOrderItem&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;OrderItem&quot;</span>&gt;</span>
    <span class="comment">&lt;!--表中只能存储对象的id--&gt;</span>
        insert into order_item_
        values(null,#&#123;order.id&#125;,#&#123;product.id&#125;,#&#123;number&#125;)
    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span>
    
    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;deleteOrderItem&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;OrderItem&quot;</span>&gt;</span>
        delete from order_item_
        where oid = #&#123;order.id&#125; and pid = #&#123;product.id&#125;
    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span>

<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<ul>
<li>Product.xml</li>
</ul>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
<span class="comment">&lt;!-- namespace表示命名空间，后续调用sql语句的时候会用到 --&gt;</span>
<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lee.mybatis1.ProductSpace&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;productBean&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span>

        <span class="comment">&lt;!--多对一--&gt;</span>
        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;category&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Category&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">association</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span>

    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;productBean&quot;</span>&gt;</span>
        select p.*,c.id &#x27;cid&#x27;,c.name &#x27;cname&#x27; from category c left join product p on c.id = p.groups
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>
    <span class="comment">&lt;!--不写parameterType好像也可以传入一些简单的值--&gt;</span>
    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getProduct&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;productBean&quot;</span>&gt;</span>
        select c.*, p.*, c.id &#x27;cid&#x27;, p.id &#x27;pid&#x27;, c.name &#x27;cname&#x27;, p.name &#x27;pname&#x27;
        from category c
        left join product p on c.id = p.groups
        where p.id = #&#123;id&#125;
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>
<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<ul>
<li>修改mybatis-config.xml</li>
</ul>
<pre><code class="highlight xml">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/how2java/pojo/Order.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/how2java/pojo/OrderItem.xml&quot;</span>/&gt;</span></code></pre>
<ul>
<li><strong>查询操作</strong></li>
</ul>
<pre><code class="highlight java">List&lt;Order&gt; os = session.selectList(<span class="string">&quot;listOrder&quot;</span>);
       <span class="keyword">for</span> (Order o : os) &#123;
           System.out.println(o.getCode());
           List&lt;OrderItem&gt; ois= o.getOrderItems();
           <span class="keyword">for</span> (OrderItem oi : ois) &#123;
               System.out.format(<span class="string">&quot;\t%s\t%f\t%d%n&quot;</span>, oi.getProduct().getName(),oi.getProduct().getPrice(),oi.getNumber());
           &#125;
       &#125;</code></pre>
<ul>
<li><strong>新增</strong></li>
</ul>
<pre><code class="highlight java"><span class="type">Order</span> <span class="variable">o1</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;getOrder&quot;</span>, <span class="number">1</span>);
<span class="type">Product</span> <span class="variable">p6</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;getProduct&quot;</span>, <span class="number">6</span>);
<span class="type">OrderItem</span> <span class="variable">oi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();
oi.setProduct(p6);
oi.setOrder(o1);
oi.setNumber(<span class="number">200</span>);
 
session.insert(<span class="string">&quot;addOrderItem&quot;</span>, oi);</code></pre>
<ul>
<li><strong>删除</strong></li>
</ul>
<pre><code class="highlight java">        <span class="type">Order</span> <span class="variable">o1</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;getOrder&quot;</span>,<span class="number">1</span>);
        <span class="type">Product</span> <span class="variable">p6</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;getProduct&quot;</span>,<span class="number">6</span>);
        <span class="type">OrderItem</span> <span class="variable">oi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();
        oi.setProduct(p6);
        oi.setOrder(o1);
        session.delete(<span class="string">&quot;deleteOrderItem&quot;</span>, oi);</code></pre>
<h3 id="mybatis传参的四种方式"><a class="markdownIt-Anchor" href="#mybatis传参的四种方式"></a> Mybatis传参的四种方式</h3>
<ul>
<li><strong>parameterType</strong>
<ul>
<li>将会传入这条语句的参数类的完全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler） 推断出具体传入语句的参数，默认值为未设置（unset）</li>
</ul>
</li>
</ul>
<h4 id="顺序传参法"><a class="markdownIt-Anchor" href="#顺序传参法"></a> 顺序传参法</h4>
<ul>
<li><code>#&#123;index&#125;</code>表示传入参数的顺序</li>
</ul>
<pre><code class="highlight xml">public User selectUser(String name, int deptId); 

<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserResultMap&quot;</span>&gt;</span> 
        select * from user where user_name = #&#123;0&#125; and dept_id = #&#123;1&#125; 
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h4 id="param注解传参法推荐"><a class="markdownIt-Anchor" href="#param注解传参法推荐"></a> @Param注解传参法(推荐)</h4>
<ul>
<li><code>#&#123;&#125;</code>表示名称对应的注解@Param括号里修饰的名称</li>
</ul>
<pre><code class="highlight xml">public User selectUser(@Param(&quot;userName&quot;) String name, int @Param(&quot;deptId&quot;) deptId); 

<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserResultMap&quot;</span>&gt;</span>
        select * from user where user_name = #&#123;userName&#125; and dept_id = #&#123;deptId&#125; <span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h4 id="map传参法推荐"><a class="markdownIt-Anchor" href="#map传参法推荐"></a> Map传参法(推荐)</h4>
<ul>
<li><code>#&#123;key&#125;</code>里面对应的是map里面的key</li>
</ul>
<pre><code class="highlight xml">public User selectUser(Map&lt;String, Object&gt; params); 

<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.Map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserResultMap&quot;</span>&gt;</span>
        select * from user where user_name = #&#123;userName&#125; and dept_id = #&#123;deptId&#125; 
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h4 id="java-bean传参法"><a class="markdownIt-Anchor" href="#java-bean传参法"></a> Java Bean传参法</h4>
<ul>
<li><code>#&#123;&#125;</code>里面的名称对应的是User类里面的成员属性</li>
</ul>
<pre><code class="highlight xml">public User selectUser(Map&lt;String, Object&gt; params); 

<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.test.User&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserResultMap&quot;</span>&gt;</span> 
        select * from user where user_name = #&#123;userName&#125; and dept_id = #&#123;deptId&#125; 
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h3 id="mybatis动态sql"><a class="markdownIt-Anchor" href="#mybatis动态sql"></a> Mybatis动态SQL</h3>
<h4 id="if标签"><a class="markdownIt-Anchor" href="#if标签"></a> if标签</h4>
<ul>
<li>如果Product的字段比较多的话，为了应付各个字段的查询，那么就要写多条sql语句，变得难以维护</li>
<li>这个时候，就可以使用Mybatis动态sql里的if标签，如果有传入参数name，就模糊查询，没有name，就查询所有</li>
</ul>
<p><strong>test表达式中的变量名必须和实体类中的变量名或Mapper形参 完全相同</strong></p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
    select * from product_
    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null and name!=&#x27;&#x27;&quot;</span>&gt;</span>
        where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)
    <span class="tag">&lt;/<span class="name">if</span>&gt;</span>
     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;loc!=null and loc!=&#x27;&#x27;&quot;</span>&gt;</span>
        where loc like &#x27;%&#x27; #&#123;loc&#125; &#x27;%&#x27;
    <span class="tag">&lt;/<span class="name">if</span>&gt;</span>
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<blockquote>
<p>如果没有传参数name,那么就查询所有，如果有name参数，那么就进行模糊查询</p>
</blockquote>
<ul>
<li>测试输出</li>
</ul>
<pre><code class="highlight java">
System.out.println(<span class="string">&quot;查询所有的&quot;</span>);
        List&lt;Product&gt; ps = session.selectList(<span class="string">&quot;listProduct&quot;</span>);
        <span class="keyword">for</span> (Product p : ps) &#123;
            System.out.println(p);
        &#125;
         
         
        System.out.println(<span class="string">&quot;模糊查询&quot;</span>);
        Map&lt;String,Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();
        params.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;a&quot;</span>);
        <span class="comment">//或者可以直接传入参数session.selectList(&quot;listProductByName&quot;,&quot;a&quot;);</span>
        <span class="comment">//sqlmap.xml使用#&#123;0&#125;取值</span>
        List&lt;Product&gt; ps2 = session.selectList(<span class="string">&quot;listProductByName&quot;</span>,params);
        <span class="keyword">for</span> (Product p : ps2) &#123;
            System.out.println(p);
        &#125;      
         
        session.commit();
        session.close();</code></pre>
<h4 id="where标签"><a class="markdownIt-Anchor" href="#where标签"></a> where标签</h4>
<ul>
<li><strong>为什么要用where标签</strong>
<ul>
<li>如果要实现下述功能</li>
</ul>
</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
	select * from product_
	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span>
		where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)
	<span class="tag">&lt;/<span class="name">if</span>&gt;</span>		 	
	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price!=0&quot;</span>&gt;</span>
		and price &gt; #&#123;price&#125;
	<span class="tag">&lt;/<span class="name">if</span>&gt;</span>		 	
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>当有name参数但是没有price参数的时候，sql语句就会变成：<s>运行报错</s></li>
</ul>
<pre><code class="highlight sql"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product_ <span class="keyword">and</span> price <span class="operator">&gt;</span> <span class="number">10.</span></code></pre>
<ul>
<li>上述问题就可以<strong>使用<where>标签解决</strong></li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
	select * from product_
	<span class="tag">&lt;<span class="name">where</span>&gt;</span>
		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span>
			and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)
		<span class="tag">&lt;/<span class="name">if</span>&gt;</span>		 	
		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price!=null and price!=0&quot;</span>&gt;</span>
			and price &gt; #&#123;price&#125;
		<span class="tag">&lt;/<span class="name">if</span>&gt;</span>	
	<span class="tag">&lt;/<span class="name">where</span>&gt;</span>	 	
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<blockquote>
<p><where>标签会进行自动判断<br />
如果任何条件都不成立，那么就在sql语句里就不会出现where关键字<br />
如果有任何条件成立，会自动去掉多出来的 and 或者 or</p>
</blockquote>
<ul>
<li>测试运行<br />
* 无论是否供值都可以正常运行</li>
</ul>
<pre><code class="highlight xml">Map&lt;String,Object&gt; map = new HashMap&lt;String,Object&gt;();
map.put(&quot;name&quot;,&quot;手&quot;);
map.put(&quot;price&quot;,50);
List<span class="tag">&lt;<span class="name">Product</span>&gt;</span> list6 = sqlSession.selectList(&quot;listProductChoose&quot;,map);
for(Product p:list6)&#123;
    System.out.println(p.getName()+&quot;:&quot;+p.getId());
&#125;</code></pre>
<h4 id="set标签"><a class="markdownIt-Anchor" href="#set标签"></a> set标签</h4>
<ul>
<li>用于update语句中</li>
</ul>
<pre><code class="highlight xml">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateProduct&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Product&quot;</span> &gt;</span>
        update product_
        <span class="tag">&lt;<span class="name">set</span>&gt;</span>
            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name=#&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span>
            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price != null&quot;</span>&gt;</span>price=#&#123;price&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span>
              
        <span class="tag">&lt;/<span class="name">set</span>&gt;</span>
         
         where id=#&#123;id&#125;   
    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></code></pre>
<h4 id="trim标签"><a class="markdownIt-Anchor" href="#trim标签"></a> trim标签</h4>
<ul>
<li>trim用来定制想要的功能</li>
</ul>
<pre><code class="highlight xml">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateProduct&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Product&quot;</span> &gt;</span>
        update product_
        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name=#&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span>
            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price != null&quot;</span>&gt;</span>price=#&#123;price&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span>
              
        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span>
         
         where id=#&#123;id&#125;   
    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></code></pre>
<pre><code class="highlight xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
        select * from product_
        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND |OR &quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span>
                and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)
            <span class="tag">&lt;/<span class="name">if</span>&gt;</span>        
            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price!=null and price!=0&quot;</span>&gt;</span>
                and price &gt; #&#123;price&#125;
            <span class="tag">&lt;/<span class="name">if</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span>      
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h4 id="choose"><a class="markdownIt-Anchor" href="#choose"></a> choose</h4>
<ul>
<li>mybatis中没有else标签，但是可以使用when otherwise标签来达到这样的效果</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
	  SELECT * FROM product_ 
	  <span class="tag">&lt;<span class="name">where</span>&gt;</span>
	  	<span class="tag">&lt;<span class="name">choose</span>&gt;</span>
		  <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>
		    and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)
		  <span class="tag">&lt;/<span class="name">when</span>&gt;</span>			  
		  <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;price !=null and price != 0&quot;</span>&gt;</span>
		    and price &gt; #&#123;price&#125;
		  <span class="tag">&lt;/<span class="name">when</span>&gt;</span>			  		
	  	  <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span>
	  	  	and id &gt;1
	  	  <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span>
	  	<span class="tag">&lt;/<span class="name">choose</span>&gt;</span>
	  <span class="tag">&lt;/<span class="name">where</span>&gt;</span>
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h4 id="foreach"><a class="markdownIt-Anchor" href="#foreach"></a> foreach</h4>
<ul>
<li>foreach标签通常用于in这样的语法里</li>
<li>foreach标签用于对集合含内容进行遍历，将得到内容作为SQL语句的一部分，实际开发过程中主要用于<strong>in语句</strong>的构建和<strong>批量添加</strong>操作</li>
</ul>
<blockquote>
<p><strong>item</strong>表示结合中每一个元素进行迭代的别名<br />
<strong>index</strong>指定一个名字，用于表示在迭代过程中，每次迭代到的位置<br />
<strong>open</strong>表示该语句以什么开始<br />
<strong>separator</strong>表示每次进行迭代之间以什么符号作为分隔符<br />
<strong>close</strong>表示以什么结束<br />
<strong>collection</strong>表示传入参数集合类型</p>
</blockquote>
<h5 id="in语句"><a class="markdownIt-Anchor" href="#in语句"></a> in语句</h5>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
      SELECT * FROM product_
        WHERE ID in
            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span></span>
<span class="tag">                <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span>
                #&#123;item&#125;
            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>测试运行</li>
</ul>
<pre><code class="highlight java">        List&lt;Integer&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();
        ids.add(<span class="number">1</span>);
        ids.add(<span class="number">3</span>);
        ids.add(<span class="number">5</span>);
         
      List&lt;Product&gt; ps = session.selectList(<span class="string">&quot;listProduct&quot;</span>,ids);
      <span class="keyword">for</span> (Product p : ps) &#123;
          System.out.println(p);
      &#125;</code></pre>
<h5 id="使用foreach实现批量添加"><a class="markdownIt-Anchor" href="#使用foreach实现批量添加"></a> 使用foreach实现批量添加</h5>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertDept&quot;</span>&gt;</span>
    insert into dept (dname,loc) values
    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span>
        (#&#123;dept.dname&#125;,#&#123;dept.loc&#125;)
    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>
<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></code></pre>
<p>接口方法：</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span>&#123;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertDept</span> <span class="params">(List&lt;Dept&gt; dept)</span>;
&#125;</code></pre>
<p>生成sql示例</p>
<pre><code class="highlight plaintext">insert into dept (dename,loc) values (&#x27;政府事业部&#x27;,&#x27;上海&#x27;),(&#x27;医院事业部&#x27;,&#x27;西安&#x27;)</code></pre>
<h5 id="使用foreach批量修改"><a class="markdownIt-Anchor" href="#使用foreach批量修改"></a> 使用foreach批量修改</h5>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;UPDATE_HOTEL_REAL_TIME_PRICE&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.List&quot;</span>&gt;</span>
   <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;;&quot;</span>&gt;</span>
       UPDATE VST_HOTEL_REAL_TIME_PRICE
       <span class="tag">&lt;<span class="name">set</span>&gt;</span>
           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;item.realTimePrice1 != null&quot;</span>&gt;</span>
               REAL_TIME_PRICE1 = #&#123;item.realTimePrice1&#125;,
           <span class="tag">&lt;/<span class="name">if</span>&gt;</span>
           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;item.realTimePrice2 != null&quot;</span>&gt;</span>
               REAL_TIME_PRICE2 = #&#123;item.realTimePrice2&#125;,
           <span class="tag">&lt;/<span class="name">if</span>&gt;</span>
           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;item.realTimeRemain1 != null&quot;</span>&gt;</span>
               REAL_TIME_REMAIN1 = #&#123;item.realTimeRemain1&#125;,
           <span class="tag">&lt;/<span class="name">if</span>&gt;</span>
           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;item.realTimeRemain2 != null&quot;</span>&gt;</span>
               REAL_TIME_REMAIN2 = #&#123;item.realTimeRemain2&#125;,
           <span class="tag">&lt;/<span class="name">if</span>&gt;</span>
           UPDATE_TIME = NOW()
       <span class="tag">&lt;/<span class="name">set</span>&gt;</span>
       WHERE PRODUCT_ID = $&#123;item.productId&#125;
    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>
<span class="tag">&lt;/<span class="name">update</span>&gt;</span></code></pre>
<h5 id="使用foreach遍历list集合作为查询条件"><a class="markdownIt-Anchor" href="#使用foreach遍历list集合作为查询条件"></a> 使用foreach遍历list集合作为查询条件</h5>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findForeachByList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;dept&quot;</span>&gt;</span>
    select * from dept where deptno in
    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;deptno&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span>
        #&#123;deptno&#125;
    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<p>接口方法：</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span>&#123; 
    <span class="keyword">public</span> List <span class="title function_">findForeachByList</span> <span class="params">(List deptNoList)</span>; &#125;</code></pre>
<h5 id="使用foreach遍历数组作为查询条件"><a class="markdownIt-Anchor" href="#使用foreach遍历数组作为查询条件"></a> 使用foreach遍历数组作为查询条件</h5>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findForeachByArray&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;dept&quot;</span>&gt;</span>
    select * from dept where deptno in
    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;array&quot;</span> <span class="attr">item</span>=<span class="string">&quot;deptno&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">sparator</span>=<span class="string">&quot;,&quot;</span>&gt;</span>
        #&#123;deptno&#125;
     <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>        
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<p>接口方法：</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span>&#123; 
    <span class="keyword">public</span> List <span class="title function_">findForeachByArray</span> <span class="params">(<span class="type">int</span>[] deptArray)</span>; 
    &#125;</code></pre>
<h5 id="使用foreach遍历map"><a class="markdownIt-Anchor" href="#使用foreach遍历map"></a> 使用foreach遍历Map</h5>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findForeachByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;dept&quot;</span>&gt;</span>
    select * from dept where deptno in
    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;myMap.values&quot;</span> <span class="attr">item</span>=<span class="string">&quot;deptno&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>&quot;)&quot; <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span>
        #&#123;deptno&#125;
    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<p>接口方法：</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span>&#123; 
    <span class="keyword">public</span> List <span class="title function_">findForeachByMap</span> <span class="params">(<span class="meta">@Param(&quot;myMap&quot;)</span> Map map)</span>; 
    &#125;</code></pre>
<h4 id="bind标签"><a class="markdownIt-Anchor" href="#bind标签"></a> bind标签</h4>
<ul>
<li>bind标签就像在做一次字符串拼接，方便后续使用</li>
</ul>
<pre><code class="highlight xml">       <span class="comment">&lt;!-- 本来的模糊查询方式 --&gt;</span>
<span class="comment">&lt;!--         &lt;select id=&quot;listProduct&quot; resultType=&quot;Product&quot;&gt; --&gt;</span>
<span class="comment">&lt;!--             select * from   product_  where name like concat(&#x27;%&#x27;,#&#123;0&#125;,&#x27;%&#x27;) --&gt;</span>
<span class="comment">&lt;!--         &lt;/select&gt; --&gt;</span>
             
        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listProduct&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Product&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;likename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27; + name + &#x27;%&#x27;&quot;</span> /&gt;</span>
            select * from   product_  where name like #&#123;likename&#125;
        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h3 id="mybatis标签"><a class="markdownIt-Anchor" href="#mybatis标签"></a> mybatis标签</h3>
<h4 id="sql标签"><a class="markdownIt-Anchor" href="#sql标签"></a> sql标签</h4>
<p>如果某条语句的一部分是大量重复使用的，就可以使用sql标签</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;deptFindSql&quot;</span>&gt;</span>
    select * from emp
<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></code></pre>
<p>然后通过<include>标签注入</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByDeptNo&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;deptFindSql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span> where deptno=#&#123;deptno&#125;
<span class="tag">&lt;/<span class="name">select</span>&gt;</span>

<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByDeptId&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;deptFindSql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span> where deptno=#&#123;deptid&#125;
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<h2 id="mybatis注解"><a class="markdownIt-Anchor" href="#mybatis注解"></a> Mybatis注解</h2>
<h3 id="注解crud"><a class="markdownIt-Anchor" href="#注解crud"></a> 注解CRUD</h3>
<h4 id="实体类-2"><a class="markdownIt-Anchor" href="#实体类-2"></a> 实体类</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * 数据库表实体类</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name ;
<span class="comment">//    private List&lt;Product&gt; products;</span>

    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;

    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;

<span class="comment">//    public List&lt;Product&gt; getProducts() &#123;</span>
<span class="comment">//        return products;</span>
<span class="comment">//    &#125;</span>
<span class="comment">//</span>
<span class="comment">//    public void setProducts(List&lt;Product&gt; products) &#123;</span>
<span class="comment">//        this.products = products;</span>
<span class="comment">//    &#125;</span>

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Category&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span>;
    &#125;
&#125;
</code></pre>
<h4 id="新增mapper接口"><a class="markdownIt-Anchor" href="#新增mapper接口"></a> 新增mapper接口</h4>
<ul>
<li>该接口就相当于Category.xml配置文件</li>
<li>其实就是把sql语句从xml挪到了注解上</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="keyword">import</span> org.apache.ibatis.annotations.Delete;
<span class="keyword">import</span> org.apache.ibatis.annotations.Insert;
<span class="keyword">import</span> org.apache.ibatis.annotations.Select;
<span class="keyword">import</span> org.apache.ibatis.annotations.Update;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * 这个类就相当于Category.xml，都是一样的</span>
<span class="comment"> * 要想使用这个类也需要在mybatis-config.xml中配置</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> &#123;

    <span class="meta">@Insert(&quot;insert into category (name) values (#&#123;name&#125;)&quot;)</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addCategory</span><span class="params">(Category category)</span>;

    <span class="meta">@Delete(&quot;delete from category where id = #&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteCategory</span><span class="params">(<span class="type">int</span> i)</span>;

    <span class="meta">@Select(&quot;select * from category where id = #&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">(<span class="type">int</span> id)</span>;

    <span class="meta">@Update(&quot;update category set name = #&#123;name&#125; where id = #&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateCategory</span><span class="params">(Category category)</span>;

    <span class="meta">@Select(&quot;select * from category&quot;)</span>
    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">listCategory</span><span class="params">()</span>;

&#125;
</code></pre>
<blockquote>
<p><strong>或者也可以不写注解</strong><br />
只写一个Java接口，不写注解，方法名与xml文件中的id相对应，也可使用mapper调用</p>
</blockquote>
<h4 id="在mybatis-configxml中配置"><a class="markdownIt-Anchor" href="#在mybatis-configxml中配置"></a> 在mybatis-config.xml中配置</h4>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="comment">&lt;!-- 配置自动扫描com.lee.mybatis1.entity包下的类型，使得在后续配置文件Category.xml中使用resultType的时候可以直接使用Category</span>
<span class="comment">     而不用写全路径com.lee.mybaits1.entity.Category--&gt;</span>
    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span>
        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.lee.mybatis1.entity&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span>

    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/lee_test?characterEncoding=UTF-8&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span>
    <span class="comment">&lt;!--映射Catrgory.xml--&gt;</span>
    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Category.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Product.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/OrderItem.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Order.xml&quot;</span>/&gt;</span>

新增-------------------------------------------------------
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.CategoryMapper&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>

------------------------------------------------------------

<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<h4 id="使用mapper调用"><a class="markdownIt-Anchor" href="#使用mapper调用"></a> 使用mapper调用</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.test;


<span class="keyword">import</span> com.lee.mybatis1.entity.Category;
<span class="keyword">import</span> com.lee.mybatis1.entity.CategoryMapper;
<span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="keyword">import</span> org.apache.ibatis.io.Resources;
<span class="keyword">import</span> org.apache.ibatis.session.SqlSession;
<span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;
<span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;

<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.InputStream;
<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/5/27.</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMybatis2</span> &#123;
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;
        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;
        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);
        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);
        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();
        <span class="comment">//使用注解方式在这里要加一行语句</span>
        <span class="comment">// sqlSession.getMapper(CategoryMapper.class)应该相当于根据接口方法和注解中的sql语句，使用Java反射生成一个封装好的实现类</span>
        <span class="comment">//内部实现了</span>
        <span class="type">CategoryMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CategoryMapper.class);
        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();
        <span class="comment">//增加</span>
        category.setName(<span class="string">&quot;公关部&quot;</span>);
        mapper.addCategory(category);
        <span class="comment">//获取</span>
        <span class="type">Category</span> <span class="variable">category1</span> <span class="operator">=</span> mapper.getCategory(<span class="number">6</span>);
        System.out.println(category1);
        <span class="comment">//修改</span>
        <span class="type">Category</span> <span class="variable">category2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();
        category2.setName(<span class="string">&quot;哈哈部&quot;</span>);
        category2.setId(<span class="number">6</span>);
        mapper.updateCategory(category2);
        <span class="comment">//删除</span>
        mapper.deleteCategory(<span class="number">6</span>);
        <span class="comment">//获取list</span>
        List&lt;Category&gt; list = mapper.listCategory();
        <span class="keyword">for</span> (Category c : list) &#123;
            System.out.println(c);
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="注解-一对多"><a class="markdownIt-Anchor" href="#注解-一对多"></a> 注解 一对多</h3>
<ul>
<li>使用<code>@Many</code>关键字</li>
</ul>
<h4 id="实体类-3"><a class="markdownIt-Anchor" href="#实体类-3"></a> 实体类</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * 数据库表实体类</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name ;
    <span class="keyword">private</span> List&lt;Product&gt; products;

    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;

    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;

    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getProducts</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> products;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> &#123;
        <span class="built_in">this</span>.products = products;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Category&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span>;
    &#125;
&#125;</code></pre>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/5/23.</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> <span class="type">double</span> price;
    <span class="keyword">private</span> <span class="type">int</span> groups;
    <span class="keyword">private</span> Category category;


    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">()</span>&#123;

    &#125;
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(<span class="type">int</span> id, String name, <span class="type">double</span> price,<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.id = id;
        <span class="built_in">this</span>.name = name;
        <span class="built_in">this</span>.price = price;
        <span class="built_in">this</span>.groups = groups;
    &#125;

    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;

    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;

    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> price;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">double</span> price)</span> &#123;
        <span class="built_in">this</span>.price = price;
    &#125;


    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getGroups</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> groups;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGroups</span><span class="params">(<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.groups = groups;
    &#125;

    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> category;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCategory</span><span class="params">(Category category)</span> &#123;
        <span class="built_in">this</span>.category = category;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Product&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +
                <span class="string">&quot;, price=&quot;</span> + price +
                <span class="string">&quot;, groups=&quot;</span> + groups +
                <span class="string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;</code></pre>
<h4 id="定义mapper接口"><a class="markdownIt-Anchor" href="#定义mapper接口"></a> 定义mapper接口</h4>
<ul>
<li>CategoryMapper接口
<ul>
<li><code>column</code>表示数据库字段名</li>
<li><code>property</code>表示成员变量名</li>
<li><code>javaType</code>表示成员变量类型，基本类型不用特别标注</li>
</ul>
</li>
</ul>
<blockquote>
<p>数据库字段名于实体类成员变量名<strong>不同</strong>的需要特别标注。<br />
数据库字段<strong>多次</strong>使用赋值的要特别标注。<br />
成员变量类型特殊的(List)需要特别标注</p>
</blockquote>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="keyword">import</span> org.apache.ibatis.annotations.Many;
<span class="keyword">import</span> org.apache.ibatis.annotations.Result;
<span class="keyword">import</span> org.apache.ibatis.annotations.Results;
<span class="keyword">import</span> org.apache.ibatis.annotations.Select;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/5/28.</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper2</span> &#123;

    <span class="meta">@Select(&quot;select * from category&quot;)</span>
    <span class="meta">@Results(&#123;</span>
<span class="meta">            //column表示数据库字段名，property表示成员变量名，javaType表示成员变量类型，基本类型不用特别标注</span>
<span class="meta">            //如果一个字段多次使用，必须标注每次查询要传递给哪个字段，这个例子就是第一行和第三行各用了一次id，如果不标注，就会查询出null</span>
<span class="meta">            //像name字段名和成员变量名相同，也只用了一次，就不用特别标注，框架会自动入参</span>
<span class="meta">            @Result(property = &quot;id&quot; , column = &quot;id&quot;),</span>
<span class="meta">            @Result(property = &quot;name&quot; , column = &quot;name&quot;),</span>
<span class="meta">            //@Results 通过@Result和@Many中调用ProductMapper.listByCategory()方法相结合，来获取一对多关系</span>
<span class="meta">            @Result(property = &quot;products&quot; , javaType = List.class , column = &quot;id&quot; , many = @Many(select =</span>
<span class="meta">                    &quot;com.lee.mybatis1.entity.ProductMapper.listByCategory&quot;))</span>
<span class="meta">    &#125;)</span>
    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">listCategory</span><span class="params">()</span>;

&#125;</code></pre>
<ul>
<li>ProductMapper</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="keyword">import</span> org.apache.ibatis.annotations.Select;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/5/28.</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> &#123;

    <span class="meta">@Select(&quot;select * from Product where groups = #&#123;cid&#125;&quot;)</span>
    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">listByCategory</span><span class="params">(<span class="type">int</span> cid)</span>;
&#125;
</code></pre>
<h5 id="在mybatis-configxml中定义"><a class="markdownIt-Anchor" href="#在mybatis-configxml中定义"></a> 在mybatis-config.xml中定义</h5>
<pre><code class="highlight xml"> <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.CategoryMapper2&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.ProductMapper&quot;</span>/&gt;</span>
<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></code></pre>
<h4 id="测试运行"><a class="markdownIt-Anchor" href="#测试运行"></a> 测试运行</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.test;

<span class="keyword">import</span> com.lee.mybatis1.entity.Category;
<span class="keyword">import</span> com.lee.mybatis1.entity.CategoryMapper2;
<span class="keyword">import</span> com.lee.mybatis1.entity.Product;
<span class="keyword">import</span> org.apache.ibatis.io.Resources;
<span class="keyword">import</span> org.apache.ibatis.session.SqlSession;
<span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;
<span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;

<span class="keyword">import</span> java.io.InputStream;
<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * Created by liboar on 2019/5/28.</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMybatis3</span> &#123;
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;
        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;
        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);
        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);
        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();

        <span class="type">CategoryMapper2</span> <span class="variable">categoryMapper2</span> <span class="operator">=</span> sqlSession.getMapper(CategoryMapper2.class);
        List&lt;Category&gt; list = categoryMapper2.listCategory();
        <span class="keyword">for</span> (Category c: list) &#123;
            System.out.println(c.getId()+<span class="string">&quot;-&quot;</span>+c.getName());;
            <span class="keyword">for</span> (Product p:c.getProducts()) &#123;
                System.out.println(p);
            &#125;
        &#125;
    &#125;
&#125;</code></pre>
<h3 id="注解-多对一"><a class="markdownIt-Anchor" href="#注解-多对一"></a> 注解 多对一</h3>
<ul>
<li>即 <strong>一</strong> 个类型里包含另一个类型（<strong>多</strong>个字段）</li>
<li>使用<code>@One</code>关键字</li>
</ul>
<h4 id="实体类-4"><a class="markdownIt-Anchor" href="#实体类-4"></a> 实体类</h4>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name ;
<span class="comment">//    private List&lt;Product&gt; products;</span>
    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
<span class="comment">//    public List&lt;Product&gt; getProducts() &#123;</span>
<span class="comment">//        return products;</span>
<span class="comment">//    &#125;</span>
<span class="comment">//</span>
<span class="comment">//    public void setProducts(List&lt;Product&gt; products) &#123;</span>
<span class="comment">//        this.products = products;</span>
<span class="comment">//    &#125;</span>
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Category&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span>;
    &#125;
&#125;</code></pre>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> <span class="type">double</span> price;
    <span class="keyword">private</span> <span class="type">int</span> groups;
    <span class="keyword">private</span> Category category;
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">()</span>&#123;

    &#125;
    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(<span class="type">int</span> id, String name, <span class="type">double</span> price,<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.id = id;
        <span class="built_in">this</span>.name = name;
        <span class="built_in">this</span>.price = price;
        <span class="built_in">this</span>.groups = groups;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;
    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> price;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">double</span> price)</span> &#123;
        <span class="built_in">this</span>.price = price;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getGroups</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> groups;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGroups</span><span class="params">(<span class="type">int</span> groups)</span> &#123;
        <span class="built_in">this</span>.groups = groups;
    &#125;
    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> category;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCategory</span><span class="params">(Category category)</span> &#123;
        <span class="built_in">this</span>.category = category;
    &#125;
    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Product&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +
                <span class="string">&quot;, price=&quot;</span> + price +
                <span class="string">&quot;, groups=&quot;</span> + groups +
                <span class="string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;</code></pre>
<h4 id="定义mapper"><a class="markdownIt-Anchor" href="#定义mapper"></a> 定义mapper</h4>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper3</span> &#123;
    <span class="meta">@Select(&quot;select * from category where id = #&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">(<span class="type">int</span> id)</span>;
&#125;</code></pre>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper2</span> &#123;

    <span class="meta">@Select(&quot;select * from product&quot;)</span>
    <span class="meta">@Results(&#123;</span>
<span class="meta">            //其他成员变量名于数据库字段相同的都不用特别说明</span>
<span class="meta">            @Result(property=&quot;groups&quot; , column = &quot;groups&quot;),</span>
<span class="meta">            @Result(property=&quot;category&quot; , column=&quot;groups&quot; ,one=@One(select=&quot;com.lee.mybatis1.entity.CategoryMapper3.getCategory&quot;))</span>
<span class="meta">    &#125;)</span>
    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">listProduct</span><span class="params">()</span>;
&#125;</code></pre>
<h4 id="配置mybatis-configxml"><a class="markdownIt-Anchor" href="#配置mybatis-configxml"></a> 配置mybatis-config.xml</h4>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.CategoryMapper3&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.ProductMapper2&quot;</span>/&gt;</span>
<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></code></pre>
<h4 id="测试运行-2"><a class="markdownIt-Anchor" href="#测试运行-2"></a> 测试运行</h4>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;
    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;
    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);
    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);
    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();
    <span class="type">ProductMapper2</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(ProductMapper2.class);
    List&lt;Product&gt; list = mapper.listProduct();
    <span class="keyword">for</span> (Product p:list) &#123;
        System.out.println(p+<span class="string">&quot;--&quot;</span>+p.getCategory().getId()+<span class="string">&quot;:&quot;</span>+p.getCategory().getName())；
    &#125;
&#125;</code></pre>
<h3 id="注解-多对多"><a class="markdownIt-Anchor" href="#注解-多对多"></a> 注解 多对多</h3>
<h4 id="实体类-5"><a class="markdownIt-Anchor" href="#实体类-5"></a> 实体类</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;
<span class="keyword">import</span> java.util.List;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id;
    <span class="keyword">private</span> String code;

    List&lt;OrderItem&gt; orderItems;

    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> code;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(String code)</span> &#123;
        <span class="built_in">this</span>.code = code;
    &#125;
    <span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title function_">getOrderItems</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> orderItems;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrderItems</span><span class="params">(List&lt;OrderItem&gt; orderItems)</span> &#123;
        <span class="built_in">this</span>.orderItems = orderItems;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Order&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, code=&#x27;&quot;</span> + code + <span class="string">&#x27;\&#x27;&#x27;</span> +
                <span class="string">&quot;, orderItems=&quot;</span> + orderItems +
                <span class="string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;</code></pre>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id;
    <span class="keyword">private</span> <span class="type">int</span> number;
    <span class="keyword">private</span> Order order;
    <span class="keyword">private</span> Product product;

    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumber</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> number;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNumber</span><span class="params">(<span class="type">int</span> number)</span> &#123;
        <span class="built_in">this</span>.number = number;
    &#125;
    <span class="keyword">public</span> Order <span class="title function_">getOrder</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> order;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrder</span><span class="params">(Order order)</span> &#123;
        <span class="built_in">this</span>.order = order;
    &#125;
    <span class="keyword">public</span> Product <span class="title function_">getProduct</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> product;
    &#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProduct</span><span class="params">(Product product)</span> &#123;
        <span class="built_in">this</span>.product = product;
    &#125;
&#125;</code></pre>
<h4 id="定义mapper-2"><a class="markdownIt-Anchor" href="#定义mapper-2"></a> 定义mapper</h4>
<ul>
<li>OrderMapper</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;
    <span class="meta">@Select(&quot;select * from orders&quot;)</span>
    <span class="meta">@Results(&#123;</span>
<span class="meta">            @Result(property = &quot;id&quot; , column = &quot;id&quot;),</span>
<span class="meta">            @Result(property = &quot;orderItems&quot; , javaType = List.class,column = &quot;id&quot; ,many = @Many(select = &quot;com.lee.mybatis1.entity.OrderItemMapper.listByOrder&quot;))</span>
<span class="meta">    &#125;)</span>
    <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">listOrder</span><span class="params">()</span>;
&#125;</code></pre>
<ul>
<li>OrderItemMapper</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderItemMapper</span> &#123;

    <span class="meta">@Select(&quot;select * from order_item where oid = #&#123;oid&#125;&quot;)</span>
    <span class="meta">@Results(&#123;</span>
<span class="meta">            //这里没有标注order成员变量的赋值，因为用不到，所以为null</span>
<span class="meta">            @Result(property = &quot;product&quot; , column = &quot;pid&quot; , one = @One(select = &quot;com.lee.mybatis1.entity.ProductMapper3.getProductById&quot;))</span>
<span class="meta">    &#125;)</span>
    <span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title function_">listByOrder</span><span class="params">(<span class="type">int</span> oid)</span>;
&#125;</code></pre>
<ul>
<li>ProductMapper3</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper3</span> &#123;

    <span class="meta">@Select(&quot;select * from product where id = #&#123;id&#125;&quot;)</span>
    <span class="keyword">public</span> Product <span class="title function_">getProductById</span><span class="params">(<span class="type">int</span> id)</span>;
&#125;</code></pre>
<h4 id="配置mybatis-configxml-2"><a class="markdownIt-Anchor" href="#配置mybatis-configxml-2"></a> 配置mybatis-config.xml</h4>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
      <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.ProductMapper3&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.OrderMapper&quot;</span>/&gt;</span>       <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.OrderItemMapper&quot;</span>/&gt;</span>
<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></code></pre>
<h4 id="测试运行-3"><a class="markdownIt-Anchor" href="#测试运行-3"></a> 测试运行</h4>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;
    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;
    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);
    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);
    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();
    <span class="type">OrderMapper</span> <span class="variable">orderMapper</span> <span class="operator">=</span> sqlSession.getMapper(OrderMapper.class);
    List&lt;Order&gt; list = orderMapper.listOrder();
    <span class="keyword">for</span>(Order o:list)&#123;
        System.out.println(o.getCode());
        <span class="keyword">for</span>(OrderItem oi:o.getOrderItems())&#123;
            System.out.println(oi.getProduct().getName()+<span class="string">&quot;:&quot;</span>+oi.getProduct().getPrice()+<span class="string">&quot;:&quot;</span>+oi.getNumber());
        &#125;
    &#125;
&#125;</code></pre>
<h3 id="动态sql语句"><a class="markdownIt-Anchor" href="#动态sql语句"></a> 动态SQL语句</h3>
<ul>
<li>这里的SQL语句使用SQL类的方式构建</li>
</ul>
<h4 id="新建provider类"><a class="markdownIt-Anchor" href="#新建provider类"></a> 新建Provider类</h4>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;

<span class="comment">/**</span>
<span class="comment"> * 这里的sql语句使用动态sql类的方式构建</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryDynaSqlProvider</span> &#123;
    <span class="keyword">public</span> String <span class="title function_">list</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>().SELECT(<span class="string">&quot;*&quot;</span>).FROM(<span class="string">&quot;category&quot;</span>).toString();
    &#125;

    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>().SELECT(<span class="string">&quot;*&quot;</span>).FROM(<span class="string">&quot;category&quot;</span>).WHERE(<span class="string">&quot;id=#&#123;id&#125;&quot;</span>).toString();
    &#125;

    <span class="keyword">public</span> String <span class="title function_">add</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>().INSERT_INTO(<span class="string">&quot;category&quot;</span>).VALUES(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;#&#123;name&#125;&quot;</span>).toString();
    &#125;

    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>().UPDATE(<span class="string">&quot;category&quot;</span>).SET(<span class="string">&quot;name=#&#123;name&#125;&quot;</span>).WHERE(<span class="string">&quot;id=#&#123;id&#125;&quot;</span>).toString();
    &#125;

    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">()</span>&#123;
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>().DELETE_FROM(<span class="string">&quot;category&quot;</span>).WHERE(<span class="string">&quot;id=#&#123;id&#125;&quot;</span>).toString();
    &#125;
&#125;
</code></pre>
<h4 id="修改categorymapper"><a class="markdownIt-Anchor" href="#修改categorymapper"></a> 修改CategoryMapper</h4>
<ul>
<li>修改这个类以前的注解sql，改为引用的方式</li>
<li>使用运行方式和以前的Mapper方式相同</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.entity;

<span class="keyword">import</span> org.apache.ibatis.annotations.*;

<span class="keyword">import</span> java.util.List;

<span class="comment">/**</span>
<span class="comment"> * 这个类就相当于Category.xml，都是一样的</span>
<span class="comment"> * 要想使用这个类也需要在mybatis-config.xml中配置</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> &#123;

    <span class="comment">//@Insert(&quot;insert into category (name) values (#&#123;name&#125;)&quot;)</span>
    <span class="meta">@InsertProvider(type = CategoryDynaSqlProvider.class, method = &quot;add&quot;)</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addCategory</span><span class="params">(Category category)</span>;

    <span class="comment">//@Delete(&quot;delete from category where id = #&#123;id&#125;&quot;)</span>
    <span class="meta">@DeleteProvider(type = CategoryDynaSqlProvider.class, method = &quot;delete&quot;)</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteCategory</span><span class="params">(<span class="type">int</span> i)</span>;

    <span class="comment">//@Select(&quot;select * from category where id = #&#123;id&#125;&quot;)</span>
    <span class="meta">@SelectProvider(type = CategoryDynaSqlProvider.class, method = &quot;get&quot;)</span>
    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">(<span class="type">int</span> id)</span>;

    <span class="comment">//@Update(&quot;update category set name = #&#123;name&#125; where id = #&#123;id&#125;&quot;)</span>
    <span class="meta">@UpdateProvider(type = CategoryDynaSqlProvider.class, method = &quot;update&quot;)</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateCategory</span><span class="params">(Category category)</span>;

    <span class="comment">//@Select(&quot;select * from category&quot;)</span>
    <span class="meta">@SelectProvider(type = CategoryDynaSqlProvider.class, method = &quot;list&quot;)</span>
    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">listCategory</span><span class="params">()</span>;

&#125;
</code></pre>
<h4 id="复杂动态sql示例"><a class="markdownIt-Anchor" href="#复杂动态sql示例"></a> 复杂动态sql示例</h4>
<pre><code class="highlight java"><span class="keyword">private</span> String <span class="title function_">selectPersonSql</span><span class="params">()</span> &#123;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;&#123;
    SELECT(<span class="string">&quot;P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME&quot;</span>);
    SELECT(<span class="string">&quot;P.LAST_NAME, P.CREATED_ON, P.UPDATED_ON&quot;</span>);
    FROM(<span class="string">&quot;PERSON P&quot;</span>);
    FROM(<span class="string">&quot;ACCOUNT A&quot;</span>);
    INNER_JOIN(<span class="string">&quot;DEPARTMENT D on D.ID = P.DEPARTMENT_ID&quot;</span>);
    INNER_JOIN(<span class="string">&quot;COMPANY C on D.COMPANY_ID = C.ID&quot;</span>);
    WHERE(<span class="string">&quot;P.ID = A.ID&quot;</span>);
    WHERE(<span class="string">&quot;P.FIRST_NAME like ?&quot;</span>);
    OR();
    WHERE(<span class="string">&quot;P.LAST_NAME like ?&quot;</span>);
    GROUP_BY(<span class="string">&quot;P.ID&quot;</span>);
    HAVING(<span class="string">&quot;P.LAST_NAME like ?&quot;</span>);
    OR();
    HAVING(<span class="string">&quot;P.FIRST_NAME like ?&quot;</span>);
    ORDER_BY(<span class="string">&quot;P.ID&quot;</span>);
    ORDER_BY(<span class="string">&quot;P.FULL_NAME&quot;</span>);
  &#125;&#125;.toString();
&#125;</code></pre>
<h2 id="mybatis-实战"><a class="markdownIt-Anchor" href="#mybatis-实战"></a> Mybatis 实战</h2>
<h3 id="日志"><a class="markdownIt-Anchor" href="#日志"></a> 日志</h3>
<ul>
<li>有时候需要打印日志，知道mybatis执行了什么样的SQL语句，以便进行调试。这时，就需要开启日志，而mybatis自身是没有带日志的，使用的都是第三方日志工具log4j</li>
</ul>
<h4 id="导入log4j-jar包"><a class="markdownIt-Anchor" href="#导入log4j-jar包"></a> 导入log4j jar包</h4>
<ul>
<li></li>
</ul>
<h4 id="定义log4properties"><a class="markdownIt-Anchor" href="#定义log4properties"></a> 定义log4.properties</h4>
<pre><code class="highlight properties"><span class="comment"># 全局的日志设置</span>
<span class="comment"># 代表root节点整个工程下所有输出日志的地方配置的输出的级别和输出的位置</span>
<span class="attr">log4j.rootLogger</span>=<span class="string">ERROR, stdout</span>
<span class="comment"># mybatis的日志设置</span>
<span class="comment"># 代表特定包下的特定级别。log4j把日志分为ALL、TRACE&amp;（跟踪）、DEBUG（调试）、INFO（信息）、WARNING（警告）、ERROR（错误）、FITAL（致命）、OFF等几个级别，级别依次升高。级别高的Level会屏蔽级别低的信息。</span>
 <span class="attr">log4j.logger.com.lee</span>=<span class="string">TRACE</span>
<span class="comment"># 输出到控制台</span>
<span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span>
<span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span>
<span class="comment"># 定义输出格式</span>
<span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></code></pre>
<ul>
<li>别人的配置，仅供参考</li>
</ul>
<pre><code class="highlight properties"><span class="comment"></span>
<span class="comment">### 设置Logger输出级别和输出目的地 ### debug更具体,假设设为info那么打印出的表数据遇到字符串就不显示。此外还有logfile</span>
<span class="attr">log4j.rootLogger</span>=<span class="string">debug,stdout</span>
<span class="comment"></span>
<span class="comment">### 把日志信息输出到控制台 ### </span>
<span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span>
<span class="comment">#log4j.appender.stdout.Target=System.err </span>
<span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.SimpleLayout </span>
<span class="comment"></span>
<span class="comment">### 把日志信息输出到文件：jbit.log ### </span>
<span class="comment">#log4j.appender.logfile=org.apache.log4j.FileAppender </span>
<span class="comment">#log4j.appender.logfile.File=jbit.log </span>
<span class="comment">#log4j.appender.logfile.layout=org.apache.log4j.PatternLayout </span>
<span class="comment">#log4j.appender.logfile.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss&#125; %F %p %m%n </span>
<span class="comment"></span>
<span class="comment">###显示SQL语句部分 </span>
<span class="comment">#log4j.logger.com.mybatis=DEBUG</span>
<span class="comment">#log4j.logger.com.mybatis.common.jdbc.SimpleDataSource=DEBUG </span>
<span class="comment">#log4j.logger.com.mybatis.common.jdbc.ScriptRunner=DEBUG </span>
<span class="comment">#log4j.logger.com.mybatis.sqlmap.engine.impl.SqlMapClientDelegate=DEBUG </span>
<span class="comment">#log4j.logger.java.sql.Connection=DEBUG</span>
<span class="comment">#log4j.logger.java.sql.Statement=DEBUG</span>
<span class="comment">#log4j.logger.java.sql.PreparedStatement=DEBUG</span>
<span class="comment">#log4j.logger.java.sql.ResultSet=DEBUG</span></code></pre>
<h4 id="运行测试"><a class="markdownIt-Anchor" href="#运行测试"></a> 运行测试</h4>
<ul>
<li>直接运行TestMybatis.java类中的main方法</li>
<li>就可以直接打印出日志</li>
</ul>
<h3 id="事务管理"><a class="markdownIt-Anchor" href="#事务管理"></a> 事务管理</h3>
<h4 id="jdbc方式"><a class="markdownIt-Anchor" href="#jdbc方式"></a> JDBC方式</h4>
<ul>
<li>首先要确保mybatis-config.xml中<code>&lt;transactionManager type=&quot;JDBC&quot;&gt;</code></li>
<li>即事物管理者类型为JDBC</li>
</ul>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="comment">&lt;!-- 配置自动扫描com.lee.mybatis1.entity包下的类型，使得在后续配置文件Category.xml中使用resultType的时候可以直接使用Category</span>
<span class="comment">     而不用写全路径com.lee.mybaits1.entity.Category--&gt;</span>
    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span>
        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.lee.mybatis1.entity&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span>

    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span>

------------------------------------------------
            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>

------------------------------------------------
            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/lee_test?characterEncoding=UTF-8&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span>
    <span class="comment">&lt;!--映射Catrgory.xml--&gt;</span>
    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Category.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Product.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/OrderItem.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Order.xml&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>
<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<h4 id="innodb引擎"><a class="markdownIt-Anchor" href="#innodb引擎"></a> INNODB引擎</h4>
<ul>
<li>确保MySQL中的表为innodb类型，才能支持事物，所以需要把表设置为innodb类型</li>
<li><strong>修改表为innodb</strong></li>
</ul>
<pre><code class="highlight sql"><span class="keyword">alter table</span> category_ ENGINE <span class="operator">=</span> innodb;</code></pre>
<ul>
<li><strong>查看表引擎为什么类型</strong></li>
</ul>
<pre><code class="highlight sql"><span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">from</span> how2java;</code></pre>
<h4 id="测试代码"><a class="markdownIt-Anchor" href="#测试代码"></a> 测试代码</h4>
<ul>
<li>插入第二个数据会因为长度超过32，而导致无法插入到数据库。因为在同一个事务里，所以第一个数据，也<strong>无法插入成功</strong></li>
<li>如果在第二个数据之前第一个数据之后写commit语句，则第一个数据会插入成功，第二个数据之后的数据全部插入失败，如果把第二个错误数据用try catch包起来，那么只有第二个插入失败，第二个后面也可以成功</li>
</ul>
<pre><code class="highlight java"><span class="type">CategoryMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CategoryMapper.class);
<span class="comment">//增加</span>
<span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();
category.setName(<span class="string">&quot;公关部&quot;</span>);
mapper.addCategory(category);

<span class="type">Category</span> <span class="variable">category2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();
category2.setName(<span class="string">&quot;超过最大长度30的名称超过最大长度30的名称超过最大长度30的名称超过最大长度30的名称超过最大长度30的名称超过最大长度30的名称&quot;</span>);
mapper.addCategory(category2);
<span class="comment">//提交事物</span>
sqlSession.commit();
sqlSession.close();</code></pre>
<h3 id="延迟加载"><a class="markdownIt-Anchor" href="#延迟加载"></a> 延迟加载</h3>
<ul>
<li>其作用是给一个实体类查询赋值时，若该实体类包含另一个实体类，需要单独在查询一次包含的实体类，即一对多的情况下，加上延迟加载后，如果你调用的包含类财货执行包含类的查询语句，如果没有使用该包含类，则不调用该包含类的单独的查询语句</li>
</ul>
<h4 id="在mybatis-configxml配置延迟加载"><a class="markdownIt-Anchor" href="#在mybatis-configxml配置延迟加载"></a> 在mybatis-config.xml配置延迟加载</h4>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="tag">&lt;<span class="name">settings</span>&gt;</span> 
         <span class="comment">&lt;!-- 打开延迟加载的开关 --&gt;</span> 
         <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span> 
         <span class="comment">&lt;!-- 将积极加载改为消息加载即按需加载 --&gt;</span> 
         <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span> 
    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span> 

<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<h4 id="测试运行-4"><a class="markdownIt-Anchor" href="#测试运行-4"></a> 测试运行</h4>
<ul>
<li>CategoryMapper2</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper2</span> &#123;

    <span class="meta">@Select(&quot;select * from category&quot;)</span>
    <span class="meta">@Results(&#123;</span>
<span class="meta">            //column表示数据库字段名，property表示成员变量名，javaType表示成员变量类型，基本类型不用特别标注</span>
<span class="meta">            //如果一个字段多次使用，必须标注每次查询要传递给哪个字段，这个例子就是第一行和第三行各用了一次id，如果不标注，就会查询出null</span>
<span class="meta">            //像name字段名和成员变量名相同，也只用了一次，就不用特别标注，框架会自动入参</span>
<span class="meta">            @Result(property = &quot;id&quot; , column = &quot;id&quot;),</span>
<span class="meta">            @Result(property = &quot;name&quot; , column = &quot;name&quot;),</span>
<span class="meta">            //@Results 通过@Result和@Many中调用ProductMapper.listByCategory()方法相结合，来获取一对多关系</span>
<span class="meta">            @Result(property = &quot;products&quot; , javaType = List.class , column = &quot;id&quot; , many = @Many(select =</span>
<span class="meta">                    &quot;com.lee.mybatis1.entity.ProductMapper.listByCategory&quot;))</span>
<span class="meta">    &#125;)</span>
    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">listCategory</span><span class="params">()</span>;
&#125;</code></pre>
<ul>
<li>当注掉这三个语句后，就不会执行product的相关查询</li>
</ul>
<pre><code class="highlight java">        <span class="type">CategoryMapper2</span> <span class="variable">categoryMapper2</span> <span class="operator">=</span> sqlSession.getMapper(CategoryMapper2.class);
        List&lt;Category&gt; list = categoryMapper2.listCategory();
        <span class="keyword">for</span> (Category c: list) &#123;
            System.out.println(c.getId()+<span class="string">&quot;-&quot;</span>+c.getName());;
<span class="comment">//            for (Product p:c.getProducts()) &#123;</span>
<span class="comment">//                System.out.println(p);</span>
<span class="comment">//            &#125;</span>
        &#125;</code></pre>
<ul>
<li><strong>放开注释后</strong>
<ul>
<li>发现两个语句都执行了</li>
</ul>
</li>
</ul>
<h3 id="分页"><a class="markdownIt-Anchor" href="#分页"></a> 分页</h3>
<h4 id="xml方式"><a class="markdownIt-Anchor" href="#xml方式"></a> xml方式</h4>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listCategory100&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Category&quot;</span>&gt;</span>
    select * from   category
    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;start!=null and count!=null&quot;</span>&gt;</span>
        limit #&#123;start&#125;,#&#123;count&#125;
    <span class="tag">&lt;/<span class="name">if</span>&gt;</span>
<span class="tag">&lt;/<span class="name">select</span>&gt;</span></code></pre>
<ul>
<li>调用</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">xmlWay</span><span class="params">(SqlSession sqlSession,<span class="type">int</span> start,<span class="type">int</span> count)</span>&#123;
    Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();
    <span class="comment">//从第几个开始</span>
    map.put(<span class="string">&quot;start&quot;</span>,start);
    <span class="comment">//每页展示几个</span>
    map.put(<span class="string">&quot;count&quot;</span>,count);
    List&lt;Category&gt; list = sqlSession.selectList(<span class="string">&quot;listCategory100&quot;</span>,map);
    <span class="keyword">for</span>(Category c:list)&#123;
        System.out.println(c.getName());
    &#125;
&#125;</code></pre>
<h4 id="注解方式"><a class="markdownIt-Anchor" href="#注解方式"></a> 注解方式</h4>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> &#123;

    <span class="meta">@Select(&quot; select * from category limit #&#123;start&#125;,#&#123;count&#125;&quot;)</span>
    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">listCategory100</span><span class="params">(<span class="meta">@Param(&quot;start&quot;)</span> <span class="type">int</span> start,<span class="meta">@Param(&quot;count&quot;)</span> <span class="type">int</span> count)</span>;

&#125;</code></pre>
<ul>
<li>调用</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">annotationWay</span><span class="params">(SqlSession sqlSession,<span class="type">int</span> start,<span class="type">int</span> count)</span>&#123;
    <span class="type">CategoryMapper</span> <span class="variable">categoryMapper</span> <span class="operator">=</span> sqlSession.getMapper(CategoryMapper.class);
    List&lt;Category&gt; list = categoryMapper.listCategory100(start,count);
    <span class="keyword">for</span>(Category c:list)&#123;
        System.out.println(c.getName());
    &#125;
&#125;</code></pre>
<blockquote>
<p>原理：使用MySQL的<strong>limit</strong>关键字</p>
</blockquote>
<h4 id="rowbounds方式"><a class="markdownIt-Anchor" href="#rowbounds方式"></a> RowBounds方式</h4>
<ul>
<li>在使用SqlSession的selectList()方法时，指定一个RowBounds分页器参数，即可查询指定范围的记录</li>
<li><code>RowBounds(offset,limit)</code>构造器</li>
</ul>
<pre><code class="highlight java"><span class="type">RowBounds</span> <span class="variable">bounds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RowBounds</span>(offset.limit);

- offset指定抓取记录的起始行，从<span class="number">0</span>开始
- limit指定抓取记录</code></pre>
<ul>
<li><code>selectList()</code>使用方法</li>
</ul>
<pre><code class="highlight java">sqlSession.selectList(sql的id,参数,RowBounds对象);</code></pre>
<ul>
<li>MyBatis分页是基于内存分页，原理是查询出所有的记录，然后<strong>基于jdbc的absolute()和next()方法</strong>定位获取部分记录，因此在遇到大量数据情况下，不推荐使用MyBatis自带分页功能，需要开发者指定分页查询的sql语句或对MyBatis进行扩展使用</li>
</ul>
<h3 id="pagehelper分页插件"><a class="markdownIt-Anchor" href="#pagehelper分页插件"></a> PageHelper分页插件</h3>
<ul>
<li>pageHelper是一个犀利的mybaits分页插件，使用该插件，开发分页更加简单容易</li>
</ul>
<h4 id="导jar包"><a class="markdownIt-Anchor" href="#导jar包"></a> 导jar包</h4>
<h4 id="在mybatis中配置"><a class="markdownIt-Anchor" href="#在mybatis中配置"></a> 在mybatis中配置</h4>
<ul>
<li>该配置语句对行数有要求</li>
</ul>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span>
<span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">configuration</span>&gt;</span>

    <span class="tag">&lt;<span class="name">settings</span>&gt;</span>
        <span class="comment">&lt;!-- 打开延迟加载的开关 --&gt;</span>
        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span>
        <span class="comment">&lt;!-- 将积极加载改为消息加载即按需加载 --&gt;</span>
        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span>
    <span class="comment">&lt;!-- 配置自动扫描com.lee.mybatis1.entity包下的类型，使得在后续配置文件Category.xml中使用resultType的时候可以直接使用Category</span>
<span class="comment">     而不用写全路径com.lee.mybaits1.entity.Category--&gt;</span>
    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span>
        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.lee.mybatis1.entity&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span>
    
-------------------------------------------------------------------------------------------------------------
    <span class="comment">&lt;!--使用pageheler分页工具，该配置语句有位置要求，只能卸载typeAliases和environments之间--&gt;</span>
    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>
        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span>

        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>

-------------------------------------------------------------------------------------------------------------
    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/lee_test?characterEncoding=UTF-8&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span>
    
    <span class="comment">&lt;!--映射Catrgory.xml--&gt;</span>
    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Category.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Product.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/OrderItem.xml&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/lee/mybatis1/entity/Order.xml&quot;</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.CategoryMapper&quot;</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.CategoryMapper2&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.ProductMapper&quot;</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.CategoryMapper3&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.ProductMapper2&quot;</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.ProductMapper3&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.OrderMapper&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.lee.mybatis1.entity.OrderItemMapper&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>

<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<h3 id="一级缓存"><a class="markdownIt-Anchor" href="#一级缓存"></a> 一级缓存</h3>
<ul>
<li>Mybatis的一级缓存在session上，只要通过session查过的数据，都会放在session上，下一次再查询相同id的数据，都直接冲缓存中取出来，而不用到数据库里去取了</li>
</ul>
<h4 id="测试代码-2"><a class="markdownIt-Anchor" href="#测试代码-2"></a> 测试代码</h4>
<ul>
<li>可以发现调用了两次，但是sql语句只执行了一次，数据是从session缓存中取出来的</li>
</ul>
<pre><code class="highlight java"><span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;getCategoryOne&quot;</span>,<span class="number">2</span>);
System.out.println(category.getName());
<span class="type">Category</span> <span class="variable">category1</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;getCategoryOne&quot;</span>,<span class="number">2</span>);
System.out.println(category1.getName());</code></pre>
<ul>
<li>如果重新new一个sqlSession，就会重新执行sql，<strong>证实了一级缓存是在session里的</strong></li>
<li>二级缓存用来实现不同sqlSession之间查询同id语句的缓存</li>
</ul>
<pre><code class="highlight java"><span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;getCategoryOne&quot;</span>,<span class="number">2</span>);
System.out.println(category.getName());
<span class="type">Category</span> <span class="variable">category1</span> <span class="operator">=</span> sqlSessionFactory.openSession().selectOne(<span class="string">&quot;getCategoryOne&quot;</span>,<span class="number">2</span>);
System.out.println(category1.getName());</code></pre>
<h3 id="二级缓存"><a class="markdownIt-Anchor" href="#二级缓存"></a> 二级缓存</h3>
<ul>
<li>对一级缓存进行改造，以支持二级缓存</li>
<li>使得在同一个sqlSessionFactory下所有的sqlSession查询相同id的sql语句都是从二级缓存中取</li>
</ul>
<h4 id="配置mybatis-configxml-3"><a class="markdownIt-Anchor" href="#配置mybatis-configxml-3"></a> 配置mybatis-config.xml</h4>
<ul>
<li>配置以支持二级缓存</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="tag">&lt;<span class="name">settings</span>&gt;</span>
        <span class="comment">&lt;!-- 打开延迟加载的开关 --&gt;</span>
        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span>
        <span class="comment">&lt;!-- 将积极加载改为消息加载即按需加载 --&gt;</span>
        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span>
        <span class="comment">&lt;!--增加二级缓存--&gt;</span>
        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span>
    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
               ... ...
    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>
<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<h4 id="在categoryxml中增加cache"><a class="markdownIt-Anchor" href="#在categoryxml中增加cache"></a> 在Category.xml中增加<cache/></h4>
<ul>
<li>新增<code>&lt;cache/&gt;</code>以启动对Category对象的二级缓存</li>
</ul>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span>
<span class="meta">    <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="meta">    <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>
 
    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.how2java.pojo&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">cache</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addCategory&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Category&quot;</span> &gt;</span>
            insert into category_ ( name ) values (#&#123;name&#125;)   
        <span class="tag">&lt;/<span class="name">insert</span>&gt;</span>
         
        <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteCategory&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Category&quot;</span> &gt;</span>
            delete from category_ where id= #&#123;id&#125;  
        <span class="tag">&lt;/<span class="name">delete</span>&gt;</span>
          
    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<h4 id="序列化category"><a class="markdownIt-Anchor" href="#序列化category"></a> 序列化Category</h4>
<ul>
<li>让Category实现序列化接口</li>
</ul>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span>  <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id ;
    <span class="keyword">private</span> String name ;
    <span class="comment">//private List&lt;Product&gt; products;</span>

    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;&#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;&#125;
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;&#125;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id; &#125;
&#125;</code></pre>
<h4 id="测试运行-5"><a class="markdownIt-Anchor" href="#测试运行-5"></a> 测试运行</h4>
<ul>
<li>但是要想二级缓存<strong>生效</strong>，必须让第一个sqlSession close()或commit()否则无法生效</li>
</ul>
<pre><code class="highlight java"><span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;getCategoryOne&quot;</span>,<span class="number">1</span>);
System.out.println(category.getName());
sqlSession.commit();
<span class="type">Category</span> <span class="variable">category1</span> <span class="operator">=</span> sqlSessionFactory.openSession().selectOne(<span class="string">&quot;getCategoryOne&quot;</span>,<span class="number">1</span>);
System.out.println(category1.getName());</code></pre>
<h3 id="c3p0连接池"><a class="markdownIt-Anchor" href="#c3p0连接池"></a> c3p0连接池</h3>
<h4 id="导入jar包"><a class="markdownIt-Anchor" href="#导入jar包"></a> 导入jar包</h4>
<h4 id="新建c3p0datasourcefactory"><a class="markdownIt-Anchor" href="#新建c3p0datasourcefactory"></a> 新建C3P0DataSourceFactory</h4>
<ul>
<li>Mybatis使用C3P0有点怪怪的，需要自己写个类继承<code>UnpooledDataSourceFactory</code>，然后指定dataSource 为<code>ComboPooledDataSource</code></li>
<li>这个ComboPooledDataSource就是c3p0的数据源</li>
</ul>
<blockquote>
<p>看了下源码，这个类实现了DataSourceFactory接口，所以直接自己 建个类实现DataSourceFactory接口就行，不用通过继承UnpooledDataSourceFactory间接实现这个接口，实现类C3P0DataSourceFactory里面的代码直接抄UnpooledDataSourceFactory这个类就行，就把this.dataSource = new UnpooledDataSource();改成this.dataSource =new ComboPooledDataSource();就行了。测试了下，好像也行，没发现啥问题</p>
</blockquote>
<pre><code class="highlight java"><span class="keyword">package</span> com.lee.mybatis1.c3p0;

<span class="keyword">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;
<span class="keyword">import</span> org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory;

<span class="comment">/**</span>
<span class="comment"> * Mybatis使用C3P0有点怪怪的，需要自己写个类继承UnpooledDataSourceFactory，然后指定dataSource 为ComboPooledDataSource。</span>
<span class="comment"> 这个ComboPooledDataSource就是c3p0的数据源。</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3P0DataSourceFactory</span> <span class="keyword">extends</span> <span class="title class_">UnpooledDataSourceFactory</span>&#123;
    <span class="keyword">public</span> <span class="title function_">C3P0DataSourceFactory</span><span class="params">()</span>&#123;
        <span class="built_in">this</span>.dataSource =<span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();
    &#125;
&#125;</code></pre>
<h4 id="配置mybatis-configxml-4"><a class="markdownIt-Anchor" href="#配置mybatis-configxml-4"></a> 配置mybatis-config.xml</h4>
<ul>
<li>注释掉type=&quot;POOLED&quot;的数据源，换成type=&quot;org.mybatis.c3p0.C3P0DataSourceFactory&quot;的数据源<br />
这样就使用c3p0了</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>
        <span class="comment">&lt;!--&lt;dataSource type=&quot;POOLED&quot;&gt;--&gt;</span>
            <span class="comment">&lt;!--&lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;--&gt;</span>
            <span class="comment">&lt;!--&lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/lee_test?characterEncoding=UTF-8&quot;/&gt;--&gt;</span>
            <span class="comment">&lt;!--&lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;--&gt;</span>
            <span class="comment">&lt;!--&lt;property name=&quot;password&quot; value=&quot;admin&quot;/&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;/dataSource&gt;--&gt;</span>
        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;com.lee.mybatis1.c3p0.C3P0DataSourceFactory&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/lee_test?useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="symbol">&amp;amp;</span>autoReconnect=true<span class="symbol">&amp;amp;</span>failOverReadOnly=false&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span> /&gt;</span>
            <span class="comment">&lt;!-- 连接池初始化大小为3 --&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span>
            <span class="comment">&lt;!-- 连接池最大为10 --&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span>
            <span class="comment">&lt;!-- 连接池最小为3 --&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span>
            <span class="comment">&lt;!-- 连接池在无空闲连接可用时一次性最多创建的新数据库连接数  --&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireIncrement&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>/&gt;</span>
            <span class="comment">&lt;!-- 连接的最大空闲时间，如果超过这个时间（秒），某个数据库连接还没有被使用，则会断开掉这个连接。如果为0，则永远不会断开连接,即回收此连接 --&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdleTime&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span>

            <span class="comment">&lt;!-- 最大的Statement数量 --&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatements&quot;</span> <span class="attr">value</span>=<span class="string">&quot;500&quot;</span>/&gt;</span>
            <span class="comment">&lt;!-- 每个连接启动的最大Statement数量 --&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatementsPerConnection&quot;</span> <span class="attr">value</span>=<span class="string">&quot;50&quot;</span>/&gt;</span>
            <span class="comment">&lt;!-- 同时运行的线程数 --&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;numHelperThreads&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span>
<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></code></pre>
<h4 id="测试运行-6"><a class="markdownIt-Anchor" href="#测试运行-6"></a> 测试运行</h4>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;
    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;
    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);
    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);
    <span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession();
    List&lt;Category&gt; cs =session.selectList(<span class="string">&quot;com.lee.mybatis1.CategorySpace.listCategory&quot;</span>);
    <span class="keyword">for</span> (Category c : cs) &#123;
        System.out.println(c.getName());
    &#125;

    session.close();
&#125;</code></pre>
<h3 id="逆向工程"><a class="markdownIt-Anchor" href="#逆向工程"></a> 逆向工程</h3>
<ul>
<li>Mybatis Generator是一个用于Mybatis逆向工程的工具。前面学习的方式都是先有pojo, mapper, xml, 然后再创建表。</li>
<li>用逆向工程的方式，首先保证数据库里有表，然后通过Mybatis Generator生成pojo, mapper和xml。</li>
<li>可以节约大家的时间，提高开发效率，降低出错几率</li>
</ul>
<h4 id="导入jar包-2"><a class="markdownIt-Anchor" href="#导入jar包-2"></a> 导入jar包</h4>
<h4 id="创建配置文件"><a class="markdownIt-Anchor" href="#创建配置文件"></a> 创建配置文件</h4>
<ul>
<li>在src目录下创建generatorConfig.xml</li>
<li>这个配置文件有如下作用
<ol>
<li>指定 mysql jdbcjar 包的位置,这里用的位置是 e:/project/mybatis/lib/mysql-connector-java-5.0.8-bin.jar</li>
<li>设置数据库链接账号密码</li>
<li>指定pojo,mapper,xml分别生成的包名</li>
<li>指定表名以及表名对应的类名<br />
4.1  使用自增长键：</li>
</ol>
</li>
</ul>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;my.isgen.usekeys&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>
<span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">sqlStatement</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></code></pre>
<ul>
<li>完整代码</li>
</ul>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span>
<span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span>
<span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span>
<span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span>
    <span class="comment">&lt;!--数据库驱动--&gt;</span>
    <span class="comment">&lt;!--</span>
<span class="comment">        如果IDE(eclipse或者idea) 项目里导入了jar包，那么就不需要配置了jar包的绝对路径了</span>
<span class="comment">         &lt;classPathEntry    location=&quot;e:/project/mybatis/lib/mysql-connector-java-5.0.8-bin.jar&quot;/&gt;</span>
<span class="comment">    --&gt;</span>
    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span>    <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span>
        <span class="comment">&lt;!--数据库链接地址账号密码--&gt;</span>
        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost/how2java&quot;</span> <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;admin&quot;</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span>
        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span>
        <span class="comment">&lt;!--生成Model类存放位置--&gt;</span>
        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.how2java.pojo&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span>
        <span class="comment">&lt;!--生成映射文件存放位置--&gt;</span>
        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.how2java.pojo&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span>
        <span class="comment">&lt;!--生成Dao类存放位置--&gt;</span>
         
        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.how2java.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span>
        <span class="comment">&lt;!--生成对应表及类名--&gt;</span>
        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;category_&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Category&quot;</span> <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;true&quot;</span> <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;my.isgen.usekeys&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">sqlStatement</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>       
        <span class="tag">&lt;/<span class="name">table</span>&gt;</span>
<span class="comment">&lt;!--         &lt;table tableName=&quot;product_&quot; domainObjectName=&quot;Product&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot; selectByExampleQueryId=&quot;false&quot;&gt;&lt;/table&gt; --&gt;</span>
    <span class="tag">&lt;/<span class="name">context</span>&gt;</span>
<span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></code></pre>
<ul>
<li>测试运行</li>
</ul>
<pre><code class="highlight java"><span class="keyword">package</span> com.how2java;
 
<span class="keyword">import</span> java.io.File;
<span class="keyword">import</span> java.io.InputStream;
<span class="keyword">import</span> java.util.ArrayList;
<span class="keyword">import</span> java.util.List;
 
<span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;
<span class="keyword">import</span> org.mybatis.generator.config.Configuration;
<span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;
<span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;
 
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMybatisGenerator</span> &#123;
 
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;
        List&lt;String&gt; warnings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();
        <span class="type">boolean</span> <span class="variable">overwrite</span> <span class="operator">=</span> <span class="literal">true</span>;
        InputStream is= TestMybatisGenerator.class.getClassLoader().getResource(<span class="string">&quot;generatorConfig.xml&quot;</span>).openStream();
        <span class="type">ConfigurationParser</span> <span class="variable">cp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationParser</span>(warnings);
        <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> cp.parseConfiguration(is);
        is.close();
        <span class="type">DefaultShellCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShellCallback</span>(overwrite);
        <span class="type">MyBatisGenerator</span> <span class="variable">myBatisGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBatisGenerator</span>(config, callback, warnings);
        myBatisGenerator.generate(<span class="literal">null</span>);
        System.out.println(<span class="string">&quot;生成代码成功，刷新项目，查看文件,然后执行TestMybatis.java&quot;</span>);
         
    &#125;
&#125;</code></pre>
<h3 id="创建insert时返回id"><a class="markdownIt-Anchor" href="#创建insert时返回id"></a> 创建(insert)时返回id</h3>
<ul>
<li>只需在insert标签中添加几个属性即可在新增这条信息的时候返回它的id值</li>
</ul>
<blockquote>
<p>注意：返回的id值并不是通过mapper接口方法返回，而是直接赋值给了pojo类HostForPost中的hostId字段</p>
</blockquote>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.suninfo.adm.pojo.postRequestBody.integratedMgmt.hostMgmt.HostForPost&quot;</span>  <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span></span>
<span class="tag">        <span class="attr">keyProperty</span>=<span class="string">&quot;hostId&quot;</span>&gt;</span>
  insert into t_adm_host(name, ostype_id, ip, workgroup,node_id, regist_status, cdm_serverip,ha, ha_master,
   ha_slave, create_time, update_time,run_status)
  values (#&#123;name,jdbcType=VARCHAR&#125;,
          #&#123;ostypeId,jdbcType=INTEGER&#125;,
          #&#123;ip,jdbcType=VARCHAR&#125;,
          #&#123;workgroup,jdbcType=VARCHAR&#125;,
          #&#123;nodeId,jdbcType=INTEGER&#125;,
          #&#123;registStatus,jdbcType=INTEGER&#125;,
          #&#123;cdmServerIp,jdbcType=VARCHAR&#125;,
          #&#123;ha,jdbcType=TINYINT&#125;,
          #&#123;haMaster,jdbcType=VARCHAR&#125;,
          #&#123;haSlave,jdbcType=VARCHAR&#125;,
          #&#123;createTime,jdbcType=INTEGER&#125;,
          #&#123;updateTime,jdbcType=INTEGER&#125;,
          #&#123;runStatus,jdbcType=INTEGER&#125;)
<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></code></pre>
<h3 id="使用阿里druid连接池"><a class="markdownIt-Anchor" href="#使用阿里druid连接池"></a> 使用阿里Druid连接池</h3>
<h4 id="applicationcontextxml"><a class="markdownIt-Anchor" href="#applicationcontextxml"></a> applicationContext.xml</h4>
<pre><code class="highlight xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>
<span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd&quot;</span>&gt;</span>

    <span class="comment">&lt;!--通过注解，将Service的生命周期纳入Spring的管理--&gt;</span>
    <span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span>
    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lee.service&quot;</span> /&gt;</span>

-----------------------------------------------------------------------------------------------------------
    <span class="comment">&lt;!--使用阿里的Druid连接池配置--&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span>
        <span class="comment">&lt;!-- 基本属性 url、user、password --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/lee_test?characterEncoding=UTF-8&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span>

        <span class="comment">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span> /&gt;</span>

        <span class="comment">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxWait&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60000&quot;</span> /&gt;</span>

        <span class="comment">&lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeBetweenEvictionRunsMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60000&quot;</span> /&gt;</span>

        <span class="comment">&lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minEvictableIdleTimeMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;300000&quot;</span> /&gt;</span>

        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;validationQuery&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SELECT 1&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testWhileIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnReturn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span>

        <span class="comment">&lt;!-- 打开PSCache，并且指定每个连接上PSCache的大小 --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolPreparedStatements&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolPreparedStatementPerConnectionSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span> /&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>

-----------------------------------------------------------------------------------------------------------
    <span class="comment">&lt;!--&amp;lt;!&amp;ndash;配置数据源（无连接池）&amp;ndash;&amp;gt;--&gt;</span>
    <span class="comment">&lt;!--&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;property name=&quot;driverClassName&quot;&gt;--&gt;</span>
            <span class="comment">&lt;!--&lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;/property&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;property name=&quot;url&quot;&gt;--&gt;</span>
            <span class="comment">&lt;!--&lt;value&gt;jdbc:mysql://localhost:3306/lee_test?characterEncoding=UTF-8&lt;/value&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;/property&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;property name=&quot;username&quot;&gt;--&gt;</span>
            <span class="comment">&lt;!--&lt;value&gt;root&lt;/value&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;/property&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;property name=&quot;password&quot;&gt;--&gt;</span>
            <span class="comment">&lt;!--&lt;value&gt;admin&lt;/value&gt;--&gt;</span>
        <span class="comment">&lt;!--&lt;/property&gt;--&gt;</span>
    <span class="comment">&lt;!--&lt;/bean&gt;--&gt;</span>

    <span class="comment">&lt;!--扫描存放SQL语句的Category.xml--&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.lee.pojo&quot;</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/lee/mapper/*.xml&quot;</span>/&gt;</span>
        <span class="comment">&lt;!--pageHelper分页插件，如果使用数据库limit分页关键字，则不用下列配置--&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;plugins&quot;</span>&gt;</span>
            <span class="tag">&lt;<span class="name">array</span>&gt;</span>
                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span>
                        <span class="comment">&lt;!--使用下面的方式配置参数，一行配置一个 --&gt;</span>
                        <span class="tag">&lt;<span class="name">value</span>&gt;</span>
                        <span class="tag">&lt;/<span class="name">value</span>&gt;</span>
                    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">array</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>

    <span class="comment">&lt;!--扫描Mapper，并将其生命周期纳入Spring的管理--&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.lee.mapper&quot;</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>

<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></code></pre>
<h4 id="属性详解"><a class="markdownIt-Anchor" href="#属性详解"></a> 属性详解</h4>
<pre><code class="highlight properties"><span class="attr">connection.url</span>=<span class="string">jdbc:mysql://192.168.211.182:13507/adm_dbmodel?allowMultiQueries=true&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>
<span class="attr">connection.username</span>=<span class="string">adm_admin</span>
<span class="attr">connection.password</span>=<span class="string">dSadm@34e%</span>
<span class="comment">#druid datasource</span>
<span class="comment">#初始化时建立物理连接的个数。初始化发生在显示调用init方法，或者第一次getConnection时</span>
<span class="attr">druid.initialSize</span>=<span class="string">5</span>
<span class="comment">#最小连接池数量</span>
<span class="attr">druid.minIdle</span>=<span class="string">3</span>
<span class="comment">#最大连接池数量</span>
<span class="attr">druid.maxActive</span>=<span class="string">20</span>
<span class="comment">#获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。</span>
<span class="attr">druid.maxWait</span>=<span class="string">60000</span>
<span class="comment">#有两个含义：1) Destroy线程会检测连接的间隔时间2) testWhileIdle的判断依据，详细看testWhileIdle属性的说明</span>
<span class="attr">druid.timeBetweenEvictionRunsMillis</span>=<span class="string">60000</span>
<span class="comment">#一个连接在池中最小生存的时间，单位是毫秒</span>
<span class="attr">druid.minEvictableIdleTimeMillis</span>=<span class="string">100000</span>
<span class="comment">#用来检测连接是否有效的sql，要求是一个查询语句。如果validationQuery为null，testOnBorrow、testOnReturn、testWhileIdle都不会其作用。</span>
<span class="attr">druid.validationQuery</span>=<span class="string">SELECT &#x27;x&#x27;</span>
<span class="comment">#建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。</span>
<span class="attr">druid.testWhileIdle</span>=<span class="string">true</span>
<span class="comment">#申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</span>
<span class="attr">druid.testOnBorrow</span>=<span class="string">true</span>
<span class="comment">#归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能</span>
<span class="attr">druid.testOnReturn</span>=<span class="string">false</span>
<span class="comment">#是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle。在mysql下建议关闭。</span>
<span class="attr">druid.poolPreparedStatements</span>=<span class="string">false</span>
<span class="attr">druid.maxPoolPreparedStatementPerConnectionSize</span>=<span class="string">20</span>
<span class="comment">#属性类型是字符串，通过别名的方式配置扩展插件，常用的插件有：监控统计用的filter:stat日志用的filter:log4j防御sql注入的filter:wall</span>
<span class="attr">druid.filters</span>=<span class="string">stat</span></code></pre>
<h3 id="防止sql注入"><a class="markdownIt-Anchor" href="#防止sql注入"></a> 防止sql注入</h3>
<p>使用#号不会发生sql注入，使用$可以。</p>
<h4 id="模糊查询-2"><a class="markdownIt-Anchor" href="#模糊查询-2"></a> 模糊查询</h4>
<pre><code class="highlight sql"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> title <span class="keyword">like</span> ‘<span class="operator">%</span>#&#123;title&#125;<span class="operator">%</span>’</code></pre>
<p>在这种情况下使用#程序会报错，新手程序员就把#号改成了$,这样如果java代码层面没有对用户输入的内容做处理势必会产生SQL注入漏洞。</p>
<p>正确写法:</p>
<pre><code class="highlight sql"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> tile <span class="keyword">like</span> concat(‘<span class="operator">%</span>’,#&#123;title&#125;, ‘<span class="operator">%</span>’)</code></pre>
<h4 id="in之后多个参数"><a class="markdownIt-Anchor" href="#in之后多个参数"></a> in之后多个参数</h4>
<p>in之后多个id查询时使用# 同样会报错</p>
<pre><code class="highlight sql"><span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> id <span class="keyword">in</span> (#&#123;ids&#125;)</code></pre>
<p>正确用法为使用foreach，而不是将#替换为$</p>
<pre><code class="highlight sql">id <span class="keyword">in</span>
<span class="operator">&lt;</span>foreach collection<span class="operator">=</span>&quot;ids&quot; item<span class="operator">=</span>&quot;item&quot; <span class="keyword">open</span><span class="operator">=</span>&quot;(&quot;separatosr<span class="operator">=</span>&quot;,&quot; <span class="keyword">close</span><span class="operator">=</span>&quot;)&quot;<span class="operator">&gt;</span>
    #&#123;ids&#125; 
<span class="operator">&lt;</span><span class="operator">/</span>foreach<span class="operator">&gt;</span></code></pre>
<h4 id="order-by之后"><a class="markdownIt-Anchor" href="#order-by之后"></a> order by之后</h4>
<p>这种场景应当在Java层面做映射，设置一个字段/表名数组，仅允许用户传入索引值。这样保证传入的字段或者表名都在白名单里面。需要注意的是在mybatis-generator自动生成的SQL语句中，order by使用的也是$，而like和in没有问题。</p>
</main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2026 Lism Blog | lisisism@qq.com</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>